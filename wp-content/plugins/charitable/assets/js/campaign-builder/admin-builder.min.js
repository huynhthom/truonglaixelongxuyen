var CharitableCampaignBuilder=window.CharitableCampaignBuilder||function(document,window,$){var s,$builder,$builderForm,elements={};var closeConfirmation=true;var adding=false;var app={settings:{spinner:'<i class="charitable-loading-spinner"></i>',spinnerInline:'<i class="charitable-loading-spinner charitable-loading-inline"></i>',tinymceDefaults:{tinymce:{toolbar1:"bold,italic,underline,blockquote,strikethrough,bullist,numlist,alignleft,aligncenter,alignright,undo,redo,link"},quicktags:true},pagebreakTop:false,pagebreakBottom:false,upload_img_modal:false},init:function(){var that=this;charitable_panel_switch=true;s=this.settings;$(app.ready);$(window).on("load",(function(){if(typeof $.ready.then==="function"){$.ready.then(app.load)}else{app.load()}}));$(window).on("beforeunload",(function(){if(!that.formIsSaved()&&closeConfirmation){return charitable_builder.are_you_sure_to_close}}))},load:function(){if(wpchar.getQueryString("newcampaign")){app.formSave(false)}const event=CharitableUtils.triggerEvent($builder,"CharitableCampaignBuilderReady");if(event.isDefaultPrevented()){return false}app.hideLoadingOverlay();app.initCodeEditor()},ready:function(){if(app.isVisitedViaBackButton()){location.reload();return}app.showLoadingOverlay();s.version="1.8.4.3";$builder=$("#charitable-builder");$builderForm=$("#charitable-builder-form");elements.$helpButton=$("#charitable-help");elements.$previewButton=$("#charitable-preview-btn");elements.$viewCampaignButton=$("#charitable-view-btn");elements.$embedButton=$("#charitable-embed");elements.$statusButton=$("#charitable-status-button");elements.$saveButton=$("#charitable-save");elements.$exitButton=$("#charitable-exit");elements.$templateButton=$(".charitable-panel-template-button");elements.$designButton=$(".charitable-panel-design-button");elements.$settingsButton=$(".charitable-panel-settings-button");elements.$marketingButton=$(".charitable-panel-marketing-button");elements.$paymentButton=$(".charitable-panel-payment-button");elements.$noFieldsOptions=$(".charitable-panel-fields .charitable-no-fields-holder .no-fields");elements.$noFieldsPreview=$(".charitable-panel-fields .charitable-no-fields-holder .no-fields-preview");elements.$formPreview=$(".charitable-panel-fields .charitable-preview-wrap");elements.$revisionPreview=$("#charitable-panel-revisions .charitable-panel-content");elements.$focusOutTarget=null;elements.$preview=$(".charitable-preview");elements.$panelDesign=$("#charitable-panel-design");elements.$nextFieldId=$("#charitable-field-id");elements.$fieldOptions=$("#charitable-field-options");elements.$fieldsPreviewWrap=$(".charitable-panel-fields .charitable-panel-content-wrap"),elements.$sortableFieldsWrap=$(".charitable-panel-fields .charitable-field-wrap");elements.$sortableTabsWrap=$(".charitable-panel-fields .charitable-tab-wrap");elements.$sortableTabNav=$(".charitable-campaign-preview nav.charitable-campaign-preview-nav");elements.$sortableTabContent=$(".charitable-campaign-preview .tab-content");elements.$addFieldsButtons=$(".charitable-add-fields-button").not(".not-draggable").not(".warning-modal").not(".charitable-not-available").not(".charitable-not-installed").not(".charitable-not-activated").not(".charitable-installed-refresh").not(".charitable-addon-file-missing").not(".charitable-need-upgrade");elements.$templatePanel=$("#charitable-panel-template");elements.$templatePreview=$(".charitable-template-preview");elements.$settingsPanel=$("#charitable-panel-settings");elements.$campaignID=$('#charitable-builder-form input[name="id"]');elements.$templateID=$('#charitable-builder-form input[name="template_id"]');elements.$templateLabel=$('#charitable-builder-form input[name="template_label"]');elements.$postStatus=$('#charitable-builder-form input[name="post_status"]');elements.$primaryThemeColorBase=$('#charitable-builder-form input[name="color_base_primary"]');elements.$secondaryThemeColorBase=$('#charitable-builder-form input[name="color_base_secondary"]');elements.$tertiaryThemeColorBase=$('#charitable-builder-form input[name="color_base_tertiary"]');elements.$buttonThemeColorBase=$('#charitable-builder-form input[name="color_base_button"]');app.bindUIActions();s.formID=$builderForm.data("id");s.templateID=$builderForm.data("template-id");s.templateLabel=$builderForm.data("template-label");s.primaryThemeColorBase=s.primaryThemeColor=$(this).closest(".charitable-template").data("template-primary");s.secondaryThemeColorBase=s.secondaryThemeColor=$(this).closest(".charitable-template").data("template-secondary");s.tertiaryThemeColorBase=s.tertiaryThemeColor=$(this).closest(".charitable-template").data("template-tertiary");s.buttonThemeColorBase=s.buttonThemeColor=$(this).closest(".charitable-template").data("template-button");s.primaryThemeColorBase=elements.$primaryThemeColorBase.val().length>0?elements.$primaryThemeColorBase.val():"";s.secondaryThemeColorBase=elements.$secondaryThemeColorBase.val().length>0?elements.$secondaryThemeColorBase.val():"";s.tertiaryThemeColorBase=elements.$tertiaryThemeColorBase.val().length>0?elements.$tertiaryThemeColorBase.val():"";s.buttonThemeColorBase=elements.$buttonThemeColorBase.val().length>0?elements.$buttonThemeColorBase.val():"";s.primaryThemeColor="";s.secondaryThemeColor="";s.tertiaryThemeColor="";s.buttonThemeColor="";s.formSaved=$builderForm.find("#charitable-form-saved").val();s.formSavedStatus=$builderForm.find("#charitable-form-post-status").val();s.formSavedStatusLabel=$builderForm.find("#charitable-form-post-status-label").val();s.formStatus=s.formSavedStatus.length>0?s.formSavedStatus:"draft";s.formStatusLabel=s.formSavedStatusLabel.length>0?s.formSavedStatusLabel:"Draft";s.campaignTitle=$("input#charitable_settings_title").val();s.campaignDescription=$('div[data-special-type="campaign_description"] .campaign-builder-htmleditor').first().html();s.campaignOverview=$('div[data-special-type="campaign_overview"] .campaign-builder-htmleditor').length>0?$('div[data-special-type="campaign_overview"] .campaign-builder-htmleditor').first().html():"";s.maxNumberOfTabs=4;s.denyList={"donation-form":{"donate-button":0,"donation-form":0,"donate-amount":0},"donate-button":{"donation-form":0},"donate-amount":{"donation-form":0}};s.pagebreakTop=$(".charitable-pagebreak-top").length;s.pagebreakBottom=$(".charitable-pagebreak-bottom").length;s.didInitHTMLEditorFields=false;s.quilled=[];s.currentModal=false;$builder.on("keypress","#charitable-builder-form :input:not(textarea)",(function(e){if(e.keyCode===13){e.preventDefault()}}));$(".charitable-panel").each((function(index,el){var $this=$(this),$configured=$this.find(".charitable-panel-sidebar-section.configured").first();if($configured.length){var section=$configured.data("section");$configured.addClass("active");$this.find(".charitable-panel-content-section-"+section).show().addClass("active");$this.find(".charitable-panel-content-section-default").hide()}else{$this.find(".charitable-panel-content-section").hide().removeClass("active");$this.find(".charitable-panel-content-section").first().show().addClass("active");$this.find(".charitable-panel-sidebar-section:first-of-type").addClass("active")}}));app.builderHotkeys();if(typeof jconfirm!=="undefined"){jconfirm.defaults={closeIcon:false,backgroundDismiss:false,escapeKey:true,animationBounce:1,useBootstrap:false,theme:"modern",boxWidth:"400px",animateFromElement:false,draggable:false,content:charitable_builder.something_went_wrong}}$(".campaign-builder-datepicker").each((function(){app.initDatePicker($(this))}));$(".campaign-tag-field").each((function(){app.initTagField($(this))}));$(".charitable-campaign-suggested-donations").each((function(){app.initSuggestedDonations($(this))}));$(".charitable-campaign-suggested-donations-mini").each((function(){app.initSuggestedDonationsMini($(this));app.updateSuggestdDonationsMiniRowsFromSettings($(this))}));app.initColorPicker();app.initTemplatePanel();app.initStatusButton();app.updateGoalRelatedItems();app.updateEndDateRelatedItems();app.resizeTopCampaignTitleInputBox();if(false!==app.hasTemplate()){var panel=null!==wpCookies.get("charitable_panel")?wpCookies.get("charitable_panel").trim():false;if(typeof panel!=="undefined"&&panel.length>0&&panel!=="template"){app.panelSwitch(panel)}else{app.panelSwitch("design")}app.checkFieldAllow();app.redirectBasedOnCookies(panel)}else{app.forceTemplateSelect();app.setCampaignTitleNotSet()}app.openModalButtonClick();app.confirmCampaignDeletion();$(".education-buttons button").click((function(){window.open("https://www.wpcharitable.com/pricing/")}));$(".campaign-builder-campaign-creator-id select").select2({templateResult:app.campaignCreatorFormatOptions});$(".campaign-builder-campaign-creator-id-mini select").select2({templateResult:app.campaignCreatorFormatOptions})},campaignCreatorFormatOptions(state){if(!state.id){return state.text}var $state=$('<span class="charitable-select2-avatar"><img width="20px" height="20px" style="display: inline-block; float: left; margin-right: 10px;" src="'+state.element.dataset.avatar+'" /> '+state.text+'</span><span class="charitable-select2-meta"> '+state.element.dataset.meta+"</span>");return $state},redirectBasedOnCookies(panel=false){var cookieContentSection=wpCookies.get("charitable_panel_content_section"),cookieActiveFieldId=""!==wpCookies.get("charitable_panel_active_field_id")?parseInt(wpCookies.get("charitable_panel_active_field_id")):"",cookieActiveTabId=wpCookies.get("charitable_panel_tab_section_tab_id"),cookieActiveLayoutOptionsGroup=wpCookies.get("charitable_panel_design_layout_options_group");if($(".charitable-preview").is(":visible")&&$("ul.charitable-tabs li#layout-options").is(":visible")&&""!==cookieActiveLayoutOptionsGroup&&""===cookieActiveFieldId){if(!$("ul.charitable-tabs li#layout-options a").hasClass("active")){$("ul.charitable-tabs li#layout-options a").click()}$("#charitable-field-options div.charitable-layout-options-tab-"+cookieActiveLayoutOptionsGroup+" a.charitable-group-toggle").click()}else if($(".charitable-preview").is(":visible")&&""!==cookieActiveTabId&&$('nav.charitable-campaign-preview-nav li[data-tab-id="'+cookieActiveTabId+'"] a').is(":visible")){$('.charitable-preview nav.charitable-campaign-preview-nav li[data-tab-id="'+cookieActiveTabId+'"] a').click()}else if($(".charitable-preview").is(":visible")&&$("#charitable-field-"+cookieActiveFieldId+" a").is(":visible")){app.clickFieldEdit(cookieActiveFieldId)}else if($(".charitable-panel-sidebar").is(":visible")&&$('a.charitable-panel-sidebar-section[data-section="'+cookieContentSection+'"').is(":visible")){$('a.charitable-panel-sidebar-section[data-section="'+cookieContentSection+'"').click()}else if(""!==cookieActiveFieldId&&$("#charitable-field-"+cookieActiveFieldId).is(":visible")){$("#charitable-field-"+cookieActiveFieldId).click()}else if(cookieContentSection&&$(".charitable-tabs").is(":visible")&&$(".charitable-tabs li#"+cookieContentSection+" a").is(":visible")){$(".charitable-tabs li#"+cookieContentSection+" a").click()}else if(false===panel&&false!==app.hasTemplate()){app.panelSwitch("design")}else{wpchar.debug("redirectBasedOnCookies nothing")}},clickFieldEdit(fieldId){$("#charitable-field-"+fieldId+" a.charitable-field-edit").click()},refreshTabFieldsSortDrag(){elements.$sortableTabContent=$(".charitable-campaign-preview .tab-content")},hasTemplate(){if(typeof s.templateID!=="undefined"&&s.templateID.length>0){return true}var templateID=parseInt(elements.$templateID.val());if(templateID>0){return true}return false},forceTemplateSelect(){$("#charitable-panels-toggle").find("button").removeClass("active").addClass("disabled");elements.$templateButton.removeClass("disabled").addClass("active");app.panelSwitch("template")},unforceTemplateSelect(){$("#charitable-panels-toggle").find("button").removeClass("disabled")},disableTemplateSelect(){elements.$templateButton.removeClass("active").addClass("disabled")},updateTemplateID(templateID="",templateLabel=""){elements.$templateID.val(templateID);elements.$templateLabel.val(templateLabel);app.updateThemeCSS(null,templateID,s.primaryThemeColor,s.secondaryThemeColor,s.tertiaryThemeColor,s.buttonThemeColor,false);$(".charitable-preview").removeClass((function(index,className){return(className.match(/(^|\s)charitable-builder-template-\S+/g)||[]).join(" ")})).addClass("charitable-builder-template-"+templateID);if(templateLabel!==""){$(".charitable-preview-top-bar .charitable-campaign-theme-label").text(templateLabel)}else if(templateID!==""){$(".charitable-preview-top-bar .charitable-campaign-theme-label").text(templateID)}},updateThemeCSS(whatChanged=null,templateID="",primaryThemeColor="",secondaryThemeColor="",tertiaryThemeColor="",buttonThemeColor="",justColors=true){if(""===templateID&&""===s.templateID){return}if(typeof s.primaryThemeColor==="undefined"||""===primaryThemeColor){if(typeof s.primaryThemeColor!=="undefined"&&""!==s.primaryThemeColor){primaryThemeColor=s.primaryThemeColor}else if(typeof s.primaryThemeColorBase!=="undefined"&&""!==s.primaryThemeColorBase){primaryThemeColor=s.primaryThemeColorBase}else{primaryThemeColor="000000"}}if(typeof s.secondaryThemeColor==="undefined"||""===secondaryThemeColor){if(typeof s.secondaryThemeColor!=="undefined"&&""!==s.secondaryThemeColor){secondaryThemeColor=s.secondaryThemeColor}else if(typeof s.secondaryThemeColorBase!=="undefined"&&""!==s.secondaryThemeColorBase){secondaryThemeColor=s.secondaryThemeColorBase}else{secondaryThemeColor="000000"}}if(typeof s.tertiaryThemeColor==="undefined"||""===tertiaryThemeColor){if(typeof s.tertiaryThemeColor!=="undefined"&&""!==s.tertiaryThemeColor){tertiaryThemeColor=s.tertiaryThemeColor}else if(typeof s.tertiaryThemeColorBase!=="undefined"&&""!==s.tertiaryThemeColorBase){tertiaryThemeColor=s.tertiaryThemeColorBase}else{tertiaryThemeColor="000000"}}if(typeof s.buttonThemeColor==="undefined"||""===buttonThemeColor){if(typeof s.buttonThemeColor!=="undefined"&&""!==s.buttonThemeColor){buttonThemeColor=s.buttonThemeColor}else if(typeof s.buttonThemeColorBase!=="undefined"&&""!==s.buttonThemeColorBase){buttonThemeColor=s.buttonThemeColorBase}else{buttonThemeColor="000000"}}primaryThemeColor=primaryThemeColor.replace(/[^a-zA-Z 0-9]+/g,"");secondaryThemeColor=secondaryThemeColor.replace(/[^a-zA-Z 0-9]+/g,"");tertiaryThemeColor=tertiaryThemeColor.replace(/[^a-zA-Z 0-9]+/g,"");buttonThemeColor=buttonThemeColor.replace(/[^a-zA-Z 0-9]+/g,"");var colorQueryString="p="+primaryThemeColor+"&s="+secondaryThemeColor+"&t="+tertiaryThemeColor+"&b="+buttonThemeColor+"&ver="+s.version;if(justColors===false){$('link[id="charitable-builder-template-preview-theme-css"]').attr("href",charitable_builder.charitable_assets_dir+"css/campaign-builder/themes/admin/"+templateID+".php?"+colorQueryString)}if(whatChanged!==null){app.replaceCSSFile(whatChanged,templateID,colorQueryString)}else{app.replaceCSSFile("primary",templateID,colorQueryString);app.replaceCSSFile("secondary",templateID,colorQueryString);app.replaceCSSFile("tertiary",templateID,colorQueryString);app.replaceCSSFile("button",templateID,colorQueryString)}},replaceCSSFile:function(whatChanged,templateID,colorQueryString){$("head").find("link#charitable-builder-template-preview-theme-colors-"+whatChanged+"-css").remove();$("head").append('<link rel="stylesheet" data-color-type="'+whatChanged+'" id="charitable-builder-template-preview-theme-colors-temp" href="'+charitable_builder.charitable_assets_dir+"css/campaign-builder/themes/admin/"+templateID+"-colors.php?"+colorQueryString+'" type="text/css" media="screen">');$("#charitable-design-wrap").addClass("loading");setTimeout((function(){$("head").find("#charitable-builder-template-preview-theme-colors-temp").attr("id","charitable-builder-template-preview-theme-colors-"+whatChanged+"-css");$("#charitable-design-wrap").removeClass("loading")}),250)},searchTemplate:function(e){e.preventDefault();let $active=$(".charitable-setup-templates-categories li.active"),category=$active.data("category"),searchQuery=$(this).val();app.performSearch(searchQuery,category)},performSearch(query="",category=""){let $templateList=elements.$templatePreview.find(".charitable-template-list");if(query===""&&(category===""||category==="all")){$templateList.find(".charitable-template-list-container-item").removeClass("charitable-hidden")}else{$templateList.find(".charitable-template-list-container-item").addClass("charitable-hidden");if(query!==""&&category!==""&&category!=="all"){$templateList.find('.charitable-template[data-template-tags*="'+query+'"][data-template-categories*="'+category+'"]').parent().removeClass("charitable-hidden")}else if(query!==""&&(category===""||category==="all")){$templateList.find('.charitable-template[data-template-tags*="'+query+'"],.charitable-template[data-template-categories*="'+query+'"]').parent().removeClass("charitable-hidden")}else{$templateList.find('.charitable-template[data-template-tags*="'+category+'"],.charitable-template[data-template-categories*="'+category+'"]').parent().removeClass("charitable-hidden")}}var numItems=$(".charitable-template-list-container-item").not(".hidden").length;$(".charitable-templates-no-results").toggle(!numItems);if(!elements.$templatePreview.find("#charitable-setup-template-search").val()){elements.$templatePreview.find(".charitable-setup-templates-search-wrap .fa-close").hide()}else{elements.$templatePreview.find(".charitable-setup-templates-search-wrap .fa-close").show()}app.showCheckTemplateList();app.showUpgradeBanner()},selectCategory:function(e){e.preventDefault();let $item=$(this),$active=$item.closest("ul").find(".active"),category=$item.data("category"),searchQuery=$("#charitable-setup-template-search").val();$active.removeClass("active");$item.addClass("active");app.performSearch(searchQuery,category)},showUpgradeBanner:function(){if(!$("#tmpl-charitable-templates-upgrade-banner").length){return}if($("#charitable-template-list .charitable-template-upgrade-banner").length>0){$("#charitable-template-list .charitable-template-upgrade-banner").remove()}if(!app.isFunction(wp.template)){wpchar.debug("wp.template not a function");return}else{wpchar.debug("wp.template is a function")}let template=wp.template("charitable-templates-upgrade-banner");if(!template){return}const $templates=$("#charitable-template-list .charitable-template-list-container-item:not(.charitable-hidden)"),$insertPoint=$("#charitable-template-list .charitable-template-list-container-item");if($templates.length>5){$("#charitable-template-list .charitable-template-list-container > div:last-child").after(template());return}$insertPoint.last().after(template())},showCheckTemplateList:function(){if($("#charitable-template-list .charitable-template-list-container-item.blank:not(.charitable-hidden)").length===0){$("#charitable-template-list .charitable-template-list-section-blank").addClass("charitable-hidden");$("#charitable-template-list .charitable-template-list-section-prebuilt").addClass("charitable-hidden")}else{$("#charitable-template-list .charitable-template-list-section-blank").removeClass("charitable-hidden");$("#charitable-template-list .charitable-template-list-section-prebuilt").removeClass("charitable-hidden")}if($("#charitable-template-list .charitable-template-list-container-item.prebuilt:not(.charitable-hidden)").length===0){$("#charitable-template-list .charitable-template-list-section-prebuilt").addClass("charitable-hidden")}else{$("#charitable-template-list .charitable-template-list-section-prebuilt").removeClass("charitable-hidden")}if($("#charitable-template-list .charitable-template-list-container-item.prebuilt:not(.charitable-hidden)").length>0&&$("#charitable-template-list .charitable-template-list-container-item.blank:not(.charitable-hidden)").length===0){$("#charitable-template-list .charitable-template-list-section-prebuilt").addClass("charitable-hidden")}},initStatusButton:function(formStatus="",formStatusLabel=""){var $statusDropdown=$("ul#charitable-status-dropdown");if(formStatus==""&&s.formStatus.length>0){formStatus=s.formStatus}if(formStatusLabel==""&&s.formStatusLabel.length>0){formStatusLabel=s.formStatusLabel}$statusDropdown.addClass("charitable-hidden");$("#charitable-status-button").removeClass("active");$("#charitable-status-button span.text").html(formStatusLabel);$("#charitable-status-button").attr("data-status",formStatus);$statusDropdown.find("a").removeClass("charitable-hidden");$statusDropdown.find("a.switch-"+formStatus).addClass("charitable-hidden");$statusDropdown.find("a."+formStatus).addClass("charitable-hidden");if(formStatus==="draft"){}else if(formStatus==="publish"){}},initTemplatePanel:function(){$("#charitable-template-container").on("keyup","#charitable-setup-template-search",app.searchTemplate).on("click",".charitable-setup-templates-categories li",app.selectCategory);if(!s.didInitHTMLEditorFields){$(".campaign-builder-htmleditor").each((function(){app.initHTMLEditorFields($(this))}));$(".campaign-builder-htmleditor-min").each((function(){app.initHTMLEditorFields($(this),true)}));s.didInitHTMLEditorFields=true}elements.$templatePreview.on("click",".charitable-template-lite-to-pro a.button, .charitable-setup-templates-feedback a.send-feedback",(function(e){e.preventDefault();$(".charitable-panel-content-wrap").animate({scrollTop:0},500);$(".charitable-template-list-container").addClass("disabled");$(".charitable-feedback-form-container").after('<div id="charitable-builder-underlay" class="charitable-builder-underlay"></div>');$(".charitable-feedback-form-container").css("opacity","100").css("visibility","visible");$(".charitable-feedback-form-container").find(".charitable-feedback-form-interior").removeClass("charitable-hidden");$(".charitable-feedback-form-container").find("textarea").val("");$(".charitable-feedback-form-interior-confirmation").addClass("charitable-hidden")}));$builderForm.on("click","#charitable-feedback-form .charitable-templates-close-icon, #charitable-feedback-form-confirmation .charitable-templates-close-icon",(function(e){e.preventDefault();$(".charitable-template-list-container").removeClass("disabled");$(".charitable-builder-underlay").remove();$("#charitable-panel-template .charitable-feedback-form-container").css("opacity","0").css("visibility","hidden")}));$builderForm.on("click",".template-buttons a.preview-campaign",(function(e){e.preventDefault();$(".charitable-template-list-container").addClass("disabled");$(".charitable-feedback-form-container").after('<div id="charitable-builder-underlay" class="charitable-builder-underlay"></div>');const previewBox=$(this).closest(".charitable-template"),templateLabel=typeof previewBox.data("template-label")!=="undefined"?previewBox.data("template-label"):"",templateDescription=typeof previewBox.data("template-description")!=="undefined"?previewBox.data("template-description"):"",templatePreviewURL=typeof previewBox.data("template-preview-url")!=="undefined"?previewBox.data("template-preview-url"):"",templateCode=typeof previewBox.data("template-code")!=="undefined"?previewBox.data("template-code"):"";$("#charitable-builder-modal-template-preview").find("h4").html(templateLabel);$("#charitable-builder-modal-template-preview").find(".charitable-templates-preview-description").html("<p>"+templateDescription+"</p>");$("#charitable-builder-modal-template-preview").find("img").attr("src",templatePreviewURL);$("#charitable-builder-modal-template-preview").find("img").attr("alt",templateLabel);$("#charitable-builder-modal-template-preview").find("a.button-link").attr("data-template-id",templateCode);$(".charitable-builder-modal.charitable-builder-modal-template-preview").addClass("active")}));$builderForm.on("click","#charitable-templates-preview-form .charitable-templates-close-icon",(function(e){e.preventDefault();$(".charitable-template-list-container").removeClass("disabled");$("#charitable-builder-underlay").remove();$(".charitable-builder-modal.charitable-builder-modal-template-preview").removeClass("active")}));elements.$templatePreview.on("click","nav.charitable-template-tabs a",(function(e){e.preventDefault();var $this=$(this),templateTabFilter=$this.data("template-tab-filter")?$this.data("template-tab-filter"):false,$templateList=elements.$templatePreview.find(".charitable-template-list ");elements.$templatePreview.find("nav.charitable-template-tabs a").removeClass("active");$this.addClass("active");$templateList.find(".charitable-template").removeClass("hidden");if(templateTabFilter){$templateList.find('.charitable-template[data-template-type!="'+templateTabFilter+'"]').addClass("hidden")}}));elements.$templatePreview.on("click","a.charitable-trigger-blank",(function(e){e.preventDefault();$("#charitable-template-list .charitable-template-upgrade-banner").remove();elements.$templatePreview.find("#charitable-setup-template-search").val("simple").trigger("keyup").addClass("highlighted").addClass("with-x");elements.$templatePreview.find(".charitable-setup-templates-categories").find("li[data-category=all").click();app.showCheckTemplateList();app.showUpgradeBanner()}));elements.$templatePreview.on("click","i.fa-close",(function(e){elements.$templatePreview.find("#charitable-setup-template-search").val("").trigger("keyup").removeClass("highlighted")}));elements.$templatePreview.on("click",".button.create-campaign",(function(e){e.preventDefault();if(app.hasTemplate()){$.confirm({title:charitable_builder.heads_up,content:"<p>"+charitable_builder.error_already_started_campaign+"</p>",icon:"fa fa-exclamation-circle",type:"orange",buttons:{confirm:{text:charitable_builder.ok,btnClass:"btn-confirm",keys:["enter"],action:function(){s.templateID=$(this).closest(".charitable-template").data("template-code");s.templateLabel=$(this).closest(".charitable-template").data("template-label");s.primaryThemeColorBase=s.primaryThemeColor=$(this).closest(".charitable-template").data("template-primary");s.secondaryThemeColorBase=s.secondaryThemeColor=$(this).closest(".charitable-template").data("template-secondary");s.tertiaryThemeColorBase=s.tertiaryThemeColor=$(this).closest(".charitable-template").data("template-tertiary");s.buttonThemeColorBase=s.buttonThemeColor=$(this).closest(".charitable-template").data("template-button");elements.$primaryThemeColorBase.val(s.primaryThemeColorBase);elements.$secondaryThemeColorBase.val(s.secondaryThemeColorBase);elements.$tertiaryThemeColorBase.val(s.tertiaryThemeColorBase);elements.$buttonThemeColorBase.val(s.buttonThemeColorBase);$('input[name="layout__advanced__theme_color_primary"]').val(s.primaryThemeColor);$('input[name="layout__advanced__theme_color_secondary"]').val(s.secondaryThemeColor);$('input[name="layout__advanced__theme_color_tertiary"]').val(s.tertiaryThemeColor);$('input[name="layout__advanced__theme_color_button"]').val(s.buttonThemeColor);document.querySelector('input[name="layout__advanced__theme_color_primary"]').dispatchEvent(new Event("input",{bubbles:true}));document.querySelector('input[name="layout__advanced__theme_color_secondary"]').dispatchEvent(new Event("input",{bubbles:true}));document.querySelector('input[name="layout__advanced__theme_color_tertiary"]').dispatchEvent(new Event("input",{bubbles:true}));document.querySelector('input[name="layout__advanced__theme_color_button"]').dispatchEvent(new Event("input",{bubbles:true}));app.restartForm(s.templateID,null,s.templateLabel);app.restartTemplateScreen(s.templateID)}},cancel:{text:charitable_builder.cancel,keys:["esc"]}}})}else{s.templateID=$(this).closest(".charitable-template").data("template-code");s.templateLabel=$(this).closest(".charitable-template").data("template-label");s.primaryThemeColorBase=s.primaryThemeColor=$(this).closest(".charitable-template").data("template-primary");s.secondaryThemeColorBase=s.secondaryThemeColor=$(this).closest(".charitable-template").data("template-secondary");s.tertiaryThemeColorBase=s.tertiaryThemeColor=$(this).closest(".charitable-template").data("template-tertiary");s.buttonThemeColorBase=s.buttonThemeColor=$(this).closest(".charitable-template").data("template-button");elements.$primaryThemeColorBase.val(s.primaryThemeColorBase);elements.$secondaryThemeColorBase.val(s.secondaryThemeColorBase);elements.$tertiaryThemeColorBase.val(s.tertiaryThemeColorBase);elements.$buttonThemeColorBase.val(s.buttonThemeColorBase);$('input[name="layout__advanced__theme_color_primary"]').val(s.primaryThemeColor);$('input[name="layout__advanced__theme_color_secondary"]').val(s.secondaryThemeColor);$('input[name="layout__advanced__theme_color_tertiary"]').val(s.tertiaryThemeColor);$('input[name="layout__advanced__theme_color_button"]').val(s.buttonThemeColor);document.querySelector('input[name="layout__advanced__theme_color_primary"]').dispatchEvent(new Event("input",{bubbles:true}));document.querySelector('input[name="layout__advanced__theme_color_secondary"]').dispatchEvent(new Event("input",{bubbles:true}));document.querySelector('input[name="layout__advanced__theme_color_tertiary"]').dispatchEvent(new Event("input",{bubbles:true}));document.querySelector('input[name="layout__advanced__theme_color_button"]').dispatchEvent(new Event("input",{bubbles:true}));app.updateTemplateID(s.templateID,s.templateLabel);app.unforceTemplateSelect();app.enableFormActions();app.restartForm(s.templateID,"design",s.templateLabel);app.restartTemplateScreen(s.templateID);if(!s.didInitHTMLEditorFields){$(".campaign-builder-htmleditor").each((function(){app.initHTMLEditorFields($(this))}));$(".campaign-builder-htmleditor-min").each((function(){app.initHTMLEditorFields($(this),true)}));s.didInitHTMLEditorFields=true}CharitableUtils.triggerEvent($builder,"charitableCampaignFormScreen",[s.templateID])}}));$builder.on("click",".button-preview-create-campaign",(function(e){e.preventDefault();var $theButton=$(this),theTemplateID=$theButton.data("template-id");if(theTemplateID!==""){$(".charitable-template-list-container").removeClass("disabled");$("#charitable-builder-underlay").remove();$(".charitable-builder-modal.charitable-builder-modal-template-preview").removeClass("active");if($('#charitable-template-list .charitable-template[data-template-code="'+theTemplateID+'"] .button.update-campaign').length>0){elements.$templatePreview.find(".charitable-template-list-container-item.charitable-template-"+theTemplateID+" .button.update-campaign").click()}else{elements.$templatePreview.find(".charitable-template-list-container-item.charitable-template-"+theTemplateID+" .button.create-campaign").click()}}}));$builder.on("click",".button-preview-update-campaign",(function(e){e.preventDefault();var $theButton=$(this),theTemplateID=$theButton.data("template-id");if(theTemplateID!==""){$(".charitable-template-list-container").removeClass("disabled");$("#charitable-builder-underlay").remove();$(".charitable-builder-modal.charitable-builder-modal-template-preview").removeClass("active");if($('#charitable-template-list .charitable-template[data-template-code="'+theTemplateID+'"] .button.update-campaign').length>0){elements.$templatePreview.find(".charitable-template-list-container-item.charitable-template-"+theTemplateID+" .button.update-campaign").click()}else{elements.$templatePreview.find(".charitable-template-list-container-item.charitable-template-"+theTemplateID+" .button.create-campaign").click()}}}));elements.$templatePreview.on("click",".button.update-campaign",(function(e){e.preventDefault();var theButton=$(this);if(app.hasTemplate()){$.confirm({title:charitable_builder.heads_up,content:"<p>"+charitable_builder.error_already_started_campaign+"</p>",icon:"fa fa-exclamation-circle",type:"orange",buttons:{confirm:{text:charitable_builder.ok,btnClass:"btn-confirm",keys:["enter"],action:function(){s.templateID=theButton.closest(".charitable-template").data("template-code");s.templateLabel=theButton.closest(".charitable-template").data("template-label");app.updateTemplateID(s.templateID,s.templateLabel);s.primaryThemeColorBase=s.primaryThemeColor=theButton.closest(".charitable-template").data("template-primary");s.secondaryThemeColorBase=s.secondaryThemeColor=theButton.closest(".charitable-template").data("template-secondary");s.tertiaryThemeColorBase=s.tertiaryThemeColor=theButton.closest(".charitable-template").data("template-tertiary");s.buttonThemeColorBase=s.buttonThemeColor=theButton.closest(".charitable-template").data("template-button");elements.$primaryThemeColorBase.val(s.primaryThemeColorBase);elements.$secondaryThemeColorBase.val(s.secondaryThemeColorBase);elements.$tertiaryThemeColorBase.val(s.tertiaryThemeColorBase);elements.$buttonThemeColorBase.val(s.buttonThemeColorBase);$('input[name="layout__advanced__theme_color_primary"]').val(s.primaryThemeColor);$('input[name="layout__advanced__theme_color_secondary"]').val(s.secondaryThemeColor);$('input[name="layout__advanced__theme_color_tertiary"]').val(s.tertiaryThemeColor);$('input[name="layout__advanced__theme_color_button"]').val(s.buttonThemeColor);document.querySelector('input[name="layout__advanced__theme_color_primary"]').dispatchEvent(new Event("input",{bubbles:true}));document.querySelector('input[name="layout__advanced__theme_color_secondary"]').dispatchEvent(new Event("input",{bubbles:true}));document.querySelector('input[name="layout__advanced__theme_color_tertiary"]').dispatchEvent(new Event("input",{bubbles:true}));document.querySelector('input[name="layout__advanced__theme_color_button"]').dispatchEvent(new Event("input",{bubbles:true}));$("#charitable-template-list .charitable-template").removeClass("active");$("#charitable-template-list .charitable-banner-container").each((function(){$(this).addClass("charitable-hidden");$(this).parent().find(".template-buttons").removeClass("charitable-hidden")}));theButton.closest(".charitable-template").addClass("active");theButton.closest(".charitable-template").find(".template-buttons").addClass("charitable-hidden");theButton.closest(".charitable-template").find(".charitable-banner-container").removeClass("charitable-hidden");$(".charitable-setup-desc.secondary-text strong.template-name").html(s.templateLabel);wpchar.debug("chose this path");app.restartForm(s.templateID,"design",s.templateLabel);app.restartTemplateScreen(s.templateID)}},cancel:{text:charitable_builder.cancel,keys:["esc"]}}})}}));app.showUpgradeBanner()},restartTemplateScreen:function(templateID=0){if(templateID===""||templateID===0){templateID=s.templateID}if(templateID===""||templateID===0){return}const templateList=$(".charitable-template-list-container");templateList.find(".template-buttons").remove(".preview-campaign");templateList.find(".button.create-campaign").removeClass("create-campaign").addClass("update-campaign").html(charitable_builder.update_campaign);templateList.find(".charitable-template").removeClass("active");templateList.find(".charitable-template .charitable-banner-container").addClass("charitable-hidden");templateList.find('.charitable-template[data-template-code="'+templateID+'"]').addClass("active");templateList.find('.charitable-template[data-template-code="'+templateID+'"] .charitable-banner-container').removeClass("charitable-hidden")},restartForm:function(templateID=0,panel="design",templateLabel=false){app.updateTemplateID(templateID,templateLabel);app.showLoadingOverlay();var data={action:"charitable_get_campaign_builder_template_data",id:templateID,title:s.campaignTitle,nonce:charitable_builder.nonce};$.post(charitable_builder.ajax_url,data,(function(response){if(response.success){$("#charitable-field-options .charitable-layout-options-group-inner").find(".charitable-panel-field").remove();$("#charitable-field-options .charitable-select-field-notice").show();s.quilled=[];elements.$nextFieldId.val(0);app.hideLoadingOverlay();var previewLayout=typeof response.data.preview!=="undefined"?response.data.preview:false,previewFieldOptions=typeof response.data.field_options!=="undefined"?response.data.field_options:false,previewTabOptions=typeof response.data.tab_options!=="undefined"?response.data.tab_options:false,previewAdvancedOptions=typeof response.data.advanced!=="undefined"?response.data.advanced:false;if(previewLayout){app.addLayoutToPreview(previewLayout)}else{wpchar.debug("previewLayout is false or not defined")}if(previewFieldOptions){app.addFieldOptions(previewFieldOptions)}else{wpchar.debug("previewFieldOptions is false or not defined")}if(previewTabOptions){app.addTabOptions(previewTabOptions)}else{wpchar.debug("previewTabOptions is false or not defined")}if(previewAdvancedOptions){app.addAdvancedOptions(previewAdvancedOptions)}else{wpchar.debug("previewAdvancedOptions is false or not defined")}Charitable.Admin.Builder.DragFields.ready();app.updateFormHiddenFields();app.updateFormHiddenFieldID();$(".campaign-builder-htmleditor").each((function(){app.initHTMLEditorFields($(this))}));$(".campaign-builder-htmleditor-min").each((function(){app.initHTMLEditorFields($(this),true)}));s.didInitHTMLEditorFields=true;elements.$preview.find(".charitable-field-section").each((function(){app.checkFieldTargetState($(this))}));app.checkAllRecommendedFields();app.updateGoalRelatedItems();app.updateEndDateRelatedItems();if(panel){app.panelSwitch("design")}$(".charitable-campaign-suggested-donations-mini").each((function(){app.initSuggestedDonationsMini($(this));app.updateSuggestdDonationsMiniRowsFromSettings($(this))}));app.checkFieldAllow();app.checkFieldMax();if(typeof response.data.settings.general.description!=="undefined"&&response.data.settings.general.description!=""){s.campaignDescription=response.data.settings.general.description;elements.$settingsPanel.find('input[name="settings[general][description]"').val(s.campaignDescription)}app.setCampaignNotSaved();$builder.trigger("charitableEditorScreenStart")}else{app.formSaveError(response.data)}})).fail((function(xhr,textStatus,e){app.formSaveError()})).always((function(){}))},checkNoFieldsPreview(forceModeOff=false){if(forceModeOff===false&&elements.$preview.find('.charitable-field-section[data-section-type="fields"] .charitable-field').length===0&&typeof charitable_builder.no_field_preview!=="undefined"){$("#charitable-design-wrap").addClass("no-fields-mode");if($builder.find(".charitable-no-fields-area").hasClass("charitable-hidden")){$builder.find(".charitable-no-fields-area").removeClass("charitable-hidden")}}else if(forceModeOff!==false){if(!$builder.find(".charitable-no-fields-area").hasClass("charitable-hidden")){$builder.find(".charitable-no-fields-area").addClass("charitable-hidden")}$("#charitable-design-wrap").removeClass("no-fields-mode")}else{if(!$builder.find(".charitable-no-fields-area").hasClass("charitable-hidden")){$builder.find(".charitable-no-fields-area").addClass("charitable-hidden")}$("#charitable-design-wrap").removeClass("no-fields-mode")}},checkFieldTargetState($section=false){if(false===$section){return}if($section.data("section-type")!=="fields"&&$section.data("section-type")!=="tabs"){return}if($section.data("section-type")==="fields"){if($section.find(".charitable-field").length===0){$section.removeClass("charitable-field-target-inactive").addClass("charitable-field-target")}else{$section.removeClass("charitable-field-target").addClass("charitable-field-target-inactive")}}else if($section.data("section-type")==="tabs"){if($section.find(".tab_content_item.active .charitable-field").length===0){$section.find(".tab_content_item.active").removeClass("empty-tab").addClass("empty-tab")}else{$section.find(".tab_content_item.active").removeClass("empty-tab")}}},addAdvancedOptions(previewAdvancedOptions){var advancedFieldsInTab=$(".charitable-layout-options-tab-advanced").find("input, select");advancedFieldsInTab.each((function(){var $thisInput=$(this),advancedFieldId=$thisInput.data("advanced-field-id");if(typeof previewAdvancedOptions[advancedFieldId]!=="undefined"&&advancedFieldId!=""){if($thisInput.is("select")){$thisInput.val(previewAdvancedOptions[advancedFieldId]).change()}else{$thisInput.val(previewAdvancedOptions[advancedFieldId])}}}))},addFieldOptions(previewFieldOptions){elements.$fieldOptions.find(".charitable-layout-options-group-inner .charitable-select-field-notice").after(previewFieldOptions)},addTabOptions(previewTabOptions){elements.$fieldOptions.find(".charitable-layout-options-tab.charitable-layout-options-tab-tabs .charitable-layout-options-group-inner").html(previewTabOptions)},addLayoutToPreview(previewLayout){elements.$preview.find(".charitable-design-wrap").replaceWith(previewLayout)},alignFieldEvents:function($builder){$builder.on("click",".charitable-panel-field-align a",(function(e){e.preventDefault();var clickedLink=$(this),panelField=clickedLink.closest(".charitable-panel-field"),alignValue=""!==clickedLink.data("align-value")?clickedLink.data("align-value"):"center";panelField.find("span").removeClass("active");panelField.find('input[type="hidden"').val(alignValue);clickedLink.parent().addClass("active");app.setCampaignNotSaved()}))},numberSliderEvents:function($builder){elements.$fieldOptions.on("input change",'input[type="range"]',(function(e){var minimum_value=$(this).attr("min-actual")?parseInt($(this).attr("min-actual")):0,scrolled_value=$(this).val();if(minimum_value>0){if(scrolled_value<=minimum_value){$(this).val(minimum_value);$(this).next().addClass("min-reach")}else{$(this).next().removeClass("min-reach")}}app.setCampaignNotSaved()}));$builder.on("change input",".charitable-panel-field-number-slider input[type=range]",(function(event){var hintEl=$(event.target).siblings(".charitable-number-slider-hint");hintEl.attr("data-hint",event.target.value);hintEl.html(event.target.value+hintEl.data("symbol")+"<small>minimum</small>")}));$builder.on("input",".charitable-field-option-row-min_max .charitable-input-row .charitable-number-slider-min",app.fieldNumberSliderUpdateMin);$builder.on("input",".charitable-field-option-row-min_max .charitable-input-row .charitable-number-slider-max",app.fieldNumberSliderUpdateMax);$builder.on("input",".charitable-number-slider-default-value",_.debounce(app.changeNumberSliderDefaultValue,500));$builder.on("input",".charitable-number-slider-step",_.debounce(app.changeNumberSliderStep,500));$builder.on("focusout",".charitable-number-slider-step",app.checkNumberSliderStep);$builder.on("input",".charitable-number-slider-value-display",_.debounce(app.changeNumberSliderValueDisplay,500));$builder.on("input",".charitable-number-slider-min",_.debounce(app.changeNumberSliderMin,500));$builder.on("input",".charitable-number-slider-max",_.debounce(app.changeNumberSliderMax,500))},changeNumberSliderMin:function(event){var fieldID=$(event.target).parents(".charitable-field-option-row").data("fieldId");var value=parseFloat(event.target.value);if(isNaN(value)){return}app.updateNumberSliderDefaultValueAttr(fieldID,event.target.value,"min")},changeNumberSliderMax:function(event){var fieldID=$(event.target).parents(".charitable-field-option-row").data("fieldId");var value=parseFloat(event.target.value);if(isNaN(value)){return}app.updateNumberSliderDefaultValueAttr(fieldID,event.target.value,"max").updateNumberSliderStepValueMaxAttr(fieldID,event.target.value)},changeNumberSliderValueDisplay:function(event){var str=event.target.value;var fieldID=$(event.target).parents(".charitable-field-option-row").data("fieldId");var defaultValue=document.getElementById("charitable-field-option-"+fieldID+"-default_value");if(defaultValue){app.updateNumberSliderHintStr(fieldID,str).updateNumberSliderHint(fieldID,defaultValue.value)}},changeNumberSliderStep:function(event){var value=parseFloat(event.target.value);if(isNaN(value)){return}var max=parseFloat(event.target.max),min=parseFloat(event.target.min),fieldID=$(event.target).parents(".charitable-field-option-row").data("fieldId");if(value<=0){return}if(value>max){event.target.value=max;return}if(value<min){event.target.value=min;return}app.updateNumberSliderAttr(fieldID,value,"step").updateNumberSliderDefaultValueAttr(fieldID,value,"step")},checkNumberSliderStep:function(event){var value=parseFloat(event.target.value),$input=$(this);if(!isNaN(value)&&value>0){return}$.confirm({title:charitable_builder.heads_up,content:charitable_builder.error_number_slider_increment,icon:"fa fa-exclamation-circle",type:"orange",buttons:{confirm:{text:charitable_builder.ok,btnClass:"btn-confirm",keys:["enter"],action:function(){$input.val("").trigger("focus")}}}})},changeNumberSliderDefaultValue:function(event){var value=parseFloat(event.target.value);if(!isNaN(value)){var max=parseFloat(event.target.max),min=parseFloat(event.target.min),fieldID=$(event.target).parents(".charitable-field-option-row-default_value").data("fieldId");if(value>max){event.target.value=max;return}if(value<min){event.target.value=min;return}app.updateNumberSlider(fieldID,value).updateNumberSliderHint(fieldID,value)}},updateNumberSliderDefaultValueAttr:function(fieldID,newValue,attr){var input=document.getElementById("charitable-field-option-"+fieldID+"-default_value");if(input){var value=parseFloat(input.value);input.setAttribute(attr,newValue);newValue=parseFloat(newValue);if("max"===attr&&value>newValue){input.value=newValue;$(input).trigger("input")}if("min"===attr&&value<newValue){input.value=newValue;$(input).trigger("input")}}return this},updateNumberSlider:function(fieldID,value){var numberSlider=document.getElementById("charitable-number-slider-"+fieldID);if(numberSlider){numberSlider.value=value}return this},updateNumberSliderAttr:function(fieldID,value,attr){var numberSlider=document.getElementById("charitable-number-slider-"+fieldID);if(numberSlider){numberSlider.setAttribute(attr,value)}return this},updateNumberSliderHintStr:function(fieldID,str){var hint=document.getElementById("charitable-number-slider-hint-"+fieldID);if(hint){hint.dataset.hint=str}return this},updateNumberSliderHint:function(fieldID,value){var hint=document.getElementById("charitable-number-slider-hint-"+fieldID);if(hint){hint.innerHTML=wpchar.sanitizeHTML(hint.dataset.hint).replace("{value}","<b>"+value+"</b>")}return this},fieldNumberSliderUpdateMin:function(event){var $options=$(event.target).parents(".charitable-field-option-row-min_max"),max=parseFloat($options.find(".charitable-number-slider-max").val()),current=parseFloat(event.target.value);if(isNaN(current)){return}if(max<=current){event.preventDefault();this.value=max;return}var fieldId=$options.data("field-id"),numberSlider=$builder.find("#charitable-field-"+fieldId+' input[type="range"]');numberSlider.attr("min",current)},fieldNumberSliderUpdateMax:function(event){var $options=$(event.target).parents(".charitable-field-option-row-min_max"),min=parseFloat($options.find(".charitable-number-slider-min").val()),current=parseFloat(event.target.value);if(isNaN(current)){return}if(min>=current){event.preventDefault();this.value=min;return}var fieldId=$options.data("field-id");var numberSlider=$builder.find("#charitable-field-"+fieldId+' input[type="range"]');numberSlider.attr("max",current)},updateNumberSliderStepValueMaxAttr:function(fieldID,newValue){var input=document.getElementById("charitable-field-option-"+fieldID+"-step");if(input){var value=parseFloat(input.value);input.setAttribute("max",newValue);newValue=parseFloat(newValue);if(value>newValue){input.value=newValue;$(input).trigger("input")}}return this},isVisitedViaBackButton:function(){if(!performance){return false}var isVisitedViaBackButton=false;performance.getEntriesByType("navigation").forEach((function(nav){if(nav.type==="back_forward"){isVisitedViaBackButton=true}}));return isVisitedViaBackButton},hideLoadingOverlay:function(){var $overlay=$("#charitable-builder-overlay");$overlay.addClass("fade-out");setTimeout((function(){$overlay.hide()}),200)},initCodeEditor:function(){if($(".campaign-builder-codeeditor").length>0){var field_id="";$(".campaign-builder-codeeditor").each((function(){if($(this).attr("id").indexOf("charitable-panel-field-settings-field_html_html_")!==-1){field_id=$(this).attr("id").replace("charitable-panel-field-settings-field_html_html_","");wpchar.debug("field_id: "+field_id);$builder.trigger("charitableFieldAddHTML",[field_id,"html"])}}))}},showLoadingOverlay:function(){var $overlay=$("#charitable-builder-overlay");$overlay.removeClass("fade-out");$overlay.show()},updateFormUI:function(element=false,value=false){var title=false;if(element==="title"){title=value}else{title=$("input.charitable-form-name").val()}title=title.replace(/[^a-z0-9 _.,!"'/$]/gi,"");elements.$campaignNameTopBanner=$("input.charitable-form-name");elements.$campaignNamePreview=$(".charitable-preview .charitable-form-name");elements.$campaignNameFieldTitleSettings=$("input.charitable-campaign-builder-title");elements.$campaignNameTopBanner.val(title);elements.$campaignNamePreview.html(title);elements.$campaignNameFieldTitleSettings.val(title);elements.$preview.find(".charitable-field-campaign-title .charitable-campaign-builder-placeholder-preview-text").html('<h1 class="charitable-campaign-title">'+title+"</h1>");if(element==="title"){s.campaignTitle=title;app.resizeTopCampaignTitleInputBox()}},bindUIActions:function(){app.bindAutoResizeCampaignTitle();app.bindUIEditCampaignTitle();app.bindCampaignTitleBlockTextField();app.bindUIActionsPanels();app.bindUIActionsFields();app.bindUIActionsPreview();app.bindUIActionsSaveExit();app.bindUIActionsGeneral();app.bindUITabs();$builder.on("change","input, textarea, select, checkbox, radio",(function(e){app.setCampaignNotSaved()}));app.bindUILayoutOptionsAdvanced();app.bindUISettingsRevealGroups();app.bindUIMoneyTextFields();app.checkFieldConditionals();$builder.on("change","select#charitable-panel-field-settings-campaign_campaign_creator_id",(function(e){app.updateCampaignCreatorInfo()}));$builder.on("click","div#charitable-marketing-form a.button-link, div#charitable-payment-form a.button-link, div#charitable-feedback-form a.button-link",(function(e){e.preventDefault();app.initFeedbackForms($(this))}));$builder.on("keyup","table.charitable-campaign-suggested-donations-mini input",(function(e){var field_id=parseInt($(this).closest(".charitable-panel-field").data("field-id"));if(field_id>0){var theIndex=$(this).index('.charitable-panel-field[data-field-id="'+field_id+'"] table.charitable-campaign-suggested-donations-mini input[type="text"].campaign_suggested_donations');app.updateSuggestDonationsSettings($(this),theIndex)}}));$builder.on("change keyup blur input",'table.charitable-campaign-suggested-donations input[type="text"].campaign_suggested_donations',(function(e){var theIndex=$(this).index('.charitable-campaign-suggested-donations input[type="text"].campaign_suggested_donations'),field_name=$(this).attr("name");if(field_name.indexOf("recurring")<1){app.updateSuggestDonationsSettings($(this),theIndex)}}));$builder.on("change",'.charitable-campaign-builder-allow-custom-donations input[type="checkbox"]',(function(e){$('.charitable-campaign-builder-allow-custom-donations input[type="checkbox"]').prop("checked",$(this).is(":checked"));app.updateAllowCustomDonationSettings($(this).is(":checked"))}));$builder.on("change",'input[type="radio"].campaign_suggested_donations',(function(e){var field_id=parseInt($(this).closest(".charitable-panel-field").data("field-id")),field_name=$(this).attr("name");if(field_name.indexOf("recurring")<1){app.updateSuggestedDonationAmountDefault($(this).val())}}));app.bindUIInputRange();$builder.on("click",".education-buttons button.update-to-pro-link",(function(e){if($(this).prev("a").length>0){window.open($(this).prev("a").attr("href"),"_blank")}else{window.open("https://wpcharitable.com/lite-vs-pro/","_blank")}}))},bindUILayoutOptionsAdvanced:function(){$builder.on("change","select#charitable-design-layout-options-advanced-tab-style",(function(e){e.preventDefault();var $this=$(this),$preview_nav=$("nav.charitable-campaign-preview-nav");$($this).find("option").each((function(){$preview_nav.removeClass("tab-style-"+this.value)}));$preview_nav.addClass("tab-style-"+$this.find(":selected").val())}));$builder.on("change","select#charitable-design-layout-options-advanced-tab-size",(function(e){e.preventDefault();var $this=$(this),$preview_nav=$("nav.charitable-campaign-preview-nav");$($this).find("option").each((function(){$preview_nav.removeClass("tab-size-"+this.value)}));$preview_nav.addClass("tab-size-"+$this.find(":selected").val())}))},tabGroupsAdd:function(el,e){e.preventDefault();var count=elements.$sortableTabContent.find(".tab_content_item").length;if(count>=s.maxNumberOfTabs){app.formGenericNotice("You cannot have more than "+s.maxNumberOfTabs+" tabs in your campaign template.");return}var $this=$(el),$groupLast=$this.parent().find(".charitable-group.charitable-layout-options-tab-group.hidden").last(),$newGroup=$groupLast.clone(),tab_content=elements.$preview.find(".tab-content"),default_tab_content_type="html";var dataList=$(".charitable-group.charitable-layout-options-tab-group").map((function(){return parseInt($(this).attr("data-group_id"))})).get();var groupID=Math.max.apply(null,dataList)+1;if(typeof groupID==="undefined"){app.formGenericError("Error ecountered attempting to add another tab.");return}$newGroup.attr("data-group_id",groupID);$newGroup.attr("data-tab-id",groupID);$newGroup.find(".charitable-group-row").attr("data-tab-id",groupID);$newGroup.find("input, select, textarea, label").each((function(index){var $this=$(this),forAttr=$this.attr("for"),nameAttr=$this.attr("name"),idAttr=$this.attr("id");if(typeof idAttr!=="undefined"&&idAttr!==false){$this.attr("id",$this.attr("id").replace("_xxx_","_"+groupID+"_"))}if(typeof nameAttr!=="undefined"&&nameAttr!==false){$this.attr("name",$this.attr("name").replace("_xxx_","_"+groupID+"_"))}if(typeof forAttr!=="undefined"&&forAttr!==false){$this.attr("for",$this.attr("for").replace("_xxx_","_"+groupID+"_"))}}));$newGroup.find('input[name="tabs__'+groupID+'__title"]').val("New Tab");$newGroup.find('textarea[name="tabs__'+groupID+'__desc"]').html("Content");$(".charitable-layout-options-tab-group").removeClass("active");$newGroup.addClass("active");$newGroup.removeClass("charitable-closed").addClass("charitable-open").removeClass("hidden").find(".charitable-angle-right").removeClass("charitable-angle-right").addClass("charitable-angle-down");$this.before($newGroup);app.bindUIActionPanelsTabs();app.checkHideTabNavigation();$("nav.charitable-campaign-preview-nav ul li").removeClass("active");tab_content.find("ul li").removeClass("active");$("nav.charitable-campaign-preview-nav ul").append('<li data-tab-type="html" data-tab-id="'+groupID+'" class="tab_title active" id="tab_'+groupID+'_title"><a href="#">'+charitable_builder.new_tab+"</a></li>");tab_content.find("ul").append('<li id="tab_'+groupID+'_content" class="tab_content_item empty-tab active tab_type_'+default_tab_content_type+'" data-tab-type="'+default_tab_content_type+'" data-tab-id="'+groupID+'"><div class="charitable-tab-wrap ui-sortable"><p class="empty-tab-notice">'+charitable_builder.empty_tab+"</p></div></li>");tab_content.removeClass("empty-tabs");tab_content.find(".no-tab-notice").remove();$builder.trigger("charitableAddNewTab",groupID)},bindUITabs:function(){$builder.on("click","button.charitable-tab-groups-add",(function(e){app.tabGroupsAdd(this,e)}));$builder.find(".charitable-layout-options-tab-tabs .charitable-layout-options-group-inner").sortable({handle:".charitable-draggable",update:function(event,ui){var dataList=$(".charitable-group.charitable-layout-options-tab-group").map((function(){if(!$(this).hasClass("hidden")){return parseInt($(this).attr("data-group_id"))}})).get();var activeList=$(".charitable-group.charitable-layout-options-tab-group").map((function(){if($(this).hasClass("active")){return parseInt($(this).attr("data-group_id"))}})).get();$("nav.charitable-campaign-preview-nav ul").empty();dataList.forEach((function(groupID){var $tab=$("#charitable-field-options").find('[data-group_id="'+groupID+'"]'),textFieldnName=groupID,isActive=activeList.indexOf(groupID)>=0?"active":"",tabType=groupID!==0&&""!==$tab.find('input[name="tabs__'+textFieldnName+'__type"').val()?$tab.find('input[name="tabs__'+textFieldnName+'__type"').val():"html",tabTitle=$tab.find('input[name="tabs__'+textFieldnName+'__title"').val();$("nav.charitable-campaign-preview-nav ul").append('<li data-tab-type="'+tabType+'" data-tab-id="'+groupID+'" class="tab_title '+isActive+'" id="tab_'+groupID+'_title"><a href="#">'+tabTitle+"</a></li>")}))}});$builder.on("click","input, select, textarea, .ql-editor",".charitable-layout-options-tab-tabs .charitable-layout-options-group-inner .charitable-layout-options-tab-group",(function(e){if(!$(this).closest(".charitable-layout-options-tab-group").hasClass("active")){var group_id=$(this).closest(".charitable-layout-options-tab-group").data("group_id");$('.charitable-preview nav.charitable-campaign-preview-nav li[data-tab-id="'+group_id+'"] a').click()}}));$builder.on("click","a.charitable-configure-tab-settings",(function(e){app.fieldTabToggle("layout-options");$(".charitable-layout-options-tab").removeClass("active");$(".charitable-layout-options-tab.charitable-layout-options-tab-tabs").addClass("active")}));$builder.on("click","nav li.tab_title a",(function(e){e.preventDefault();var $preview=$(".charitable-campaign-preview"),tab_id=$(this).parent().data("tab-id"),tab_type=$preview.find("li#tab_"+tab_id+"_title").attr("data-tab-type");$(".tab-content ul li").removeClass("active");$("nav li.tab_title").removeClass("active");$(this).parent().addClass("active");$(".tab-content ul li#tab_"+tab_id+"_content").addClass("active");$(".charitable-layout-options-tab").removeClass("active");$(".charitable-layout-options-tab.charitable-layout-options-tab-tabs").addClass("active");$(".charitable-layout-options-tab").find(".charitable-layout-options-tab-group").each((function(){$(this).removeClass("charitable-open");var cookieValue=wpCookies.get("charitable_panel_layout_options_tabs_tab_open_"+$(this).data("group_id"));if(cookieValue==="true"){$(this).addClass("charitable-open");$(this).find(".charitable-general-layout-heading a.charitable-toggleable-group i").addClass("charitable-angle-down");$(this).find(".charitable-general-layout-heading a.charitable-toggleable-group i").removeClass("charitable-angle-right");$(this).removeClass("charitable-closed")}else{$(this).removeClass("charitable-open");$(this).find(".charitable-general-layout-heading a.charitable-toggleable-group i").removeClass("charitable-angle-down");$(this).find(".charitable-general-layout-heading a.charitable-toggleable-group i").addClass("charitable-angle-right");$(this).addClass("charitable-closed")}}));$(".charitable-layout-options-tab .charitable-group").removeClass("active");$(".charitable-layout-options-tab").find("[data-group_id="+tab_id+"]").addClass("active").removeClass("charitable-closed");$(".charitable-layout-options-tab").find("[data-group_id="+tab_id+"]").find(".charitable-group-rows").show();$(".charitable-layout-options-tab").find("[data-group_id="+tab_id+"]").find(".charitable-toggleable-group i").removeClass(".charitable-angle-right").addClass("charitable-angle-down");$("#layout-options a").click();$("#charitable-preview-tab-container").addClass("active");wpCookies.set("charitable_panel_tab_section_tab_id",tab_id,2592e3);wpCookies.set("charitable_panel_layout_options_tabs_tab_open_"+tab_id,true,2592e3);wpCookies.set("charitable_panel_content_section","",2592e3);wpCookies.set("charitable_panel_active_field_id","",2592e3)}));$builder.on("change",".charitable-group select.tab_type",(function(e){e.preventDefault();var $this=$(this),group_id=$this.closest(".charitable-group").data("group_id"),$preview=$(".charitable-campaign-preview"),selected_value=$this.val();$preview.find("nav li.tab_title[data-tab-id="+group_id+"]").attr("data-tab-type",selected_value);$preview.find("div.tab-content ul li#tab_"+group_id+"_content").attr("data-tab-type",selected_value);$preview.find("div.tab-content ul li#tab_"+group_id+"_content").removeClass((function(index,className){return(className.match(/(^|\s)tab_type_\S+/g)||[]).join(" ")}));$preview.find("div.tab-content ul li#tab_"+group_id+"_content").addClass("tab_type_"+selected_value);var data={action:"charitable_tab_content_preview",type:selected_value,group_id:group_id,nonce:charitable_builder.nonce};return $.post(charitable_builder.ajax_url,data,(function(response){if(response.success){$preview.find("div.tab-content ul li#tab_"+group_id+"_content").html(response.data.output)}else{app.formSaveError(response.data)}})).fail((function(xhr,textStatus,e){app.formSaveError()})).always((function(){}))}));$builder.on("input","input#charitable-panel-field-settings-charitable-campaign-enable-tabs",(function(e){const isChecked=$(this).is(":checked");if(isChecked){$("#charitable-preview-tab-container").addClass("disabled");$("#charitable-design-layout-options-advanced-tab-style").prop("disabled",true).addClass("disabled");$("#charitable-design-layout-options-advanced-tab-size").prop("disabled",true).addClass("disabled")}else{$("#charitable-preview-tab-container").removeClass("disabled");$("#charitable-design-layout-options-advanced-tab-style").prop("disabled",false).removeClass("disabled");$("#charitable-design-layout-options-advanced-tab-size").prop("disabled",false).removeClass("disabled")}}));$builder.on("input","input.charitable-settings-tab-visible-nav",(function(e){const isChecked=$(this).is(":checked"),tabID=$(this).closest(".charitable-tab-title-row").data("tab-id");if(isChecked){elements.$preview.find("nav li#tab_"+tabID+"_title").addClass("charitable-tab-hide")}else{elements.$preview.find("nav li#tab_"+tabID+"_title").removeClass("charitable-tab-hide")}}));$builder.on("keydown",'.charitable-tab-title-row input[type="text"]',(function(e){var k=e.keyCode||e.which,ok=k>=65&&k<=90||k>=96&&k<=105||k>=35&&k<=40||k==32||e.ctrlKey&&k==65||e.ctrlKey&&k==67||e.ctrlKey&&k==88||e.ctrlKey&&k==86||e.metaKey&&k==65||e.metaKey&&k==67||e.metaKey&&k==88||e.metaKey&&k==86||k>=96&&k<=105||(k==110||k==190)||k>=37&&k<=40||k==46||k==173||k==8||k>=48&&k<=57;if(!ok||e.ctrlKey&&e.altKey){e.preventDefault()}}));$builder.on("change",'.charitable-tab-title-row input[type="text"]',(function(e){if($(this).val().trim()===""){$(this).val("New Tab")}}))},bindUIInputRange:function(){$builder.on("mouseenter",'input[type="range"].charitable-indicator-on-hover, .charitable-panel-field-align a',(function(e){var field_id=parseInt($(this).closest(".charitable-panel-field").data("field-id"));if(field_id>0){elements.$preview.find("#charitable-field-"+field_id+" .charitable-preview-field-indicator").removeClass("charitable-hidden")}}));$builder.on("mouseleave",'input[type="range"].charitable-indicator-on-hover, .charitable-panel-field-align a',(function(e){var field_id=parseInt($(this).closest(".charitable-panel-field").data("field-id"));if(field_id>0){elements.$preview.find("#charitable-field-"+field_id+" .charitable-preview-field-indicator").addClass("charitable-hidden")}}))},bindAutoResizeCampaignTitle:function(){$builder.on("input","input#charitable_settings_title",(function(e){var $this=$(this),the_text=$this.val(),the_text_characters=the_text.length,the_padding=10,the_input_box_width=the_text_characters*12.8+the_padding;wpchar.debug(the_text);wpchar.debug(the_text_characters);wpchar.debug($("#charitable_settings_title").val());app.setCampaignNotSaved();app.updateFormUI("title",the_text);app.resizeTopCampaignTitleInputBox()}));$builder.on("focusout","input#charitable_settings_title",(function(e){}))},resizeTopCampaignTitleInputBox:function(){},bindCampaignTitleBlockTextField:function(){$builder.on("keyup","input.charitable-campaign-builder-title",(function(e){app.updateFormUI("title",$(this).val())}))},bindUIEditCampaignTitle:function(){},allowTitleUpdate:function($container){if($container.hasClass("edit")){$("#charitable_settings_title").attr("disabled",true);$container.removeClass("edit")}else{$("#charitable_settings_title").removeAttr("disabled");$container.addClass("edit");$("#charitable_settings_title").focus().select()}},bindUIActionsPanels:function(){$builder.on("click","#charitable-panels-toggle button:not(.charitable-panel-help-button), .charitable-panel-switch",(function(e){e.preventDefault();if(!$(this).hasClass("disabled")){app.panelSwitch($(this).data("panel"))}}));$builder.on("click",".charitable-panel .charitable-panel-sidebar-section:not(.charitable-need-upgrade):not(.charitable-not-available):not(.charitable-not-installed):not(.charitable-not-activated):not(.charitable-installed-refresh):not(.charitable-not-available):not(.charitable-addon-file-missing)",(function(e){app.panelSectionSwitch(this,e)}));$builder.on("click",".charitable-panels .charitable-panel-sidebar-content .charitable-panel-sidebar-toggle",(function(){$(this).parent().toggleClass("charitable-panel-sidebar-closed")}));$builder.on("focusout",'input[name="tabs__campaign__title"]',(function(e){e.preventDefault();app.updateFormUI("tabs__campaign__title",$(this).val())}));app.bindUIActionPanelsTabs()},bindUIActionPanelsTabs:function(){$builder.on("input",'.charitable-tab-title-row input[type="text"]',(function(e){e.preventDefault();var $textBox=$(this),$the_element=$textBox.closest(".charitable-group"),theGroupID=$the_element.attr("data-group_id"),updatedText=0===$textBox.val().length?"New Tab":$textBox.val(),updatedTextClean=app.removeTags(updatedText);$the_element.find(".charitable-general-layout-heading").find("span").html(updatedTextClean);$("nav.charitable-campaign-preview-nav ul").find("#tab_"+theGroupID+"_title a").html(updatedTextClean)}))},checkHideTabNavigation:function(){const tab_count=$("#charitable-field-options .charitable-layout-options-tab-group").length-1;if(tab_count>1){$("#charitable-field-options").find("input.charitable-settings-tab-visible-nav").each((function(){$(this).prop("checked",false).attr("disabled",true);$(this).parent().find("label").addClass("charitable-disabled");elements.$preview.find("nav.charitable-campaign-preview-nav li").removeClass("charitable-tab-hide")}))}else{$("#charitable-field-options").find("input.charitable-settings-tab-visible-nav").each((function(){$(this).removeAttr("disabled");$(this).parent().find("label").removeClass("charitable-disabled")}))}},removeTags:function(theString){return theString},panelSwitch:function(panel){var $panel=$("#charitable-panel-"+panel),$panelBtn=$(".charitable-panel-"+panel+"-button"),cookieName="charitable_panel";if(!app.hasTemplate()&&panel!=="template"){return}if(!$panel.hasClass("active")){const event=CharitableUtils.triggerEvent($builder,"charitablePanelSwitch",[panel]);if(event.isDefaultPrevented()||!charitable_panel_switch){return false}$("#charitable-panels-toggle").find("button").removeClass("active");$(".charitable-panel").removeClass("active");$panelBtn.addClass("active");$panel.addClass("active");history.replaceState({},null,wpchar.updateQueryString("view",panel));$builder.trigger("charitablePanelSwitched",[panel]);wpCookies.set(cookieName,panel,2592e3);wpCookies.set("charitable_panel_content_section","",2592e3)}},panelSectionSwitch:function(el,e){if(e){e.preventDefault()}var $this=$(el),$panel=$this.parent().parent(),section=$this.data("section"),$sectionButtons=$panel.find(".charitable-panel-sidebar-section"),$sectionButton=$panel.find(".charitable-panel-sidebar-section-"+section);if($this.hasClass("upgrade-modal")||$this.hasClass("education-modal")){return}if(!$sectionButton.hasClass("active")){app.panelSectionSwitchTo(section,$panel,$sectionButtons,$sectionButton)}},panelSectionSwitchTo:function(section,$panel,$sectionButtons,$sectionButton){const event=CharitableUtils.triggerEvent($builder,"charitablePanelSectionSwitch",section);if(event.isDefaultPrevented()||!charitable_panel_switch){return false}$sectionButtons.removeClass("active");$sectionButton.addClass("active");$panel.find(".charitable-panel-content-section").hide();$panel.find(".charitable-panel-content-section-"+section).show();var cookieName="charitable_panel_content_section";wpCookies.set(cookieName,section,2592e3)},bindUIActionsFields:function(){$builder.on("click",".charitable-tab a",(function(e){e.preventDefault();app.fieldTabToggle($(this).parent().attr("id"));if("add-layout"===$(this).parent().attr("id")){app.resetPreviewArea()}}));$builder.on("click",".charitable-layout-options-tab-tabs .charitable-toggleable-group",(function(e){e.preventDefault();app.fieldGroupTogglev2($(this),"click")}));$builder.on("click",".charitable-add-fields .charitable-toggleable-group",(function(e){e.preventDefault();app.fieldGroupTogglev3($(this),"click")}));$builder.on("click",".charitable-tab-group-delete",(function(e){e.preventDefault();e.stopPropagation();if(app.isFormPreviewActionsDisabled(this)){return}var $the_element=$(this).closest(".charitable-group"),theGroupID=$the_element.attr("data-group_id");app.tabDelete(theGroupID)}));$builder.on("click",".charitable-field",(function(e){if(e.target.classList.contains("charitable-dismiss-button")){return}e.stopPropagation();$(this).find(".charitable-field-edit").click()}));$builder.on("click",".charitable-field-delete",(function(e){e.preventDefault();e.stopPropagation();var confirmation=$(this).parent().hasClass("charitable-missing-addon-content")?false:true,field_id=parseInt($(this).closest(".charitable-field").data("field-id"));app.fieldDelete(field_id,confirmation)}));$builder.on("click",".charitable-field-duplicate",(function(e){e.preventDefault();e.stopPropagation();app.fieldDuplicate($(this).parent().data("field-id"))}));$builder.on("click",".charitable-field-edit",(function(e){e.preventDefault();e.stopPropagation();app.resetPreviewArea();$(this).parent().addClass("active");$("ul.charitable-tabs li#add-layout a").removeClass("active");$("ul.charitable-tabs li#layout-options a").addClass("active");var field_id=parseInt($(this).parent().data("field-id"));wpCookies.set("charitable_panel_active_field_id",field_id,2592e3);app.fieldEdit($(this).data("type"),$(this).data("section"),$(this).parent().data("field-id"),field_id,$(this).parent().data("field-type"))}));$builder.on("click",".charitable-add-fields-button",(function(e){e.preventDefault();const $field=$(this);if($field.hasClass("ui-draggable-disabled")){return}let type=$field.data("field-type"),event=CharitableUtils.triggerEvent($builder,"charitableBeforeFieldAddOnClick",[type,$field]);if(event.isDefaultPrevented()){return}app.fieldAdd(type,{$sortable:"default"})}));$builder.on("charitableFieldAdd",(function(event,id,type){const fieldTypes=["campaign-title","campaign-description","campaign-overview","progress-bar","donation-options","social-sharing","social-links","photo","organizer","html","donate-button","donate-amount","campaign-summary","donate-form","donor-wall","shortcode","text","video"];if($.inArray(type,fieldTypes)!==-1){app.fieldChoiceSortable(type,`#charitable-field-option-row-${id}-choices ul`)}else{}}));$builder.on("click",".charitable-group-toggle",(function(e){const event=CharitableUtils.triggerEvent($builder,"charitableFieldOptionGroupToggle");if(event.isDefaultPrevented()){return false}e.preventDefault();app.resetPreviewArea();var $group=$(this).closest(".charitable-layout-options-tab");$group.siblings(".charitable-layout-options-tab").removeClass("active");$group.addClass("active");if($(this).parent().hasClass("charitable-layout-options-tab-tabs")){$("#charitable-preview-tab-container").toggleClass("active")}else{$("#charitable-preview-tab-container").removeClass("active")}if($(this).parent().hasClass("charitable-layout-options-tab-general")){wpCookies.set("charitable_panel_design_layout_options_group","general",2592e3)}else if($(this).parent().hasClass("charitable-layout-options-tab-tabs")){wpCookies.set("charitable_panel_design_layout_options_group","tabs",2592e3)}else if($(this).parent().hasClass("charitable-layout-options-tab-advanced")){wpCookies.set("charitable_panel_design_layout_options_group","advanced",2592e3)}wpCookies.set("charitable_panel_active_field_id","",2592e3);$(".charitable-layout-options-tab-general .charitable-layout-options-group-inner").html();$(".charitable-campaign-preview .charitable-select-field").removeClass("active")}));$builder.on("click",".charitable-field-edit",(function(e){e.preventDefault();$("#layout-options a").addClass("active");$(".charitable-add-fields").hide();$(".charitable-field-options").show();var $group=$(".charitable-layout-options-tab-general");$group.siblings(".charitable-layout-options-tab").removeClass("active");$group.addClass("active")}));$builder.on("click",(function(){app.focusOutEvent()}));app.photoFieldEvents($builder);app.campaignSummaryEvents($builder);app.socialSharingEvents($builder);app.socialLinkingEvents($builder);app.donateButtonEvents($builder);app.donateWallEvents($builder);app.progressBarEvents($builder);app.shortcodeEvents($builder);app.organizerEvents($builder);app.cssTextFieldEvents($builder);app.textFieldEvents($builder);app.headlineEvents($builder);app.numberSliderEvents($builder);app.alignFieldEvents($builder);/ *highlights */;app.highlightEvents($builder);app.advancedLayoutOptionsEvents($builder);app.previewHover($builder);app.goalEvents($builder);app.endDateEvents($builder)},endDateEvents:function($builder){$builder.on("change","#charitable-panel-field-settings-campaign_end_date",(function(e){app.updateEndDateRelatedItems($(this).val())}))},updateEndDateRelatedItems:function(endDate="",theField=$("#charitable-panel-field-settings-campaign_end_date")){if(endDate===""){if(theField.length){endDate=theField.val()}}if(endDate.trim()===""){wpchar.debug("updateEndDateRelatedItems - no end date");elements.$preview.find(".charitable-field-campaign-summary").each((function(){var field_id=$(this).attr("data-field-id");$(this).find(".campaign-time-left.campaign-summary-item").addClass("charitable-hidden");wpchar.debug($('input[name="_fields['+field_id+"][show_hide][campaign_hide_time_remaining]"));elements.$fieldOptions.find('input[name="_fields['+field_id+"][show_hide][campaign_hide_time_remaining]").attr("disabled",true).addClass("charitable-disabled").prop("checked",false).next().addClass("charitable-disabled")}))}else{wpchar.debug("updateEndDateRelatedItems - there is an end date");elements.$preview.find(".charitable-field-campaign-summary").each((function(){var field_id=$(this).attr("data-field-id");elements.$fieldOptions.find('input[name="_fields['+field_id+"][show_hide][campaign_hide_time_remaining]").attr("disabled",false).removeClass("charitable-disabled").next().removeClass("charitable-disabled")}))}},goalEvents:function($builder){$builder.on("change","#charitable-panel-field-settings-campaign_goal",(function(e){app.updateGoalRelatedItems($(this).val())}))},updateGoalRelatedItems:function(goalAmount="",theField=$("#charitable-panel-field-settings-campaign_goal")){wpchar.debug(goalAmount,"goalAmount");if(goalAmount===""){if(theField.length){goalAmount=theField.val()}}if(goalAmount===""||goalAmount==="0"||goalAmount==="0.00"){wpchar.debug("updateGoalRelatedItems - checkpoint 0");elements.$preview.find(".charitable-field-progress-bar .progress").addClass("charitable-campaign-preview-not-available").addClass("charitable-hidden");elements.$preview.find(".charitable-field-campaign-summary").each((function(){var field_id=$(this).attr("data-field-id");$(this).find(".campaign-raised.campaign-summary-item").addClass("charitable-hidden");wpchar.debug(elements.$fieldOptions.find('input[name="_fields['+field_id+"][show_hide][campaign_hide_percent_raised]"));elements.$fieldOptions.find('input[name="_fields['+field_id+"][show_hide][campaign_hide_percent_raised]").prop("checked",false).attr("disabled",true).addClass("charitable-disabled").next().addClass("charitable-disabled")}));elements.$preview.find(".charitable-field-progress-bar .campaign-goal").each((function(){var goalLabel=$(this).find("span").html();$(this).html("<span>"+goalLabel+"</span>"+"∞")}))}else{var regex_decemial=/^\d+\.\d+$/,regex_comma=/^\d+\,\d+$/;if(regex_comma.test(goalAmount)){wpchar.debug("updateGoalRelatedItems - checkpoint 1");app.updateGoalisPresentRelatedUI();elements.$preview.find(".charitable-field-progress-bar .campaign-goal").each((function(){var goalLabel=$(this).find("span").html(),santitizedValue=parseFloat(goalAmount).toFixed(2);wpchar.debug(charitable_builder.currency_symbol+goalAmount);$(this).html("<span>"+goalLabel+"</span>"+" "+charitable_builder.currency_symbol+goalAmount)}))}else if(regex_decemial.test(goalAmount)){wpchar.debug("updateGoalRelatedItems - checkpoint 2");app.updateGoalisPresentRelatedUI();elements.$preview.find(".charitable-field-progress-bar .campaign-goal").each((function(){var goalLabel=$(this).find("span").html(),santitizedValue=parseFloat(goalAmount).toFixed(2);santitizedValue=goalAmount.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",");$(this).html("<span>"+goalLabel+"</span>"+" "+charitable_builder.currency_symbol+santitizedValue)}))}else{wpchar.debug("updateGoalRelatedItems - checkpoint 3");app.updateGoalisPresentRelatedUI();goalAmount=goalAmount.replace(/[^0-9\.\,]/g,"");elements.$preview.find(".charitable-field-progress-bar .campaign-goal").each((function(){var goalLabel=$(this).find("span").html();$(this).html("<span>"+goalLabel+"</span>"+" "+charitable_builder.currency_symbol+goalAmount)}))}}},updateGoalisPresentRelatedUI:function(){elements.$preview.find(".charitable-field-campaign-summary").each((function(){var field_id=$(this).attr("data-field-id"),$preview_summary=$(this);if($('input[name="_fields['+field_id+"][show_hide][campaign_hide_percent_raised]").is(":checked")){if(!$(this).hasClass("charitable-hidden")){$preview_summary.find(".campaign-raised.campaign-summary-item").removeClass("charitable-hidden")}}elements.$fieldOptions.find('input[name="_fields['+field_id+"][show_hide][campaign_hide_percent_raised]").attr("disabled",false).removeClass("charitable-disabled").next().removeClass("charitable-disabled")}));elements.$preview.find(".charitable-field-progress-bar .progress").removeClass("charitable-campaign-preview-not-available").removeClass("charitable-hidden")},highlightEvents:function($builder){$builder.on("click","a.charitable-addon-installed-charitable-lite, a.charitable-addon-installed-charitable-pro",(function(e){e.preventDefault();if($(this).hasClass("charitable-addon-recurring-donations")){elements.$settingsPanel.find(".charitable-panel-fields-group-recurring-donations").removeClass("charitable-highlight");$("a.charitable-panel-sidebar-section-donation-options").click();elements.$settingsPanel.find(".charitable-panel-fields-group-recurring-donations").addClass("charitable-highlight")}}));$builder.on("webkitAnimationEnd oanimationend msAnimationEnd animationend",".charitable-panel-fields-group-recurring-donations",(function(e){elements.$settingsPanel.find(".charitable-panel-fields-group-recurring-donations").removeClass("charitable-highlight")}))},advancedLayoutOptionsEvents:function($builder){$builder.on("change","select#charitable-design-layout-options-show-field-names",(function(e){const theField=$(this);if(theField.val()==="hide"){elements.$formPreview.addClass("charitable-preview-hide-field-names")}else if(theField.val()==="show"){elements.$formPreview.removeClass("charitable-preview-hide-field-names")}}));$builder.on("change","select#charitable-design-layout-options-preview-mode",(function(e){const theField=$(this);if(theField.val()==="normal"){elements.$formPreview.removeClass("charitable-preview-minimum-preview")}else if(theField.val()==="minimum"){elements.$formPreview.addClass("charitable-preview-minimum-preview")}}))},previewHover:function($builder){$builder.on("mouseover",".charitable-view-campaign-external-link",(function(e){elements.$formPreview.addClass("charitable-preview-live")}));$builder.on("mouseleave",".charitable-view-campaign-external-link",(function(e){elements.$formPreview.removeClass("charitable-preview-live")}))},donateButtonEvents:function($builder){$builder.on("input",'.charitable-panel-field-text input[type="text"].charitable-campaign-builder-donate-button-button-label',(function(e){const theTextBox=$(this),field_id=theTextBox.closest(".charitable-panel-field").data("field-id");app.updateDonateButtonPreview(field_id,theTextBox.attr("name"),theTextBox.val())}))},updateDonateButtonPreview:function(field_id=0,textFieldName="",label_value="Donate"){const preview_field=$("#charitable-field-"+field_id);label_value=label_value.length>0?CharitableUtils.santitizeTextInput(label_value):"Donate";preview_field.find(".placeholder").html(label_value)},donateWallEvents:function($builder){$builder.on("input",".charitable-panel-field.charitable-campaign-builder-donor-wall input, .charitable-panel-field.charitable-campaign-builder-donor-wall select",(function(e){const theFormField=$(this),field_id=theFormField.closest(".charitable-panel-field").data("field-id");app.updateDonateWallPreview(field_id,theFormField)}))},updateDonateWallPreview:function(field_id=0,theFormField){var data={};$('.charitable-panel-field.charitable-campaign-builder-donor-wall[data-field-id="'+field_id+'"]').each((function(){var theArea=$(this);theArea.find('input.charitable-checkbox-for-toggle[type="checkbox"]:checked').each((function(){var theName=$(this).closest('.charitable-toggle-control[data-field-id="'+field_id+'"]').data("ajax-label");if($(this).is(":checked")){data[theName]=$(this).val()}else{data[theName]=0}}));theArea.find('input[type="radio"]:checked,input[type="text"],input[type="number"],select').each((function(){var theName=$(this).closest('.charitable-panel-field[data-field-id="'+field_id+'"]').data("ajax-label");data[theName]=$(this).val()}));data.campaign_id=s.formID;data.field_type="donation-wall";data.field_id=field_id;data.action="charitable_builder_field_content_preview",data.nonce=charitable_builder.nonce}));app.disableFormActions();$('.charitable-layout-options-tab-general .charitable-panel-field[data-field-id="'+field_id+'"]').addClass("charitable-loading");$("#charitable-field-"+field_id+" .charitable-preview-field-container span.placeholder").addClass("charitable-loading").parent().prepend('<div class="charitable-loading-spinner preview-ajax"></div>');return $.post(charitable_builder.ajax_url,data,(function(res){if(!res.success){wpchar.debug("Add field AJAX call is unsuccessful:",res);return}$("#charitable-field-"+field_id+" .charitable-preview-field-container").replaceWith(res.data.output);var theTextBox=$('.charitable-panel-field-text[data-field-id="'+field_id+'"] input[type="text"].charitable-campaign-builder-headline');app.updateHeadlinePreview(field_id,theTextBox.attr("name"),theTextBox.val(),theTextBox);app.enableFormActions();$('.charitable-layout-options-tab-general .charitable-panel-field[data-field-id="'+field_id+'"]').removeClass("charitable-loading");$("#charitable-field-"+field_id+" .charitable-preview-field-container span.placeholder").removeClass("charitable-loading").parent().remove(".charitable-loading")})).fail((function(xhr,textStatus,e){wpchar.debug("Add field AJAX call failed:",xhr.responseText);$('.charitable-layout-options-tab-general .charitable-panel-field[data-field-id="'+field_id+'"]').removeClass("charitable-loading");$("#charitable-field-"+field_id+" .charitable-preview-field-container span.placeholder").removeClass("charitable-loading").parent().remove(".charitable-loading")})).always((function(){}))},progressBarEvents:function($builder){$builder.on("change",".charitable-panel-field.charitable-campaign-builder-progress-bar input, .charitable-panel-field.charitable-campaign-builder-progress-bar select",(function(e){var theFormField=$(this),field_id=theFormField.attr("data-field-id");app.progressBarEventsPreview(field_id,theFormField)}));$builder.on("keyup",".charitable-panel-field.charitable-panel-field-text input.donate_label, .charitable-panel-field.charitable-panel-field-text input.donate_goal",(function(e){var theFormField=$(this),field_id=theFormField.attr("data-field-id");app.progressBarEventsPreviewLabels(field_id,theFormField)}))},progressBarEventsPreviewLabels:function(field_id=0,theFormField=""){const preview_field=$("#charitable-field-"+field_id);if(theFormField.hasClass("donate_label")){preview_field.find(".campaign-percent-raised span").html(theFormField.val())}if(theFormField.hasClass("donate_goal")){preview_field.find(".campaign-goal span").html(theFormField.val())}},progressBarEventsPreview:function(field_id=0,theFormField=""){const preview_field=$("#charitable-field-"+field_id);if(theFormField.val()==="show_donated"){preview_field.find(".campaign-percent-raised").toggleClass("charitable-hidden")}if(theFormField.val()==="show_goal"){preview_field.find(".campaign-goal").toggleClass("charitable-hidden")}},cssTextFieldEvents:function($builder){$builder.on("input",'.charitable-panel-field-text input[data-ajax-label="css_class"]',(function(e){const theTextBox=$(this),textboxString=CharitableUtils.santitizeCSSInput(theTextBox.val());$(this).val(textboxString);app.setCampaignNotSaved()}))},textFieldEvents:function($builder){$builder.on("input",'.charitable-panel-field-text input[type="text"][data-ajax-label!="css_class"]:not(.charitable-campaign-builder-headline, .charitable-campaign-builder-donate-button-button-label)',(function(e){const theTextBox=$(this),textboxString=CharitableUtils.santitizeTextInput(theTextBox.val());$(this).val(textboxString);app.setCampaignNotSaved()}))},headlineEvents:function($builder){$builder.on("input",'.charitable-panel-field-text input[type="text"].charitable-campaign-builder-headline',(function(e){const theTextBox=$(this),field_id=theTextBox.closest(".charitable-panel-field").data("field-id");app.updateHeadlinePreview(field_id,theTextBox.attr("name"),theTextBox.val(),theTextBox);app.setCampaignNotSaved()}))},updateHeadlinePreview:function(field_id=0,textFieldName="",label_value="",theTextBox){const preview_field=$("#charitable-field-"+field_id),headline=CharitableUtils.santitizeTitle(label_value),headline_html=label_value.length>0?'<h5 class="charitable-field-preview-headline">'+headline+"</h5>":"",tempPlaceholderContainer=preview_field.find(".charitable-placeholder").length>0?".charitable-placeholder":".placeholder",placeholderContainer=preview_field.find(".charitable-field-preview-social-sharing-headline-container").length>0?".charitable-field-preview-social-sharing-headline-container":tempPlaceholderContainer;theTextBox.val(headline);preview_field.find(placeholderContainer).find("h5.charitable-field-preview-headline").remove();preview_field.find(placeholderContainer).first().prepend(headline_html)},shortcodeEvents:function($builder){$builder.on("input",'.charitable-panel-field-text input[type="text"].charitable-campaign-builder-shortcode',(function(e){const theTextBox=$(this),field_id=theTextBox.closest(".charitable-panel-field").data("field-id");app.updateShortcodePreview(field_id,theTextBox.attr("name"),theTextBox.val())}))},updateShortcodePreview:function(field_id=0,textFieldName="",label_value=""){const preview_field=$("#charitable-field-"+field_id),headline_html=label_value.length>0?'<h5 class="charitable-field-preview-shortcode">'+label_value+"</h5>":"";preview_field.find(".placeholder.shortcode-preview").find("h5.charitable-field-preview-shortcode").remove();preview_field.find(".placeholder.shortcode-preview").first().prepend(headline_html)},organizerEvents:function($builder){$builder.on("change",".charitable-panel-field.campaign-builder-campaign-creator-id-mini select",(function(e){var theFormField=$(this),theAvatarURL=$(this).find("option:selected").data("avatar"),field_id=theFormField.closest(".charitable-panel-field").attr("data-field-id");app.organizerEventsPreview(field_id,theFormField,theAvatarURL)}))},organizerEventsPreview:function(field_id=0,theFormField="",theAvatarURL=""){$("select#charitable-panel-field-settings-campaign_campaign_creator_id").select2("val",theFormField.val());const preview_field=$("#charitable-field-"+field_id);preview_field.find(".charitable-organizer-name").html(theFormField.find("option:selected").text());preview_field.find(".charitable-organizer-image").attr("style","background-image: url("+theAvatarURL+");")},campaignSummaryEvents:function($builder){$builder.on("click",'.charitable-campaign-summary-checkboxes input[type="checkbox"]',(function(e){const theCheckbox=$(this),field_id=theCheckbox.closest(".charitable-panel-field").data("field-id");app.updateCampaignSummaryPreview(field_id,theCheckbox.attr("name"))}))},updateCampaignSummaryPreview:function(field_id=0,checkboxName=""){const preview_field=$("#charitable-field-"+field_id);if(checkboxName.indexOf("campaign_hide_percent_raised")>=0){preview_field.find(".campaign_hide_percent_raised").toggleClass("charitable-hidden")}if(checkboxName.indexOf("campaign_hide_amount_donated")>=0){preview_field.find(".campaign_hide_amount_donated").toggleClass("charitable-hidden")}if(checkboxName.indexOf("campaign_hide_number_of_donors")>=0){preview_field.find(".campaign_hide_number_of_donors").toggleClass("charitable-hidden")}if(checkboxName.indexOf("campaign_hide_time_remaining")>=0){preview_field.find(".campaign_hide_time_remaining").toggleClass("charitable-hidden")}},socialSharingEvents:function($builder){$builder.on("click",'.charitable-social-network-checkboxes input[type="checkbox"]',(function(e){const theCheckbox=$(this),field_id=theCheckbox.closest(".charitable-panel-field").data("field-id");app.updateSocialSharingPreview(field_id,theCheckbox.attr("name"))}))},updateSocialSharingPreview:function(field_id=0,checkboxName=""){const preview_field=$("#charitable-field-"+field_id);if(checkboxName.indexOf("twitter")>=0){preview_field.find(".charitable-social-sharing-preview-twitter").toggleClass("charitable-hidden")}if(checkboxName.indexOf("facebook")>=0){preview_field.find(".charitable-social-sharing-preview-facebook").toggleClass("charitable-hidden")}if(checkboxName.indexOf("linkedin")>=0){preview_field.find(".charitable-social-sharing-preview-linkedin").toggleClass("charitable-hidden")}if(checkboxName.indexOf("instagram")>=0){preview_field.find(".charitable-social-sharing-preview-instagram").toggleClass("charitable-hidden")}if(checkboxName.indexOf("tiktok")>=0){preview_field.find(".charitable-social-sharing-preview-tiktok").toggleClass("charitable-hidden")}if(checkboxName.indexOf("pinterest")>=0){preview_field.find(".charitable-social-sharing-preview-pinterest").toggleClass("charitable-hidden")}if(checkboxName.indexOf("mastodon")>=0){preview_field.find(".charitable-social-sharing-preview-mastodon").toggleClass("charitable-hidden")}if(checkboxName.indexOf("threads")>=0){preview_field.find(".charitable-social-sharing-preview-threads").toggleClass("charitable-hidden")}if(checkboxName.indexOf("bluesky")>=0){preview_field.find(".charitable-social-sharing-preview-bluesky").toggleClass("charitable-hidden")}},socialLinkingEvents:function($builder){$builder.on("input",'.charitable-panel-field-text input[type="url"].charitable-campaign-builder-social-links-text-field',(function(e){var theTextField=$(this),field_id=theTextField.attr("data-field-id");app.updateSocialLinksPreview(field_id,theTextField.attr("name"),theTextField.val())}))},updateSocialLinksPreview:function(field_id=0,textFieldName="",linkURL=""){const preview_field=$("#charitable-field-"+field_id),social_networks=["twitter","facebook","linkedin","instagram","tiktok","pinterest","mastodon","youtube","threads","bluesky"];var visibleNetworks=0;$.each(social_networks,(function(_index,network){if(textFieldName.indexOf(network)>=0&&app.isValidURL(linkURL)){preview_field.find(".charitable-social-linking-preview-"+network).removeClass("charitable-hidden")}else if(textFieldName.indexOf(network)>=0){preview_field.find(".charitable-social-linking-preview-"+network).addClass("charitable-hidden")}if(preview_field.find(".charitable-social-linking-preview-"+network).hasClass("charitable-hidden")){}else{visibleNetworks++}}));if(visibleNetworks>0){preview_field.find(".charitable-social-linking-no-links").addClass("charitable-hidden")}else{preview_field.find(".charitable-social-linking-no-links").removeClass("charitable-hidden")}},photoFieldEvents:function($builder){var file_frame;window.formfield="";$builder.on("click",".charitable-campaign-builder-upload-button",(function(e){e.preventDefault();var button=$(this),field_id=$(this).closest(".charitable-panel-field").data("field-id");window.formfield=$(this).parent().prev();window.field_id=field_id;if(file_frame){file_frame.open();return}file_frame=wp.media.frames.file_frame=wp.media({title:button.data("uploader_title"),library:{type:"image"},button:{text:button.data("uploader_button_text")},multiple:false});file_frame.on("menu:render:default",(function(view){const views={};view.unset("library-separator");view.unset("gallery");view.unset("featured-image");view.unset("embed");view.set(views)}));file_frame.on("select",(function(){const selection=file_frame.state().get("selection");selection.each((function(attachment,index){attachment=attachment.toJSON();window.formfield.val(attachment.url);app.updateImagePhotoPreview(window.field_id,attachment.url);window.field_id=false}))}));file_frame.open()}));$builder.on("click",".charitable-campaign-builder-clear-button",(function(e){e.preventDefault();const button=$(this),field_id=$(this).closest(".charitable-panel-field").data("field-id");button.closest(".charitable-internal").find('input[type="url"]').val("");app.updateImagePhotoPreview(field_id,false)}))},updateImagePhotoPreview:function(field_id=0,imageUrl=""){const preview_field=$("#charitable-field-"+field_id),preview_field_image=preview_field.find("img.charitable-campaign-builder-preview-photo");if(false===imageUrl||""===imageUrl||!app.isValidURL(imageUrl)){preview_field.find(".primary-image-container .primary-image img").remove();preview_field.find(".primary-image-container .primary-image").append('<img src="../../images/campaign-builder/fields/photo/temp-icon.svg" class="temp-icon" alt="" />');preview_field.find(".primary-image-container").removeClass("has-image")}else{preview_field.find("i.temp-icon").remove();if(preview_field_image.length>0){preview_field_image.attr("src",imageUrl)}else{preview_field.find(".primary-image-container .primary-image").append('<img src="'+imageUrl+'" class="charitable-campaign-builder-preview-photo" />');preview_field.find(".primary-image-container").addClass("has-image")}}},isValidURL:function(str){var pattern=new RegExp("^(https?:\\/\\/)?"+"((([a-z\\d]([a-z\\d-]*[a-z\\d])*)\\.)+[a-z]{2,}|"+"((\\d{1,3}\\.){3}\\d{1,3}))"+"(\\:\\d+)?(\\/[-a-z\\d%_.~+]*)*"+"(\\?[;&a-z\\d%_.~+=-]*)?"+"(\\#[-a-z\\d_]*)?$","i");return!!pattern.test(str)},resetPreviewArea:function(){elements.$formPreview.find(".charitable-field").each((function(){$(this).removeClass("active")}));$(".charitable-select-field-notice").show();$(".charitable-layout-options-tab-general .charitable-panel-field").removeClass("active");$("#charitable-preview-tab-container").removeClass("active")},fieldDelete:function(id,confirmation=true){var $field=$("#charitable-field-"+id),type=$field.data("field-type");if($field.hasClass("no-delete")){app.youCantRemoveFieldPopup();return}if(confirmation){app.confirmFieldDeletion(id,type)}else{app.fieldDeleteById(id,type)}},confirmFieldDeletion:function(id,type){var fieldData={id:id,message:charitable_builder.delete_confirm};var event=CharitableUtils.triggerEvent($builder,"charitableBeforeFieldDeleteAlert",[fieldData,type]);if(event.isDefaultPrevented()){return}$.confirm({title:false,content:fieldData.message,icon:"fa fa-exclamation-circle",type:"orange",buttons:{confirm:{text:charitable_builder.ok,btnClass:"btn-confirm",keys:["enter"],action:function(){app.fieldDeleteById(id,type)}},cancel:{text:charitable_builder.cancel,keys:["esc"]}}})},confirmCampaignDeletion:function(){$builder.on("click",".charitable-button.alert.delete-campaign",(function(e){e.preventDefault();$.alert({title:false,content:charitable_builder.campaign_delete_confirm,icon:"fa fa-info-circle",type:"red",buttons:{confirm:{text:charitable_builder.ok,btnClass:"btn-confirm",keys:["enter"],action:function(){}},cancel:{text:charitable_builder.cancel,keys:["esc"]}}})}))},fieldDeleteById:function(id=false,type="",duration=200){if(id===false){return}$(`#charitable-field-${id}`).fadeOut(duration,(function(){const $field=$(this),section=$field.closest(".charitable-field-section"),type=$field.data("field-type"),max=typeof $field.data("field-max")!=="undefined"?parseInt($field.data("field-max")):99;$builder.trigger("charitableBeforeFieldDelete",[id,type]);$field.remove();$("#charitable-field-option-"+id).remove();$(".charitable-field, .charitable-preview-top-bar").removeClass("active");$('.charitable-layout-options-tab-general .charitable-panel-field[data-field-id="'+id+'"]').remove();$(".charitable-select-field-notice").show();app.checkNoFieldsPreview();app.checkFieldTargetState(section);if(max===0||elements.$preview.find(".charitable-field.charitable-field-donate-amount").length<max){$("#charitable-panel-design button#charitable-add-fields-donate-amount").removeClass("charitable-disabled")}app.checkIfTabsAreEmpty();if($(".charitable-layout-options-tab.charitable-layout-options-tab-general").hasClass("active")){app.fieldTabToggle("add-layout")}const $fieldsOptions=$(".charitable-field-option"),$submitButton=$builder.find(".charitable-field-submit");if($fieldsOptions.length<1){elements.$sortableFieldsWrap.append(elements.$noFieldsPreview.clone());elements.$fieldOptions.append(elements.$noFieldsOptions.clone());$submitButton.hide()}if(!$fieldsOptions.filter(":not(.charitable-field-option-layout)").length){$submitButton.hide()}app.checkFieldAllow();app.checkFieldMax(type,max);app.checkRecommendedFields(type);if(wpCookies.get("charitable_panel_active_field_id")===id){wpCookies.set("charitable_panel_active_field_id","",2592e3)}app.setCampaignNotSaved();$builder.trigger("charitableFieldDelete",[id,type])}))},fieldEdit:function(type,section,edit_field_id,field_id,field_type){if(section==="general"||section==="standard"||section==="pro"||section==="recommended"){app.panelSwitch("design");$(".charitable-select-field-notice").hide();$(".charitable-layout-options-tab-general .charitable-panel-field").removeClass("active");$('.charitable-layout-options-tab-general .charitable-panel-field[data-field-id="'+field_id+'"]').addClass("active");$('.charitable-layout-options-tab-general .charitable-panel-field[data-field-id="'+field_id+'"]').find("input[type=text],input[type=button],input[type=range],input[type=url],textarea,select").filter(":visible:first").focus();if("html"===field_type){$builder.trigger("charitableFieldAddHTML",[field_id,field_type])}else{$builder.trigger("charitableFieldEdit",[type,section,edit_field_id,field_id,field_type])}}},fieldDuplicate:function(id){const $field=$(`#charitable-field-${id}`);if($field.hasClass("no-duplicate")){$.alert({title:charitable_builder.field_locked,content:charitable_builder.field_locked_no_duplicate_msg,icon:"fa fa-info-circle",type:"blue",buttons:{confirm:{text:charitable_builder.close,btnClass:"btn-confirm",keys:["enter"]}}});return}$.confirm({title:false,content:charitable_builder.duplicate_confirm,icon:"fa fa-exclamation-circle",type:"orange",buttons:{confirm:{text:charitable_builder.ok,btnClass:"btn-confirm",keys:["enter"],action:function(){this.$$confirm.prop("disabled",true);const beforeEvent=CharitableUtils.triggerEvent($builder,"charitableBeforeFieldDuplicate",[id,$field]);if(beforeEvent.isDefaultPrevented()){return}const newFieldId=app.fieldDuplicateRoutine(id),$newField=$(`#charitable-field-${newFieldId}`);CharitableUtils.triggerEvent($builder,"charitableFieldDuplicated",[id,$field,newFieldId,$newField])}},cancel:{text:charitable_builder.cancel,keys:["esc"]}}})},fieldDuplicateRoutine:function(id){const $field=$(`#charitable-field-${id}`),$fieldActiveFields=elements.$sortableFieldsWrap.find("> .active"),$fieldActiveTabs=elements.$sortableFieldsWrap.find("> .active"),$newField=$field.clone(),newFieldID=parseInt(elements.$nextFieldId.val(),10)+1,$settingsArea=$('#charitable-field-options .charitable-layout-options-group-inner .charitable-panel-field[data-field-id="'+id+'"]');if($newField){app.updateFormHiddenFieldID(newFieldID)}$field.after($newField);$fieldActiveFields.removeClass("active");$fieldActiveTabs.removeClass("active");$newField.addClass("active").attr({id:`charitable-field-${newFieldID}`,"data-field-id":newFieldID});$settingsArea.each((function(){var $newSettingsField=$(this).clone(),isContains=$newSettingsField.text().indexOf("ID:")>-1;$newSettingsField.attr("data-field-id",newFieldID);$(this).removeClass("active");$newSettingsField.addClass("active");if(isContains){$newSettingsField.text((function(index,text){return text.replace("ID: "+id,"ID: "+newFieldID)}))}if(typeof $newSettingsField.attr("name")!=="undefined"&&$newSettingsField.attr("name").length>0){$newSettingsField.attr("name",$newSettingsField.attr("name").replace(id,newFieldID))}if(typeof $newSettingsField.attr("id")!=="undefined"&&$newSettingsField.attr("id").length>0){$newSettingsField.attr("id",$newSettingsField.attr("id").replace(id,newFieldID))}$newSettingsField.find("*").each((function(){var $subField=$(this);if(typeof $subField.attr("for")!=="undefined"&&$subField.attr("for").length>0){$subField.attr("for",$subField.attr("for").replace(id,newFieldID))}if(typeof $subField.attr("name")!=="undefined"&&$subField.attr("name").length>0){$subField.attr("name",$subField.attr("name").replace(id,newFieldID))}if(typeof $subField.attr("id")!=="undefined"&&$subField.attr("id").length>0){$subField.attr("id",$subField.attr("id").replace(id,newFieldID))}if(typeof $subField.data("field-id")!=="undefined"&&$subField.data("field-id").length>0){$newSettingsField.attr("data-field-id",newFieldID)}}));$newSettingsField.find(".charitable-toggle-control").attr("data-field-id",newFieldID);$newSettingsField.find(".charitable-checkbox-for-toggle").attr("data-field-id",newFieldID);$("#charitable-field-options .charitable-layout-options-tab-general .charitable-layout-options-group-inner").append($newSettingsField);if(typeof $newSettingsField.data("special-type")!=="undefined"&&$newSettingsField.data("special-type")==="campaign_description"){let contentToCopy=$newSettingsField.find(".campaign-builder-htmleditor .ql-editor").html();$newSettingsField.find(".ql-toolbar").remove();$newSettingsField.find(".campaign-builder-htmleditor").html('<div data-textarea-name="_fields['+newFieldID+'][content]" id="charitable-panel-field-settings-field_campaign-description_html_'+newFieldID+'" class="campaign-builder-htmleditor">'+contentToCopy+"</div>");app.initHTMLEditorFields($newSettingsField.find(".campaign-builder-htmleditor"),false)}app.checkFieldAllow();app.checkFieldMax()}));return newFieldID},focusOutEvent:function(){if(elements.$focusOutTarget===null){return}elements.$focusOutTarget=null},isFormPreviewActionsDisabled:function(el){return $(el).closest(".charitable-field-wrap").hasClass("ui-sortable-disabled")},fieldGroupTogglev2:function(el,action){var $this=$(el),groupName=$this.closest(".charitable-group").data("group_id"),$nearestGroup=$this.closest(".charitable-group"),$rows=$nearestGroup.find(".charitable-group-rows"),$group=$rows.parent(),$icon=$this.find("i"),cookieName="charitable_panel_layout_options_tabs_tab_open_"+groupName;if(action==="click"){$icon.toggleClass("charitable-angle-right");$rows.stop().slideToggle("",(function(){$nearestGroup.toggleClass("charitable-closed");if($nearestGroup.hasClass("charitable-closed")){$nearestGroup.removeClass("charitable-open");wpCookies.remove(cookieName)}else{wpCookies.set(cookieName,"true",2592e3)}}));return}},fieldGroupTogglev3:function(el,action="click"){var $this=$(el),$nearestGroup=$this.closest(".charitable-add-fields-group"),$rows=$nearestGroup.find(".charitable-group-rows"),$icon=$this,groupName="test",cookieName="charitable_panel_add_layout_blocks_open_"+groupName;if(action==="click"){$icon.toggleClass("charitable-angle-right");$rows.stop().slideToggle("",(function(){$nearestGroup.toggleClass("charitable-closed");if($nearestGroup.hasClass("charitable-closed")){$nearestGroup.removeClass("charitable-open");wpCookies.remove(cookieName)}else{wpCookies.set(cookieName,"true",2592e3)}}));return}},fieldGroupToggle:function(el,action){var $this=$(el),$buttons=$this.next(".charitable-add-fields-buttons"),$group=$buttons.parent(),$icon=$this.find("i"),groupName=$this.data("group"),cookieName="charitable_field_group_"+groupName;if(groupName=="general-layout-campaign"||groupName=="general-layout-faq"){$group=$this.parent().find(".charitable-"+groupName+"-group-inner");$buttons=$group}if(action==="click"){if($group.hasClass("charitable-closed")){wpCookies.remove(cookieName)}else{wpCookies.set(cookieName,"true",2592e3)}$icon.toggleClass("charitable-angle-right");$buttons.stop().slideToggle("",(function(){$group.toggleClass("charitable-closed")}));return}else if(action==="load"){$buttons=$this.find(".charitable-add-fields-buttons");$icon=$this.find(".charitable-add-fields-heading i");groupName=$this.find(".charitable-add-fields-heading").data("group");cookieName="charitable_field_group_"+groupName;if(wpCookies.get(cookieName)==="true"){$icon.toggleClass("charitable-angle-right");$buttons.hide();$this.toggleClass("charitable-closed")}}},fieldMove:function(type,options){var $field=options.field;$field.find(".charitable-field-edit").click();$builder.find(".charitable-add-fields .charitable-add-fields-button").prop("disabled",false);var section=$field.closest(".charitable-field-section");app.checkFieldTargetState(section);if(options.section){app.checkFieldTargetState(options.section)}$builder.trigger("charitableFieldMove",[options.fieldId,type])},fieldAdd:function(type,options){const $btn=$(`#charitable-add-fields-${type}`);adding=true;Charitable.Admin.Builder.DragFields.disableDragAndDrop();app.disableFormActions();let defaults={campaign_title:s.campaignTitle,position:"bottom",$sortable:"base",placeholder:false,scroll:true,defaults:false,column_id:options.column_id,tab_id:options.tab_id,section_id:options.section_id,area:"fields"};options=$.extend({},defaults,options);let data={action:"charitable_new_field_"+type,id:s.formID,column_id:options.column_id,tab_id:options.tab_id,section_id:options.section_id,field_id:parseInt(elements.$nextFieldId.val())+1,type:type,campaign_title:options.campaign_title,defaults:options.defaults,nonce:charitable_builder.nonce};return $.post(charitable_builder.ajax_url,data,(function(res){if(!res.success){wpchar.debug("Add field AJAX call is unsuccessful:",res);return}wpchar.debug("fieldAdd return");app.refreshTabFieldsSortDrag();let $baseFieldsContainer=options.area==="tabs"?elements.$sortableTabContent.find('li[data-tab-id="'+data.tab_id+'"] .charitable-tab-wrap'):elements.$formPreview.find('.charitable-field-wrap[data-section-id="'+data.section_id+'"]');wpchar.debug($baseFieldsContainer);const $newField=$(res.data.preview),maxAllowed=typeof res.data.max!=="undefined"?parseInt(res.data.max):99,$newOptions=$(res.data.options);let $fieldContainer=options.$sortable;adding=false;$newField.css("display","none");if(options.placeholder){options.placeholder.remove()}if(options.$sortable==="default"||!options.$sortable.length){$fieldContainer=$baseFieldsContainer.find(".charitable-fields-sortable-default")}if(options.$sortable==="base"||!$fieldContainer.length){$fieldContainer=$baseFieldsContainer}let event=CharitableUtils.triggerEvent($builder,"charitableBeforeFieldAddToDOM",[options,$newField,$newOptions,$fieldContainer]);if(event.isDefaultPrevented()){return}if(!event.skipAddFieldToBaseLevel){app.fieldAddToBaseLevel(options,$newField,$newOptions)}if(elements.$preview.find(".charitable-field.charitable-field-donate-amount").length>=maxAllowed){$("#charitable-panel-design button#charitable-add-fields-donate-amount").addClass("charitable-disabled")}$newField.fadeIn();app.checkFieldTargetState($('.charitable-field-section[data-section-id="'+data.section_id+'"]'));$newField.find(".charitable-field-edit").click();if($(".charitable-field-option:not(.charitable-field-option-layout)").length){$builder.find(".charitable-field-submit").show()}app.updateFormHiddenFieldID(res.data.field_id);if(res.data.edit_field_html!==""){$(".charitable-layout-options-tab-general .charitable-layout-options-group-inner").append(res.data.edit_field_html).find('.charitable-panel-field[data-field-id="'+res.data.field_id+'"]').addClass("active");if(res.data.html_field!=""){$('.charitable-panel-field[data-field-id="'+res.data.field_id+'"]').find(".campaign-builder-htmleditor").each((function(){app.initHTMLEditorFields($(this),false)}))}if(type==="campaign-description"&&typeof s.campaignDescription!=="undefined"){$newField.find(".charitable-campaign-builder-no-description-preview").html("<div>"+s.campaignDescription+"</div>");if($("#charitable-panel-field-settings-field_campaign-description_html_"+data.field_id).find(".ql-editor").length===0){app.initHTMLEditorFields($("#charitable-panel-field-settings-field_campaign-description_html_"+data.field_id))}$("#charitable-panel-field-settings-field_campaign-description_html_"+data.field_id).find(".ql-editor").html(s.campaignDescription)}}if(res.data.field.type==="organizer"){$('.campaign-builder-campaign-creator-id-mini[data-field-id="'+res.data.field_id+'"] select').select2({templateResult:app.campaignCreatorFormatOptions})}app.checkFieldAllow();app.checkFieldMax();app.updateEndDateRelatedItems();app.updateGoalRelatedItems();app.checkRecommendedFields(type);var fieldContainerSectionType=$fieldContainer.data("section-type"),forceDeleteNoPreview=false;if(typeof fieldContainerSectionType!=="undefined"&&fieldContainerSectionType==="fields"){forceDeleteNoPreview=true}app.checkNoFieldsPreview();if("photo"===type){$('.charitable-panel-field-uploader[data-field-id="'+res.data.field_id+'"] input.charitable-campaign-builder-upload-button').click()}else if("donate-amount"===type){$(".charitable-campaign-suggested-donations-mini").each((function(){app.initSuggestedDonationsMini($(this));app.updateSuggestdDonationsMiniRowsFromSettings($(this))}))}$builder.trigger("charitableFieldAdd",[res.data.field.id,type])})).fail((function(xhr,textStatus,e){adding=false})).always((function(){$builder.find(".charitable-add-fields .charitable-add-fields-button").prop("disabled",false);if(!adding){Charitable.Admin.Builder.DragFields.enableDragAndDrop();app.enableFormActions()}}))},fieldAddToBaseLevel:function(options,$newField,$newOptions){wpchar.debug("options");wpchar.debug(options);let $baseFieldsContainer="";if(options.area==="tabs"){$baseFieldsContainer=elements.$sortableTabContent.find('li[data-tab-id="'+options.tab_id+'"] .charitable-tab-wrap');$baseFieldsContainer.parent().removeClass("empty-tab")}else{$baseFieldsContainer=elements.$formPreview.find('.charitable-field-wrap[data-section-id="'+options.section_id+'"]')}wpchar.debug("baseFieldsContainer");wpchar.debug($baseFieldsContainer);const $baseFields=$baseFieldsContainer.find("> :not(.charitable-field-drag-pending)"),$lastBaseField=$baseFields.last(),totalBaseFields=$baseFields.length;let $fieldInPosition=elements.$fieldOptions;if(options.position==="top"){$baseFieldsContainer.prepend($newField);return}if(options.position==="bottom"&&(!$lastBaseField.length||!$lastBaseField.hasClass("charitable-field-stick"))){wpchar.debug("adding field to the bottom!!!!");$baseFieldsContainer.append($newField);return}if(options.position==="bottom"){options.position=totalBaseFields}if(options.position===totalBaseFields&&$lastBaseField.length&&$lastBaseField.hasClass("charitable-field-stick")){$lastBaseField.before($newField);return}$fieldInPosition=$baseFieldsContainer.children(":not(.charitable-field-drag-pending)").eq(options.position);if($fieldInPosition.length){$fieldInPosition.before($newField);return}$baseFieldsContainer.append($newField)},checkIfTabsAreEmpty:function(){elements.$preview.find(".tab-content ul li.tab_content_item").each((function(){var numfields=$(this).find(".charitable-field").length;if(numfields===0){$(this).addClass("empty-tab")}}))},disableFormActions:function(disableExit=false,disableCampaignTitleEdit=true,disablePreviewButton=false){$.each([elements.$embedButton,elements.$statusButton,elements.$saveButton],(function(_index,button){button.prop("disabled",true).addClass("charitable-disabled")}));if(disableExit){$.each([elements.$exitButton],(function(_index,button){button.prop("disabled",true).addClass("charitable-disabled")}))}if(disableCampaignTitleEdit){$(".charitable-edit-campaign-title-area").addClass("charitable-disabled");$(".charitable-edit-campaign-title-area input").prop("disabled",true);$(".charitable-edit-campaign-title-area a").addClass("charitable-disabled")}if(disablePreviewButton){elements.$previewButton.prop("disabled",true).addClass("charitable-disabled")}},enableFormActions:function(){$.each([elements.$statusButton,elements.$saveButton,elements.$exitButton],(function(_index,button){button.prop("disabled",false).removeClass("charitable-disabled")}));$(".charitable-edit-campaign-title-area").removeClass("charitable-disabled");$(".charitable-edit-campaign-title-area input").prop("disabled",false);$(".charitable-edit-campaign-title-area a").removeClass("charitable-disabled");if(s.formStatus==="publish"){elements.$embedButton.prop("disabled",false).removeClass("charitable-disabled")}},fieldChoiceDeleteAlert:function(){$.alert({title:false,content:charitable_builder.error_choice,icon:"fa fa-info-circle",type:"blue",buttons:{confirm:{text:charitable_builder.ok,btnClass:"btn-confirm",keys:["enter"]}}})},fieldChoiceSortable:function(type,selector){selector=typeof selector!=="undefined"?selector:".charitable-field-option-"+type+" .charitable-field-option-row-choices ul";$(selector).sortable({items:"li",axis:"y",delay:100,opacity:.6,handle:".move",stop:function(e,ui){var id=ui.item.parent().data("field-id");app.fieldChoiceUpdate(type,id);$builder.trigger("charitableFieldChoiceMove",ui)},update:function(e,ui){}})},tabDelete:function(groupID){app.confirmTabDeletion(groupID)},confirmTabDeletion:function(groupID){var tabData={id:groupID,message:charitable_builder.delete_tab_confirm};var event=CharitableUtils.triggerEvent($builder,"charitableBeforeTabDeleteAlert",[tabData]);if(event.isDefaultPrevented()){return}$.confirm({title:false,content:charitable_builder.delete_tab_confirm,icon:"fa fa-exclamation-circle",type:"orange",buttons:{confirm:{text:charitable_builder.ok,btnClass:"btn-confirm",keys:["enter"],action:function(){app.tabDeleteById(groupID)}},cancel:{text:charitable_builder.cancel,keys:["esc"]}}})},tabDeleteById:function(groupID){const tab_settings=elements.$fieldOptions.find('[data-group_id="'+groupID+'"]'),tab_preview_nav=$("nav ul li#tab_"+groupID+"_title"),tab_preview_content=elements.$preview.find('.tab-content ul li.tab_content_item[data-tab-id="'+groupID+'"]'),tab_count=elements.$preview.find(".tab-content .tab_content_item").length-1,previous_group_ID=Math.abs(groupID-1),tab_content=elements.$preview.find(".tab-content");tab_settings.remove();tab_preview_nav.remove();tab_preview_content.remove();if(elements.$preview.find('nav.charitable-campaign-preview-nav ul li[data-tab-id="'+previous_group_ID+'"] a').length>0){elements.$preview.find('nav.charitable-campaign-preview-nav ul li[data-tab-id="'+previous_group_ID+'"] a').click()}else if(tab_count===1){elements.$preview.find("nav.charitable-campaign-preview-nav ul li a").first().click()}if(tab_count===0){tab_content.addClass("empty-tabs");tab_content.append('<p class="no-tab-notice">'+charitable_builder.no_tabs+"</p>")}else{tab_content.removeClass("empty-tabs");tab_content.find(".no-tab-notice").remove()}app.checkHideTabNavigation()},bindUIActionsPreview:function(){$("body").on("click","a#charitable-preview-btn",(function(e){e.preventDefault();e.stopPropagation();if(parseInt(elements.$campaignID.val())===0){$.alert({title:charitable_builder.no_preview_must_save,content:charitable_builder.no_preview_must_save_msg,icon:"fa fa-info-circle",type:"blue",buttons:{confirm:{text:charitable_builder.close,btnClass:"btn-confirm",keys:["enter"]}}});return}else{var openNewTabURL="";if(typeof this.href!=="undefined"){openNewTabURL=this.href.replace("charitable_campaign_preview=0","charitable_campaign_preview="+s.campaignID)}if(typeof s.formStatus!=="undefined"&&s.formStatus==="publish"){app.formSave(false,true,openNewTabURL)}else if(typeof s.formStatus!=="undefined"&&s.formStatus==="draft"){app.formSave(false,true,openNewTabURL)}}}))},bindUIActionsSaveExit:function(){$builder.on("click","#charitable-embed",(function(e){e.preventDefault();e.stopPropagation();if($(this).hasClass("charitable-disabled")){return}CharitableCampaignEmbedWizard.openPopup(s.formID)}));$builder.on("click","#charitable-status-button",(function(e){e.preventDefault();e.stopPropagation();if($(this).hasClass("charitable-disabled")){return}if($(this).hasClass("active")){$(this).parent().find("ul#charitable-status-dropdown").addClass("charitable-hidden");$(this).removeClass("active")}else{$(this).parent().find("ul#charitable-status-dropdown").removeClass("charitable-hidden");$(this).addClass("active")}}));$builder.on("click","ul#charitable-status-dropdown a",(function(e){e.preventDefault();e.stopPropagation();if($("#charitable-status-button").hasClass("charitable-disabled")){return}var newStatus=$(this).data("status"),newStatusLabel=$(this).data("status-label"),$statusDropdown=$("ul#charitable-status-dropdown");$statusDropdown.addClass("charitable-hidden");$("#charitable-status-button").removeClass("active");$("#charitable-status-button span.text").html(newStatusLabel);$("#charitable-status-button").attr("data-status",newStatus);$statusDropdown.find("a").removeClass("charitable-hidden");$statusDropdown.find("a.switch-"+newStatus).addClass("charitable-hidden");$statusDropdown.find("a."+newStatus).addClass("charitable-hidden");if(newStatus==="draft"){}else if(newStatus==="publish"){}s.formStatus=newStatus;s.formStatusLabel=newStatusLabel}));$builder.on("click",(function(e){if($(e.target).is("#charitable-status-dropdown")===false){$("ul#charitable-status-dropdown").addClass("charitable-hidden");$("#charitable-status-button").removeClass("active")}}));$builder.on("click","#charitable-save",(function(e){e.preventDefault();app.formSave(false)}));$builder.on("click","#charitable-exit",(function(e){e.preventDefault();app.formExit()}));$builder.on("charitableSaved",(function(e,data){$("#charitable_settings_title").attr("disabled",true);wpchar.removeQueryParam("newform")}))},updateFormID:function(){var data={action:"charitable_get_campaign_form_id",id:s.formID,nonce:charitable_builder.nonce};return $.post(charitable_builder.ajax_url,data,(function(response){if(response.success){var campaignID=response.data.campaign_id,redirect=false;$("form#charitable-builder-form").attr("data-id",campaignID);$('form#charitable-builder-form input[name="id"]').val(campaignID);if(response.data.field_id){elements.$nextFieldId.val(parseInt(response.data.field_id))}wpchar.savedState=wpchar.getFormState("#charitable-builder-form");wpchar.initialSave=false;$builder.trigger("charitableSaved",response.data);app.updateDebugWindow(response.data,response.data.campaign_id);if(true===redirect){window.location.href=charitable_builder.exit_url}}else{app.formSaveError(response.data)}})).fail((function(xhr,textStatus,e){app.formSaveError()})).always((function(){}))},updateFormHiddenFields:function(){$('#charitable-panel-design .charitable-panel-content-wrap input[type="hidden"]').remove();$(".charitable-field-wrap .charitable-field, .charitable-tab-wrap .charitable-field").each((function(){var row_type=$(this).closest(".row").data("row-type"),row_id=$(this).closest(".row").data("row-id"),row_css=$(this).closest(".row").data("row-css").length>0?$(this).closest(".row").data("row-css"):"no-css",column_id=$(this).closest(".column.charitable-field-column").data("column-id"),section_type=$(this).closest(".section.charitable-field-section").data("section-type"),section_id=$(this).closest(".section.charitable-field-section").data("section-id"),field_id=$(this).data("field-id"),tab_id="tabs"===section_type?$(this).closest("li.tab_content_item").data("tab-id"):false;if(typeof row_id!=="undefined"){if("tabs"===section_type){elements.$formPreview.append('<input type="hidden" name="layout[row][row-type-'+row_type+"]["+row_id+"]["+row_css+"][column]["+column_id+"][section][section-type-"+section_type+"]["+section_id+"][tabs]["+tab_id+"][fields]["+field_id+']" value="'+$(this).data("field-type")+'" />')}else{elements.$formPreview.append('<input type="hidden" name="layout[row][row-type-'+row_type+"]["+row_id+"]["+row_css+"][column]["+column_id+"][section][section-type-"+section_type+"]["+section_id+"][fields]["+field_id+']" value="'+$(this).data("field-type")+'" />')}}}))},updateFormHiddenFieldID:function(newValue=0){if(0===newValue){var field_id=0;elements.$formPreview.find(".charitable-field").each((function(){var value=parseFloat($(this).attr("data-field-id"));field_id=value>field_id?value:field_id}));newValue=field_id}elements.$nextFieldId.val(parseInt(newValue))},updatePreviewLink:function(previewLink=""){elements.$previewButton.attr("href",previewLink)},updateSuggestDonationsSettings:function($element,theIndex){if(!$element.is("input")||app.getInputType($element)!=="text"){return}$("table#campaign_donation_amounts tbody").find('input[type="text"].campaign_suggested_donations').eq(theIndex).val($element.val());$(".charitable-campaign-suggested-donations-mini tbody").find('input[type="text"].campaign_suggested_donations').eq(theIndex).val($element.val());elements.$preview.find(".charitable-field-donate-amount li.charitable-preview-donation-amount").eq(theIndex/2-1).find("span").first().html($element.val())},updateAllowCustomDonationSettings:function(isChecked){const $custom_preview_fields=elements.$preview.find(".charitable-preview-donation-options .custom-donation-amount");if(isChecked){$custom_preview_fields.removeClass("charitable-hidden")}else{$custom_preview_fields.addClass("charitable-hidden")}},updateSuggestedDonationAmountDefault:function(selectedValue=0){if(selectedValue>0){$('input[type="radio"].campaign_suggested_donations').prop("checked",false);$('input[type="radio"][value='+selectedValue+"].campaign_suggested_donations").prop("checked",true);elements.$preview.find(".charitable-field.charitable-field-donate-amount li").removeClass("selected");elements.$preview.find(".charitable-preview-donation-amounts li:nth-child("+selectedValue+")").addClass("selected");if(elements.$preview.find('.charitable-field.charitable-field-donate-amount input[type="radio"]').length>0){elements.$preview.find('.charitable-field.charitable-field-donate-amount input[type="radio"]:eq('+(selectedValue-1)+")").prop("checked",true)}}else{$("input:radio].campaign_suggested_donations").prop("checked",false)}},getInputType:function($element){var thistest=$element;return thistest[0].tagName.toString().toLowerCase()==="input"?$(thistest[0]).prop("type").toLowerCase():thistest[0].tagName.toLowerCase()},updateCampaignCreatorInfo:function(){var data={action:"charitable_update_campaign_creator",creator_id:parseInt($("select#charitable-panel-field-settings-campaign_campaign_creator_id").val()),campaign_id:s.formID,nonce:charitable_builder.nonce};return $.post(charitable_builder.ajax_url,data,(function(response){if(response.success){$("#campaign-creator .charitable-campaign-creator-avatar img").attr("src",response.data.avatar_url);$("#campaign-creator h3.creator-name").html(response.data.creator_name);$("#campaign-creator p.joined-on span").html(response.data.joined_on);$("#campaign-creator a.public-profile-link").attr("href",response.data.public_profile_link);$("#campaign-creator a.edit-profile-link").attr("href",response.data.edit_profile_link)}else{app.formSaveError(response.data)}})).fail((function(xhr,textStatus,e){app.formSaveError()})).always((function(){}))},formSaveCheck:function(){if($("#charitable_settings_title").val().length===0){$.alert({title:charitable_builder.error_title,content:charitable_builder.error_no_title,icon:"fa fa-info-circle",type:"red",buttons:{confirm:{text:charitable_builder.ok,btnClass:"btn-confirm",keys:["enter"]}}});return false}},formSave:function(redirect,preview=false,openNewTabURL="",refreshAfterSave=false){var $saveBtn=elements.$saveButton,$icon=$saveBtn.find("img.topbar_icon"),$spinner=$saveBtn.find("i.charitable-loading-spinner"),$label=$saveBtn.find("span"),currentPostStatus=s.formSavedStatus;if($builder.hasClass("charitable-is-revision")&&!$builder.hasClass("charitable-revision-is-saving")){app.confirmSaveRevision();return}if(app.formSaveCheck()===false){return}if(typeof tinyMCE!=="undefined"){tinyMCE.triggerSave()}var event=CharitableUtils.triggerEvent($builder,"charitableBeforeSave");if(event.isDefaultPrevented()){return}$("#charitable_settings_title").removeAttr("disabled");$saveBtn.prop("disabled",true);if(preview===false){$label.text(charitable_builder.saving);$icon.addClass("charitable-hidden");$spinner.removeClass("charitable-hidden")}app.updateFormHiddenFields();var data={action:"charitable_save_campaign",data:JSON.stringify($("#charitable-builder-form").serializeArray()),id:s.formID,status:s.formStatus,statusLabel:s.formStatusLabel,preview:preview,nonce:charitable_builder.nonce};return $.post(charitable_builder.ajax_url,data,(function(response){if(response.success){var campaignID=parseInt(response.data.campaign_id);if(refreshAfterSave){if(window.location.href===app.addCampaignIDToURL(campaignID)){window.location.href=app.addCampaignIDToURL(campaignID);return}else{window.location.href=app.addCampaignIDToURL(campaignID);return}}$("form#charitable-builder-form").attr("data-id",campaignID);$('form#charitable-builder-form input[name="id"]').val(campaignID);s.formID=campaignID;if(response.data.field_id){elements.$nextFieldId.val(parseInt(response.data.field_id))}wpchar.savedState=wpchar.getFormState("#charitable-builder-form");wpchar.initialSave=false;$builder.trigger("charitableSaved",response.data);app.updateDebugWindow(response.data,response.data.campaign_id);if(typeof response.data.preview_url!=="undefined"&&response.data.preview_url.length>0){app.updatePreviewLink(response.data.preview_url)}if(preview===false){app.setCampaignSaved()}if(true===redirect){window.location.href=charitable_builder.exit_url}if(history.pushState){var newUrl=app.addCampaignIDToURL(campaignID);window.history.pushState({path:newUrl},"",newUrl)}else{window.location.href=app.addCampaignIDToURL(campaignID)}s.campaignID=campaignID;if(("draft"===currentPostStatus||""===currentPostStatus)&&"publish"===response.data.post_status&&response.data.permalink){CharitableCampaignCongratsWizard.openPopup(s.formID,response.data.permalink)}if("publish"===response.data.post_status){elements.$viewCampaignButton.removeClass("charitable-disabled");elements.$viewCampaignButton.attr("href",response.data.permalink);$("a.charitable-admin-campaign-link").attr("href",response.data.permalink);$("a.charitable-admin-campaign-link.show-url").html(response.data.permalink)}else{elements.$viewCampaignButton.addClass("charitable-disabled")}if("publish"===response.data.post_status){elements.$embedButton.prop("disabled",false).removeClass("charitable-disabled")}else{elements.$embedButton.prop("disabled",true).addClass("charitable-disabled")}s.formSavedStatus=response.data.post_status;s.formSavedStatusLabel=response.data.post_status_label;if(openNewTabURL!==""){window.open(openNewTabURL)}var campaignEmedCode="[campaign id=&quot;"+campaignID+"&quot;]";$("#charitable-admin-campaign-embed-wizard-shortcode-wrap #charitable-admin-campaign-embed-wizard-shortcode").remove();$("#charitable-admin-campaign-embed-wizard-shortcode-wrap").prepend('<input type="text" id="charitable-admin-campaign-embed-wizard-shortcode" class="charitable-admin-popup-shortcode" value="'+campaignEmedCode+'" />');$("#charitable-admin-campaign-embed-wizard-shortcode").prop("disabled",true);app.setCampaignTitleSet();return app.addCampaignIDToURL(campaignID)}else{app.formSaveError(response.data)}})).fail((function(xhr,textStatus,e){app.formSaveError()})).always((function(){$label.text(charitable_builder.saved);setTimeout((function(){$label.text(charitable_builder.save)}),2500);$saveBtn.prop("disabled",false);$spinner.addClass("charitable-hidden");$icon.removeClass("charitable-hidden")}))},formSaveError:function(error){if(wpchar.empty(error)){error=charitable_builder.error_save_form}$.confirm({title:charitable_builder.heads_up,content:"<p>"+error+"</p><p>"+charitable_builder.error_contact_support+"</p>",icon:"fa fa-exclamation-circle",type:"orange",buttons:{confirm:{text:charitable_builder.ok,btnClass:"btn-confirm",keys:["enter"]}}})},formGenericError:function(error){if(wpchar.empty(error)){error=charitable_builder.something_went_wrong}$.confirm({title:charitable_builder.heads_up,content:"<p>"+error+"</p><p>"+charitable_builder.error_contact_support+"</p>",icon:"fa fa-exclamation-circle",type:"orange",buttons:{confirm:{text:charitable_builder.ok,btnClass:"btn-confirm",keys:["enter"]}}})},formGenericNotice:function(error){if(wpchar.empty(error)){error=charitable_builder.something_went_wrong}$.confirm({title:charitable_builder.heads_up,content:"<p>"+error+"</p>",icon:"fa fa-exclamation-circle",type:"orange",buttons:{confirm:{text:charitable_builder.ok,btnClass:"btn-confirm",keys:["enter"]}}})},addCampaignIDToURL:function(campaignID){const currentURL=window.location.href,urlHasQueryString=currentURL.includes("?");let updatedURL=false;if(urlHasQueryString){const queryString=window.location.search,campaignIDExists=queryString.includes("campaign_id");if(campaignIDExists){updatedURL=currentURL.split("#")[0];return updatedURL}else{updatedURL=currentURL.split("#")[0];return updatedURL+"&campaign_id="+campaignID}}else{return currentURL+"?campaign_id="+campaignID}},fieldTabToggle:function(id){const event=CharitableUtils.triggerEvent($builder,"charitableFieldTabToggle",[id]);if(event.isDefaultPrevented()){return false}$(".charitable-tab a").removeClass("active");$(".charitable-field, .charitable-preview-top-bar").removeClass("active");if(id==="add-layout"){$("#add-layout a").addClass("active");$(".charitable-field-options").hide();$(".charitable-add-fields").show()}else if(id==="layout-options"){$("#layout-options a").addClass("active");$(".charitable-add-fields").hide();$(".charitable-field-options").show()}else{$("#charitable-field-"+id).addClass("active");$(".charitable-field-option").hide();$("#charitable-field-option-"+id).show();$(".charitable-add-fields").hide();$(".charitable-field-options").show();$builder.trigger("charitableFieldOptionTabToggle",[id])}wpCookies.set("charitable_panel_content_section",id,2592e3);wpCookies.set("charitable_panel_active_field_id","",2592e3);wpCookies.set("charitable_panel_design_layout_options_group","",2592e3);wpCookies.set("charitable_panel_tab_section_tab_id","",2592e3)},formExit:function(){if(app.formIsSaved()){window.location.href=charitable_builder.exit_url}else{$.confirm({title:false,content:"<p>"+charitable_builder.exit_confirm+"</p>",icon:"fa fa-exclamation-circle",type:"orange",closeIcon:true,buttons:{confirm:{text:charitable_builder.save_exit,btnClass:"btn-confirm",keys:["enter"],action:function(){app.formSave(true)}},cancel:{text:charitable_builder.exit,keys:["esc"],action:function(){closeConfirmation=false;window.location.href=charitable_builder.exit_url}}}})}},checkFieldMax:function(type="",max=99){if(type.length===0){var fieldCount=elements.$preview.find(".charitable-field-"+type).length;if(fieldCount<max){elements.$panelDesign.find("button#charitable-add-fields-"+type).removeClass("charitable-disabled")}}else{elements.$preview.find(".charitable-field[data-field-max!='']").each((function(){var max=parseInt($(this).data("field-max")),fieldType=$(this).data("field-type"),fieldCount=typeof fieldType==="undefined"||fieldType.length===0?0:elements.$preview.find(".charitable-field-"+fieldType).length;if(!isNaN(max)&&max>0&&fieldCount>=max){elements.$panelDesign.find("button#charitable-add-fields-"+fieldType).addClass("charitable-disabled")}}))}},checkFieldAllow:function(){wpchar.debug("checkFieldAllow");$.each(s.denyList,(function(fieldPresent,fieldsNotAllowed){$.each(fieldsNotAllowed,(function(fieldsNotAllowedName,fieldsNotAllowedAmount){app.enableAddFieldButton(fieldsNotAllowedName)}))}));$.each(s.denyList,(function(fieldPresent,fieldsNotAllowed){wpchar.debug("fieldPresent: "+fieldPresent);if(app.checkFieldIsPresent(fieldPresent)){$.each(fieldsNotAllowed,(function(fieldsNotAllowedName,fieldsNotAllowedAmount){if(fieldsNotAllowedAmount===0||app.getFieldAmount(fieldsNotAllowedName)>parseInt(fieldsNotAllowedAmount)){wpchar.debug(fieldsNotAllowedName+" is not allowed");app.disableAddFieldButton(fieldsNotAllowedName)}}))}}))},checkAllRecommendedFields:function(){$.each($(".charitable-add-fields-group-recommended button"),(function(){var type=$(this).data("field-type");app.checkRecommendedFields(type)}))},checkRecommendedFields:function(type=false){if(!type||type.length===0){return}var numberOfFieldsByType=elements.$preview.find(".charitable-field[data-field-type='"+type+"']").length,checkForRecommended=$builder.find("#charitable-add-fields-"+type).parent().find(".charitable-check");if(typeof checkForRecommended==="undefined"||checkForRecommended.length===0){return}if(numberOfFieldsByType===0){checkForRecommended.removeClass("checked").addClass("unchecked")}else{checkForRecommended.removeClass("unchecked").addClass("checked")}},disableAddFieldButton:function(fieldType){elements.$panelDesign.find("button#charitable-add-fields-"+fieldType).addClass("charitable-disabled")},enableAddFieldButton:function(fieldType=""){elements.$panelDesign.find("button#charitable-add-fields-"+fieldType).removeClass("charitable-disabled")},getFieldAmount:function(fieldType=""){if(fieldType.length===0){return}return elements.$preview.find(".charitable-field-"+fieldType).length},checkFieldIsPresent:function(fieldType=""){if(fieldType.length===0){return false}if(app.getFieldAmount(fieldType)>0){return true}return false},setCloseConfirmation:function(confirm){closeConfirmation=!!confirm},formIsSaved:function(){if($("#charitable-builder-form input#charitable-form-saved").val().length===0&&typeof s.formSaved!=="undefined"&&s.formSaved.length===0){return true}else{return false}},setCampaignTitleNotSet:function(){$(".charitable-edit-campaign-title-label").text("Name Your Campaign:")},setCampaignTitleSet:function(){$(".charitable-edit-campaign-title-label").text("Now Editing:")},setCampaignNotSaved:function(enablePreviewButton=false){var the_time=Date.now();$("#charitable-builder-form input#charitable-form-saved").val(the_time);s.formSaved=the_time;elements.$previewButton.removeClass("charitable-disabled")},setCampaignSaved:function(){$("#charitable-builder-form input#charitable-form-saved").val("");s.formSaved="";if(typeof s.formStatus!=="undefined"&&s.formStatus==="publish"){elements.$previewButton.addClass("charitable-disabled")}else{elements.$previewButton.removeClass("charitable-disabled")}},bindUIMoneyTextFields:function(){$builder.on("keydown","input#charitable-panel-field-settings-campaign_minimum_donation_amount, input#charitable-panel-field-settings-campaign_goal",(function(e){var k=e.keyCode||e.which,ok=k==190||k==188||k==32||k==9||k==8||e.ctrlKey&&k==65||e.ctrlKey&&k==67||e.ctrlKey&&k==88||e.ctrlKey&&k==86||e.metaKey&&k==65||e.metaKey&&k==67||e.metaKey&&k==88||e.metaKey&&k==86||k>=96&&k<=105||(k==110||k==190)||k>=37&&k<=40||k==46||k>=48&&k<=57;if(!ok){e.preventDefault()}}));$builder.on("focusout","input#charitable-panel-field-settings-campaign_minimum_donation_amount, input#charitable-panel-field-settings-campaign_goal",(function(e){var $this=$(this),val=$this.val();if(val.length>0&&val.indexOf(".")===-1){$this.val(val+".00")}}))},bindUISettingsRevealGroups:function(){$.each(elements.$settingsPanel.find(".charitable-panel-fields-group.unfoldable"),(function(){var $this=$(this),dataGroup=$this.attr("data-group"),dataGroupCookie=wpCookies.get("charitable_fold_"+dataGroup);if(dataGroupCookie==="true"&&!$this.hasClass("opened")){$this.addClass("opened");$this.find(".charitable-panel-fields-group-inner").show()}}));elements.$settingsPanel.on("click",".charitable-track-cookie",(function(e){var $this=$(this),dataGroup=$this.closest(".unfoldable").attr("data-group");if(!$this.closest(".unfoldable").hasClass("opened")){wpCookies.set("charitable_fold_"+dataGroup,true,2592e3)}else{wpCookies.remove("charitable_fold_"+dataGroup)}}))},checkFieldConditionals:function(){$.each(charitable_campaign_builder_field_conditionals,(function(mainUIKey,mainUIValue){var theUIElement=elements.$settingsPanel.find(mainUIKey),changeArray=mainUIValue;if(theUIElement.is('input[type="checkbox"]')){elements.$settingsPanel.on("click",mainUIKey,(function(e){var thisUIElement=$(this),isChecked=$(this).is(":checked"),checkedFields=changeArray["checked"],uncheckedFields=changeArray["unchecked"];if(isChecked){$.each(checkedFields,(function(checkedFieldKey,checkedFieldValue){elements.$settingsPanel.find(checkedFieldValue+"").removeClass("charitable-hidden")}))}else{$.each(uncheckedFields,(function(checkedFieldKey,checkedFieldValue){$.each(checkedFieldValue,(function(hidingfieldKey,hidingfieldValue){elements.$settingsPanel.find(hidingfieldValue+"").addClass("charitable-hidden")}))}))}}))}if(theUIElement.is('input[type="radio"]')){elements.$settingsPanel.on("click",theUIElement.closest(".charitable-panel-field-radio-options").find('input[type="radio"]'),(function(e){var thisUIElement=$(theUIElement),isChecked=thisUIElement.is(":checked"),checkedFields=changeArray["checked"],uncheckedFields=changeArray["unchecked"],abort=false;if(isChecked){$.each(checkedFields,(function(checkedFieldKey,checkedFieldValue){if(checkedFieldKey==="if"){$.each(checkedFieldValue,(function(checkedIfFieldKey,checkedIfFieldValue){if(checkedIfFieldValue==="checked"&&false===elements.$settingsPanel.find(checkedIfFieldKey+"").is(":checked")){abort=true}}))}if(checkedFieldKey==="show"&&abort===false){elements.$settingsPanel.find(checkedFieldValue+"").removeClass("charitable-hidden")}else if(checkedFieldKey==="show"&&abort===true){elements.$settingsPanel.find(checkedFieldValue+"").addClass("charitable-hidden")}}))}else{$.each(uncheckedFields,(function(checkedFieldKey,checkedFieldValue){elements.$settingsPanel.find(checkedFieldValue+"").addClass("charitable-hidden")}))}}))}}))},isBuilderInPopup:function(){return window.self!==window.parent&&window.self.frameElement.id==="charitable-builder-iframe"},bindUIActionsGeneral:function(){$builder.on("click",".charitable-panel-fields-group.unfoldable .charitable-panel-fields-group-title",app.toggleUnfoldableGroup);$builder.on("click",".go-to-settings-button",(function(e){e.preventDefault();app.panelSwitch("settings");var $this=$(this),section=$this.data("settings-section"),$panel=$(".charitable-panel-sidebar-content"),$sectionButtons=$panel.find(".charitable-panel-sidebar-section"),$sectionButton=$panel.find(".charitable-panel-sidebar-section-"+section),cookieName="charitable_panel_sidebar_section";if(!$sectionButton.hasClass("active")){app.panelSectionSwitchTo(section,$panel,$sectionButtons,$sectionButton);wpCookies.set(cookieName,section,2592e3)}}));$builder.on("click","#charitable-builder-mobile-notice .charitable-fullscreen-notice-button-primary, #charitable-builder-mobile-notice .close",(function(){window.location.href=charitable_builder.exit_url}));$builder.on("click","#charitable-builder-mobile-notice .charitable-fullscreen-notice-button-secondary",(function(){window.location.href=wpchar.updateQueryString("force_desktop_view",1,window.location.href)}))},initFeedbackForms:function($element){var theForm=$element.closest(".charitable-form"),theConfirmation=theForm.find(".charitable-feedback-form-interior-confirmation"),data={name:theForm.find(".charitable-feedback-form-name").val(),email:theForm.find(".charitable-feedback-form-email").val(),feedback:theForm.find(".charitable-feedback-form-feedback").val(),type:theForm.find(".charitable-feedback-form-type").val()};if(""===data.name||""===data.email||""===data.feedback){$.alert({title:false,content:charitable_builder.feedback_form_fields_required,icon:"fa fa-info-circle",type:"red",buttons:{confirm:{text:charitable_builder.ok,btnClass:"btn-confirm",keys:["esc"],action:function(){}}}})}else{$element.addClass("charitable-disabled");theForm.addClass("charitable-processing");theForm.find(".charitable-loading-spinner").removeClass("charitable-hidden");var ajaxData={action:"charitable_campaign_builder_send_feedback_ajax",dataType:"json",data:data,nonce:charitable_builder.nonce};$.post(charitable_builder.ajax_url,ajaxData,(function(response){if(response.success){$element.removeClass("charitable-disabled");theForm.removeClass("charitable-processing");theForm.find(".charitable-feedback-form-interior").addClass("charitable-hidden");theConfirmation.removeClass("charitable-hidden");theConfirmation.find(".charitable-form-confirmation").removeClass("charitable-hidden")}})).fail((function(xhr,textStatus,e){})).always((function(){}))}},toggleUnfoldableGroup:function(e){e.preventDefault();var $title=$(e.target),$group=$title.closest(".charitable-panel-fields-group"),$inner=$group.find(".charitable-panel-fields-group-inner"),cookieName="charitable_fields_group_"+$group.data("group");if($group.hasClass("opened")){wpCookies.remove(cookieName);$inner.stop().slideUp(150,(function(){$group.removeClass("opened")}))}else{wpCookies.set(cookieName,"true",2592e3);$group.addClass("opened");$inner.stop().slideDown(150)}},updateDebugWindow:function(data,campaignID=0){var ajaxData={action:"charitable_update_debug_window_ajax",dataType:"json",data:data,id:campaignID,nonce:charitable_builder.nonce};$.post(charitable_builder.ajax_url,ajaxData,(function(response){if(response.success){$(".charitable-debug").html(response.data)}})).fail((function(xhr,textStatus,e){})).always((function(){}))},dismissNotice:function(){$builder.on("click",".charitable-alert-field-not-available .charitable-dismiss-button",(function(e){e.preventDefault();var $button=$(this),$alert=$button.closest(".charitable-alert"),fieldId=$button.data("field-id");$alert.addClass("out");setTimeout((function(){$alert.remove()}),250);if(fieldId){$("#charitable-field-option-"+fieldId).remove()}}))},initHTMLEditorFields:function($element,minmum=false){if($.inArray($element.attr("id"),s.quilled)==-1){var $container_id="#"+$element.attr("id"),div_height=200,textarea_name=$element.data("textarea-name");if(minmum!==false){var toolbarOptions=["bold","italic","underline","strike"];var quill=new Quill($container_id,{debug:"info",theme:"snow",modules:{toolbar:toolbarOptions}});$($container_id).css("height",div_height+"px");$($container_id).css("min-height",div_height+"px");quill.focus;s.quilled.push($element.attr("id"))}else{var quill=new Quill($container_id,{theme:"snow"});quill.focus;s.quilled.push($element.attr("id"))}$($container_id).on("focus",".ql-editor",(function(){var contents=$element.find(".ql-editor").html();if($element.closest(".charitable-panel-field-textarea").attr("data-special-type")==="campaign_description"){$("#charitable-panel-field-settings-campaign_description .ql-editor").html(contents);elements.$preview.find(".charitable-field-campaign-description .charitable-campaign-builder-placeholder-preview-text").html("<div>"+contents+"</div>");s.campaignDescription=contents}}));quill.on("text-change",(function(delta,oldDelta,source){var contents=$element.find(".ql-editor").html(),tab_id=$element.closest(".charitable-group-row").data("tab-id"),field_id=$element.closest(".charitable-panel-field").data("field-id");app.setCampaignNotSaved();$('input[name="'+textarea_name+'"]').val(contents);if($element.closest(".charitable-panel-field-textarea").attr("data-special-type")==="campaign_description"){if($.trim(app.removeTags(contents))===""){elements.$preview.find(".charitable-campaign-builder-no-description-preview").removeClass("charitable-hidden");elements.$preview.find(".charitable-field-campaign-description .charitable-campaign-builder-placeholder-preview-text").html("<div></div>");s.campaignDescription=""}else{elements.$preview.find(".charitable-field-campaign-description .charitable-campaign-builder-placeholder-preview-text").html("<div>"+contents+"</div>");s.campaignDescription=contents}$("#charitable-panel-field-settings-campaign_description .ql-editor").html(contents)}if($element.closest(".charitable-panel-field-textarea").attr("data-special-type")==="campaign_overview"){if($.trim(app.removeTags(contents))===""){elements.$preview.find(".charitable-campaign-builder-no-overview-preview").removeClass("charitable-hidden");elements.$preview.find(".charitable-field-campaign-overview .charitable-campaign-builder-placeholder-preview-text").html("<div></div>");s.campaignDescription=""}else{elements.$preview.find(".charitable-field-campaign-overview .charitable-campaign-builder-placeholder-preview-text").html("<div>"+contents+"</div>");s.campaignDescription=contents}$("#charitable-panel-field-settings-campaign_overview .ql-editor").html(contents)}if($element.closest(".charitable-panel-field-textarea").attr("data-special-type")==="organizer_content"){field_id=parseInt($element.closest(".charitable-panel-field-textarea").data("field-id"));if($.trim(app.removeTags(contents))===""){elements.$preview.find("#charitable-field-"+field_id+" .charitable-organizer-description").html("<div></div>")}else{elements.$preview.find("#charitable-field-"+field_id+" .charitable-organizer-description").html("<div>"+contents+"</div>")}}if($element.closest(".charitable-panel-field-textarea").attr("data-special-type")==="text"){field_id=parseInt($element.closest(".charitable-panel-field-textarea").data("field-id"));if($.trim(app.removeTags(contents))===""){elements.$preview.find("#charitable-field-"+field_id+" .charitable-campaign-builder-placeholder-preview-text").html("<div></div>")}else{elements.$preview.find("#charitable-field-"+field_id+" .charitable-campaign-builder-placeholder-preview-text").html("<div>"+contents+"</div>")}}if(minmum!==false){var div_height=parseInt($element.find(".ql-editor").height()/2);$("#tab_"+tab_id+"_content .placeholder.big").css("min-height",div_height+"px")}}))}else{}},initSuggestedDonations:function($element){wpchar.debug($element,"initSuggestedDonations");var $table=$element.closest(".charitable-campaign-suggested-donations"),$add_row_button=$element.find("[data-charitable-add-row]"),donation_type=$add_row_button.data("charitable-add-row"),$delete_row_button=$element.find(".charitable-delete-row");$add_row_button.on("click",(function(event){event.preventDefault();event.stopImmediatePropagation();var type=$(this).data("charitable-add-row");if("suggested-amount"===type){app.add_suggested_amount_row($(this))}else if("suggested-recurring-amount"===type){app.add_suggested_amount_row($(this),"recurring")}app.initSuggestedDonations($element);return false}));$delete_row_button.on("click",(function(event){event.preventDefault();event.stopImmediatePropagation();var donation_type=$(this).closest(".charitable-campaign-suggested-donations").find("[data-charitable-add-row]").data("charitable-add-row");if("suggested-amount"===donation_type){app.delete_suggested_amount_row($(this))}else if("suggested-recurring-amount"===donation_type){app.delete_suggested_amount_row($(this),"recurring")}app.initSuggestedDonations($element);return false}));$(".charitable-campaign-suggested-donations tbody").sortable({items:"tr:not(.to-copy)",handle:".handle",stop:function(event,ui){app.reindex_rows();$(".charitable-campaign-suggested-donations-mini").each((function(){app.updateSuggestdDonationsMiniRowsFromSettings($(this));app.redrawDonationAmountsPreview($(this))}))}});$table.on("click","th.default_amount-col a, a.charitable-clear-defaults",(function(){$table.find(".default_amount-col input").prop("checked",false);$(this).blur();return false}));$table.on("change",'input[type="radio"]',(function(){app.redrawDonationAmountsPreview($table)}))},updateSuggestdDonationsMiniRowsFromSettings:function($element,field_id=0){if(0===field_id){field_id=$element.closest(".charitable-panel-field").data("field-id")}$element.find("tbody").children("tr").not(".to-copy").remove();$("#campaign_donation_amounts tbody").children("tr").not(".no-suggested-amounts").not(".to-copy").each((function(index){var row_to_add="",updatedIndex=index+1,updatedDonationValue=$(this).find(".amount-col input").val(),isChecked=$(this).find(".default_amount-col input").is(":checked")?"checked":"";row_to_add=row_to_add+'<tr class="" data-index="'+updatedIndex+'">';row_to_add=row_to_add+'<td class="reorder-col"><span class="charitable-icon charitable-icon-donations-grab handle ui-sortable-handle"></span></td>';row_to_add=row_to_add+'<td class="default_amount-col"><input '+isChecked+' type="radio" class="campaign_suggested_donations" name="_fields]['+field_id+'][donation_amounts][campaign_suggested_donations_default][]" value="'+updatedIndex+'"></td>';row_to_add=row_to_add+'<td class="amount-col"><input autocomplete="false" type="text" class="campaign_suggested_donations" name="_fields]['+field_id+"][donation_amounts]["+updatedIndex+'][amount]" value="'+updatedDonationValue+'" placeholder="Amount"></td>';row_to_add=row_to_add+'<td class="description-col"><input type="text" class="campaign_suggested_donations" name="_fields]['+field_id+"][donation_amounts]["+updatedIndex+'][description]" value="This is a small donation." placeholder="Optional Description">';row_to_add=row_to_add+"</td>";row_to_add=row_to_add+'<td class="remove-col"><span class="dashicons-before dashicons-dismiss charitable-delete-row"></span></td>';row_to_add=row_to_add+"</tr>";$element.find("tbody").append(row_to_add)}));return $element},updateSuggestdDonationsRowsFromSettings:function($miniTableTBody,$element){if(typeof $element==="undefined"||$element.length===0){$element=$("#campaign_donation_amounts")}$element.find("tbody").children("tr").not(".to-copy").remove();$miniTableTBody.children("tr").not(".no-suggested-amounts").not(".to-copy").each((function(index){var row_to_add="",updatedIndex=index+1,updatedDonationValue=$(this).find(".amount-col input").val(),isChecked=$(this).find(".default_amount-col input").is(":checked")?"checked":"";row_to_add=row_to_add+'<tr class="" data-index="'+updatedIndex+'">';row_to_add=row_to_add+'<td class="reorder-col"><span class="charitable-icon charitable-icon-donations-grab handle ui-sortable-handle"></span></td>';row_to_add=row_to_add+'<td class="default_amount-col"><input '+isChecked+' type="radio" class="campaign_suggested_donations" name="settings][donation-options][donation_amounts][campaign_suggested_donations_default][]" value="'+updatedIndex+'">';row_to_add=row_to_add+'<td class="amount-col"><input autocomplete="off" type="text" class="campaign_suggested_donations" name="settings][donation-options][donation_amounts]['+updatedIndex+'][amount]" value="'+updatedDonationValue+'" placeholder="Amount">';row_to_add=row_to_add+'<td class="description-col"><input type="text" class="campaign_suggested_donations" name="settings][donation-options][donation_amounts]['+updatedIndex+'][description]" value="This is a small donation." placeholder="Optional Description">';row_to_add=row_to_add+"</td>";row_to_add=row_to_add+'<td class="remove-col"><span class="dashicons-before dashicons-dismiss charitable-delete-row"></span></td>';row_to_add=row_to_add+"</tr>";$element.find("tbody").append(row_to_add)}));return $element},initSuggestedDonationsMini:function($element){wpchar.debug($element,"initSuggestedDonationsMini");wpchar.debug("initSuggestedDonationsMini");var field_id=$element.closest(".charitable-panel-field").data("field-id");wpchar.debug($element,"initSuggestedDonationsMini");app.updateSuggestdDonationsMiniRowsFromSettings($element,field_id);wpchar.debug($element,"initSuggestedDonationsMini2");app.redrawDonationAmountsPreview($element);wpchar.debug($element,"initSuggestedDonationsMini3");var $table=$element.closest(".charitable-campaign-suggested-donations-mini"),$add_row_button=$element.find("[data-charitable-add-row]");$add_row_button.on("click",(function(){var type=$(this).data("charitable-add-row");if("suggested-amount"===type){wpchar.debug("type is suggesetd amount");wpchar.debug($(this));app.add_suggested_amount_row($(this),"mini")}return false}));$(".charitable-campaign-suggested-donations-mini tbody").sortable({items:"tr:not(.to-copy)",handle:".handle",stop:function(event,ui){wpchar.debug("sortable test mini ");app.reindex_rows("mini");app.updateSuggestdDonationsRowsFromSettings($(this));app.redrawDonationAmountsPreview($(this).parent())}});$table.on("click",".charitable-delete-row",(function(){app.delete_suggested_amount_row($(this),"mini");return false}));$table.on("click","th.default_amount-col a",(function(){$table.find(".default_amount-col input").prop("checked",false);$(this).blur();return false}));$table.on("change",'input[type="radio"]',(function(){app.redrawDonationAmountsPreview($table);var radioButtonValue=$(this).val();$builder.find(".charitable-campaign-suggested-donations-table").find('input[type="radio"]').prop("checked",false);$builder.find(".charitable-campaign-suggested-donations-table").each((function(){$(this).find('input[type="radio"][value="'+radioButtonValue+'"]').prop("checked",true)}))}))},add_suggested_amount_row:function($button,type=""){wpchar.debug("add_suggested_amount_row");wpchar.debug(".charitable-campaign-suggested-donations"+type);const $donations_table=type==="recurring"?$builder.find(".charitable-campaign-suggested-recurring-donations-table"):$builder.find(".charitable-campaign-suggested-donations-table");$donations_table.each((function(){wpchar.debug($(this));var $table=$(this).closest("table").find("tbody"),$clone=$table.find("tr.to-copy").clone().removeClass("to-copy hidden");var newIndex=$table.find("tr:not(.to-copy)").length+1;$clone.attr("data-index",newIndex);var inputFieldName=$clone.find('.amount-col input[type="text"].campaign_suggested_donations').attr("name"),newInputFieldName=inputFieldName.replace("[0]","["+newIndex+"]"),inputFieldNameDescription=$clone.find('.description-col input[type="text"].campaign_suggested_donations').attr("name"),newInputFieldNameDescription=inputFieldNameDescription.replace("[0]","["+newIndex+"]");wpchar.debug($clone.find('.amount-col input[type="text"].campaign_suggested_donations'));wpchar.debug($clone.find('.amount-col input[type="text"].campaign_suggested_donations').attr("name"));$clone.find('.amount-col input[type="text"].campaign_suggested_donations').attr("name",newInputFieldName);$clone.find('.description-col input[type="text"].campaign_suggested_donations').attr("name",newInputFieldNameDescription);$clone.find('.default_amount-col input[type="radio"]').val(newIndex);wpchar.debug($table,"table");wpchar.debug($clone,"clone");$table.find(".no-suggested-amounts").hide();$table.append($clone);$clone.on("click",".charitable-delete-row",(function(){app.delete_suggested_amount_row($(this),type);return false}))}));app.redrawDonationAmountsPreview($builder.find(".charitable-campaign-suggested-donations-table").first());app.reindex_rows(type);if(type===""){app.toggle_custom_donations_checkbox()}},delete_suggested_amount_row:function($button,type=""){wpchar.debug("delete_suggested_amount_row");wpchar.debug($button);wpchar.debug(type);var $row_to_delete=$button.closest("tr "),row_to_delete_index=parseInt($row_to_delete.attr("data-index"));wpchar.debug($row_to_delete);wpchar.debug(row_to_delete_index,"row_to_delete_index");const $donations_table=type==="recurring"?$builder.find(".charitable-campaign-suggested-recurring-donations-table"):$builder.find(".charitable-campaign-suggested-donations-table"),donations_table_class=type==="recurring"?".charitable-campaign-suggested-recurring-donations-table":".charitable-campaign-suggested-donations-table";if(row_to_delete_index>0){wpchar.debug($donations_table.find(' tbody tr[data-index="'+row_to_delete_index+'"]'));wpchar.debug(donations_table_class+' tbody tr[data-index="'+row_to_delete_index+'"]');$donations_table.find(' tbody tr[data-index="'+row_to_delete_index+'"]').remove()}app.redrawDonationAmountsPreview($builder.find(".charitable-campaign-suggested-donations-table").first());var $table=$button.closest("table").find("tbody");if($table.find("tr:not(.to-copy)").length==1){$table.find(".no-suggested-amounts").removeClass("hidden").show()}app.reindex_rows(type);if(type===""){app.reindex_rows("mini")}else if(type==="mini"){app.reindex_rows()}if(type===""){app.toggle_custom_donations_checkbox()}},reindex_rows:function(type=""){wpchar.debug("reindex rows with type: "+type);if(type!==""){type="-"+type}$(".charitable-campaign-suggested-donations"+type+" tbody").each((function(){$(this).children("tr").not(".no-suggested-amounts .to-copy").each((function(index){$(this).find('input[type="radio"]').val(index);$(this).attr("data-index",index);$(this).find("input").each((function(i){this.name=this.name.replace(/(\[\d\])/,"["+index+"]")}))}))}))},redrawDonationAmountsPreview:function(targetTable){elements.$preview.find("ul.charitable-preview-donation-amounts").each((function(index){var $theDontionAmountsList=$(this);$theDontionAmountsList.find("li").remove();$(targetTable).find("tbody").children("tr").not(".no-suggested-amounts").not(".to-copy").not("hidden").each((function(index){var theInputTextValue=$(this).find('input[type="text"].campaign_suggested_donations').first().val();var selected="";wpchar.debug($(this).find('input[type="radio"]'));if($(this).find('input[type="radio"]').is(":checked")){selected=" selected"}$theDontionAmountsList.append('<li class="charitable-preview-donation-amount suggested-donation-amount'+selected+'"><label><input type="radio" name="donation_amount" value="'+index+'"><span class="amount">'+theInputTextValue+"</span></label></li>")}));if($("#charitable-panel-field-settings-campaign_allow_custom_donations").is(":checked")){$theDontionAmountsList.append('<li class="charitable-preview-donation-amount custom-donation-amount "><span class="custom-donation-amount-wrapper"><label><input type="radio" name="donation_amount" value="custom"><span class="description">Custom amount</span></label><input type="text" disabled="&quot;true&quot;" class="custom-donation-input" name="custom_donation_amount" placeholder="Custom Donation Amount" value=""></span></li>')}}))},toggle_custom_donations_checkbox:function(){var $custom=$("#campaign_allow_custom_donations"),$suggestions=$(".charitable-campaign-suggested-donations tbody tr:not(.to-copy)"),has_suggestions=$suggestions.length>1||false===$suggestions.first().hasClass("no-suggested-amounts");$custom.prop("disabled",!has_suggestions);if(!has_suggestions){$custom.prop("checked",true)}},initTagField:function($element){$element.select2()},initColorPicker:function(){Coloris({el:".coloris"});Coloris.setInstance(".instance2.primary",{defaultColor:s.primaryThemeColor,onChange:function(color){if(""===color){$('input[name="layout__advanced__theme_color_primary"]').val(s.primaryThemeColorBase);s.primaryThemeColor=s.primaryThemeColorBase;document.querySelector('input[name="layout__advanced__theme_color_primary"]').dispatchEvent(new Event("input",{bubbles:true}))}else{s.primaryThemeColor=color}app.updateThemeCSS("primary",s.templateID,s.primaryThemeColor,s.secondaryThemeColor,s.tertiaryThemeColor,s.buttonThemeColor,true)},theme:"polaroid",themeMode:"light",alpha:false,formatToggle:true,closeButton:true,clearButton:true,clearLabel:"Reset",swatches:["#067bc2","#84bcda","#80e377","#ecc30b","#f37748","#d56062"]});Coloris.setInstance(".instance2.secondary",{defaultColor:s.secondaryThemeColor,onChange:function(color){if(""===color){$('input[name="layout__advanced__theme_color_secondary"]').val(s.secondaryThemeColorBase);s.secondaryThemeColor=s.secondaryThemeColorBase;app.updateThemeCSS("secondary",s.templateID,s.primaryThemeColor,s.secondaryThemeColor,s.tertiaryThemeColor,s.buttonThemeColor,true);document.querySelector('input[name="layout__advanced__theme_color_secondary"]').dispatchEvent(new Event("input",{bubbles:true}))}else{s.secondaryThemeColor=color;app.updateThemeCSS("secondary",s.templateID,s.primaryThemeColor,s.secondaryThemeColor,s.tertiaryThemeColor,s.buttonThemeColor,true)}},theme:"polaroid",themeMode:"light",alpha:false,formatToggle:true,closeButton:true,clearButton:true,clearLabel:"Reset",swatches:["#067bc2","#84bcda","#80e377","#ecc30b","#f37748","#d56062"]});Coloris.setInstance(".instance2.tertiary",{defaultColor:s.tertiaryThemeColor,onChange:function(color){if(""===color){$('input[name="layout__advanced__theme_color_tertiary"]').val(s.tertiaryThemeColorBase);s.tertiaryThemeColor=s.tertiaryThemeColorBase;app.updateThemeCSS("teritary",s.templateID,s.primaryThemeColor,s.secondaryThemeColor,s.tertiaryThemeColor,s.buttonThemeColor,true);document.querySelector('input[name="layout__advanced__theme_color_tertiary"]').dispatchEvent(new Event("input",{bubbles:true}))}else{s.tertiaryThemeColor=color;app.updateThemeCSS("teritary",s.templateID,s.primaryThemeColor,s.secondaryThemeColor,s.tertiaryThemeColor,s.buttonThemeColor,true)}},theme:"polaroid",themeMode:"light",alpha:false,formatToggle:true,closeButton:true,clearButton:true,clearLabel:"Reset",swatches:["#067bc2","#84bcda","#80e377","#ecc30b","#f37748","#d56062"]});Coloris.setInstance(".instance2.button-color",{defaultColor:s.buttonThemeColor,onChange:function(color){if(""===color){$('input[name="layout__advanced__theme_color_button"]').val(s.buttonThemeColorBase);s.buttonThemeColor=s.buttonThemeColorBase;app.updateThemeCSS("button",s.templateID,s.primaryThemeColor,s.secondaryThemeColor,s.tertiaryThemeColor,s.buttonThemeColor,true);document.querySelector('input[name="layout__advanced__theme_color_button"]').dispatchEvent(new Event("input",{bubbles:true}))}else{s.buttonThemeColor=color;app.updateThemeCSS("button",s.templateID,s.primaryThemeColor,s.secondaryThemeColor,s.tertiaryThemeColor,s.buttonThemeColor,true)}},theme:"polaroid",themeMode:"light",alpha:false,formatToggle:true,closeButton:true,clearButton:true,clearLabel:"Reset",swatches:["#067bc2","#84bcda","#80e377","#ecc30b","#f37748","#d56062"]});elements.$fieldOptions.on("click",".clr-field button",(function(e){e.preventDefault();$(this).parent().find('input[type="text"]').trigger("click")}))},initDatePicker:function($element){var $the_element=$element,options={dateFormat:$the_element.data("format")||"MM d, yy",minDate:$the_element.data("min-date")||"",beforeShow:function(input,inst){setTimeout((function(){$(".ui-datepicker").css("z-index",99999999999999)}),0)}};if($.isFunction($the_element.datepicker)){$the_element.datepicker(options);if($the_element.data("date")){$the_element.datepicker("setDate",this.$el.data("date"))}if($the_element.data("min-date")){$the_element.datepicker("option","minDate",this.$el.data("min-date"))}}},trimFormTitle:function(){var $title=$(".charitable-center-form-name");if($title.text().length>38){var shortTitle=$title.text().trim().substring(0,38).split(" ").slice(0,-1).join(" ")+"...";$title.text(shortTitle)}},builderHotkeys:function(){hotkeys("esc,ctrl+1,ctrl+2,ctrl+3,ctrl+4,ctrl+5,ctrl+s,ctrl+p,ctrl+x,ctrl+v",(function(event,handler){switch(handler.key){case"esc":if($(".charitable-builder-modal.charitable-builder-modal-template-preview").hasClass("active")){$(".charitable-template-list-container").removeClass("disabled");$("#charitable-builder-underlay").remove();$(".charitable-builder-modal.charitable-builder-modal-template-preview").removeClass("active")}break;case"ctrl+1":$(elements.$templateButton,$builder).trigger("click");break;case"ctrl+2":$(elements.$designButton,$builder).trigger("click");break;case"ctrl+3":$(elements.$settingsButton,$builder).trigger("click");break;case"ctrl+4":$(elements.$marketingButton,$builder).trigger("click");break;case"ctrl+5":$(elements.$paymentButton,$builder).trigger("click");break;case"ctrl+s":$(elements.$saveButton,$builder).trigger("click");break;case"ctrl+p":$(elements.$previewButton,$builder).trigger("click");break;case"ctrl+x":$(elements.$exitButton,$builder).trigger("click");break;case"ctrl+v":$(elements.$viewCampaignButton,$builder).trigger("click");break}}))},openModalButtonClick:function(){$(document).on("click",".charitable-not-available:not(.charitable-add-fields-button)",app.openModalButtonHandler).on("mousedown",".charitable-not-available.charitable-add-fields-button",app.openModalButtonHandler);$(document).on("click",".charitable-disabled-modal:not(.charitable-add-fields-button)",app.openModalWarningModal).on("mousedown",".charitable-add-fields-button.charitable-disabled-modal",app.openModalWarningModal);$(document).on("click",".charitable-disabled-same_page:not(.charitable-add-fields-button)",app.openModalWarningModal).on("mousedown",".charitable-add-fields-button.charitable-disabled-same_page",app.openModalWarningModal);$(document).on("click",".charitable-not-installed:not(.charitable-add-fields-button)",app.openModalButtonHandlerInstall).on("mousedown",".charitable-not-installed.charitable-add-fields-button",app.openModalButtonHandlerInstall);$(document).on("click",".charitable-not-activated:not(.charitable-add-fields-button)",app.openModalButtonHandlerActivate).on("mousedown",".charitable-not-activated.charitable-add-fields-button",app.openModalButtonHandlerActivate);$(document).on("click",".charitable-addon-file-missing:not(.charitable-add-fields-button)",app.openModalButtonHandlerInstall).on("mousedown",".charitable-addon-file-missing.charitable-add-fields-button",app.openModalButtonHandlerInstall);$(document).on("click",".charitable-not-available:not(.charitable-setting-panel-upgrade-to-pro)",app.openModalButtonHandler).on("mousedown",".charitable-not-available.charitable-setting-panel-upgrade-to-pro",app.openModalButtonHandler);$(document).on("click",".charitable-need-upgrade:not(.charitable-setting-panel-upgrade-to-pro)",app.openModalButtonHandler).on("mousedown",".charitable-need-upgrade.charitable-setting-panel-upgrade-to-pro",app.openModalButtonHandler);$(document).on("click",".charitable-installed-refresh:not(.charitable-add-fields-button)",app.openModalButtonHandlerActivatedRefresh).on("mousedown",".charitable-installed-refresh.charitable-add-fields-button",app.openModalButtonHandlerActivatedRefresh);$(document).on("click","a.button-link.charitable-not-activated",app.openModalButtonHandlerActivate).on("mousedown","a.button-link.charitable-not-activated",app.openModalButtonHandlerActivate);$(document).on("click","a.button-link.charitable-not-installed",app.openModalButtonHandlerInstall).on("mousedown","a.button-link.charitable-not-installed",app.openModalButtonHandlerInstall);$(document).on("click","a.button-link.charitable-not-activated-button",app.activateFromButton).on("mousedown","a.button-link.charitable-not-activated-button",app.activateFromButton);$(document).on("click","a.button-link.charitable-not-installed-button",app.installFromButton).on("mousedown","a.button-link.charitable-not-installed-button",app.installFromButton)},activateFromButton:function(e){e.preventDefault();const $button=$(this),plugin_url=$(this).data("plugin-url"),plugin_name=$(this).data("name"),settings_url=$(this).data("settings-url"),plugin_slug=$(this).data("plugin-slug"),enable_url=$(this).data("enable-url").length>0?$(this).data("enable-url"):"";if(!plugin_url||!plugin_name){return}app.installFromButtonAjax(plugin_url,plugin_name,settings_url,plugin_slug,enable_url,"activate","addon",$button)},installFromButton:function(e){e.preventDefault();const $button=$(this),plugin_url=$(this).data("plugin-url"),plugin_name=$(this).data("name"),settings_url=$(this).data("settings-url"),plugin_slug=$(this).data("plugin-slug"),enable_url=$(this).data("enable-url").length>0?$(this).data("enable-url"):"";if(!plugin_url||!plugin_name){return}app.installFromButtonAjax(plugin_url,plugin_name,settings_url,plugin_slug,enable_url,"install","addon",$button)},installFromButtonAjax:function(plugin_url,plugin_name,settings_url,plugin_slug,enable_url,state,pluginType,$button){wpchar.debug("setAddonState");wpchar.debug(plugin_url);wpchar.debug(plugin_name);wpchar.debug(state);var actions={activate:"charitable_activate_addon",install:"charitable_install_addon",deactivate:"charitable_deactivate_addon"},action=actions[state];if(!action){return}var plugin_ajax=plugin_url;if("install"===state){if(enable_url.length>0){$button.text("Installing and activating gateway...")}else{$button.text("Installing and activating...")}$button.removeClass("charitable-not-installed-button");$button.addClass("charitable-view-settings-button")}else if("activate"===state){if(enable_url.length>0){$button.text("Activating gateway...")}else{$button.text("Activating...")}$button.removeClass("charitable-not-activated-button");$button.addClass("charitable-view-settings-button");plugin_ajax=plugin_slug}var data={action:action,nonce:charitable_admin.nonce,plugin:plugin_ajax,type:pluginType};wpchar.debug(data);$.post(charitable_admin.ajax_url,data,(function(res){if("install"===state){$('a.button-link[data-plugin-slug="'+plugin_slug+'"]').each((function(){$(this).text("View Settings");$(this).removeClass("charitable-not-installed-button");$(this).addClass("charitable-view-settings-button");if(enable_url.length>0){$(this).attr("href",enable_url)}else{$(this).attr("href",settings_url)}$(this).attr("target","_blank")}));$("section.header-content h2").addClass("charitable-hidden");$("section.header-content h2.charitable-header-content-activated").removeClass("charitable-hidden")}else if("activate"===state){$('a.button-link[data-plugin-slug="'+plugin_slug+'"]').each((function(){$(this).text("View Settings");$(this).removeClass("charitable-not-installed-button");$(this).addClass("charitable-view-settings-button");if(enable_url.length>0){$(this).attr("href",enable_url)}else{$(this).attr("href",settings_url)}$(this).attr("target","_blank")}));$("section.header-content h2").addClass("charitable-hidden");$("section.header-content h2.charitable-header-content-activated").removeClass("charitable-hidden")}})).fail((function(xhr){wpchar.debug(xhr.responseText)}))},openModalWarningModal:function(event){const $this=$(this);event.preventDefault();event.stopImmediatePropagation();let name=$this.data("name"),icon="",reason="";if($this.hasClass("charitable-add-fields-button")){name=$this.text();name+=name.indexOf(charitable_builder.field)<0?" "+charitable_builder.field:"";if($this.data("field-icon")){icon=$this.data("field-icon")}}if($this.hasClass("charitable-disabled-modal")){reason="modal"}else if($this.hasClass("charitable-disabled-same_page")){reason="same_page"}app.modalWarningModal(name,reason,icon)},openModalButtonHandlerInstall:function(event){const $this=$(this);var icon="",plugin_url="",video="",license="",elementType=false;if($this.data("action")&&["activate","install"].includes($this.data("action"))){return}event.preventDefault();event.stopImmediatePropagation();let name=$this.data("name");if($this.hasClass("charitable-add-fields-button")){name=$this.text();name+=name.indexOf(charitable_builder.field)<0?" "+charitable_builder.field:"";if($this.data("field-icon")){icon=$this.data("field-icon")}}if($this.data("install")){plugin_url=$this.data("install")}else if($this.data("plugin-url")){plugin_url=$this.data("plugin-url")}if($this.data("video")){video=$this.data("video")}if($this.data("license")){license=$this.data("license")}app.installModal(name,plugin_url,license,video,$this,elementType,icon)},openModalButtonHandlerActivatedRefresh:function(event){const $this=$(this);event.preventDefault();event.stopImmediatePropagation();let name=$this.data("name");app.activateRefreshModal(name,$this.data("video"))},openModalButtonHandlerActivate:function(event){const $this=$(this);var icon="",plugin_url="",video="",license="",elementType=false;if($this.data("action")&&["activate","install"].includes($this.data("action"))){return}event.preventDefault();event.stopImmediatePropagation();let name=$this.data("name");if($this.data("plugin-url")){plugin_url=$this.data("plugin-url")}if($this.data("video")){video=$this.data("video")}if($this.data("license")){license=$this.data("license")}app.activateModal(name,plugin_url,license,video,$this,elementType,icon)},openModalButtonHandler:function(event){const $this=$(this);if($this.data("action")&&["activate","install"].includes($this.data("action"))){return}event.preventDefault();event.stopImmediatePropagation();let icon="",name=$this.data("name"),elementType=$this.data("type");if($this.hasClass("charitable-add-fields-button")){name=$this.text();name+=name.indexOf(charitable_builder.field)<0?" "+charitable_builder.field:"";if($this.data("field-icon")){icon=$this.data("field-icon")}}const utmContent="utmValue";app.upgradeModal(name,utmContent,$this.data("license"),$this.data("video"),elementType,icon)},modalWarningModal:function(feature,reason="",icon=""){var message="",modalWidth=app.getUpgradeModalWidth(false),title="";if(reason==="modal"){message=charitable_builder.field_disabled_due_to_modal.replace(/%name%/g,feature)}else if(reason==="same_page"){message=charitable_builder.field_disabled_due_to_same_page.replace(/%name%/g,feature)}var modal=$.alert({backgroundDismiss:true,title:title,icon:icon!==""?"fa "+icon:"fa fa-thumbs-up",content:message,boxWidth:modalWidth,theme:"modern,charitable-install-form",closeIcon:true,buttons:{confirm:{text:charitable_builder.ok,btnClass:"btn-confirm",keys:["enter"],action:function(){}},cancel:{text:charitable_builder.go_to_settings,btnClass:"btn-confirm",action:function(){window.open(charitable_builder.settings_page_url)}}}})},setAddonState:function(plugin_url,plugin_name,state,pluginType,modal,clickedObject,callback){wpchar.debug("setAddonState");wpchar.debug(plugin_url);wpchar.debug(plugin_name);wpchar.debug(state);var actions={activate:"charitable_activate_addon",install:"charitable_install_addon",deactivate:"charitable_deactivate_addon"},action=actions[state];if(!action){return}var data={action:action,nonce:charitable_admin.nonce,plugin:plugin_url,type:pluginType};wpchar.debug(data);$.post(charitable_admin.ajax_url,data,(function(res){callback(res,plugin_url,plugin_name,state,modal,clickedObject)})).fail((function(xhr){wpchar.debug(xhr.responseText)}))},callBackAddonState:function(res,plugin_url="",plugin_name="",state="",modal=false,clickedObject){wpchar.debug("callBackAddonState");wpchar.debug(res);wpchar.debug(state);wpchar.debug(modal);var successText="";if(res.success){if("install"===state){wpchar.debug("installed");if(s.currentModal!==false&&"object"===typeof s.currentModal){s.currentModal.close()}if(res.data.is_activated){successText=res.data.msg;app.upgradeModalAddonInstalledAndActivated(plugin_url,plugin_name,successText)}else{app.upgradeModalAddonInstalledAndActivatedFailed(plugin_url,plugin_name,successText)}}else if("activate"===state){wpchar.debug("activated");successText=res.data;if(s.currentModal!==false&&"object"===typeof s.currentModal){s.currentModal.close()}app.upgradeModalAddonActivated(plugin_url,plugin_name,successText);clickedObject.addClass("charitable-installed-refresh").removeClass("charitable-not-activated");app.openModalButtonClick()}else{wpchar.debug("some other success");successText=res.data;if(s.currentModal!==false&&"object"===typeof s.currentModal){s.currentModal.close()}app.upgradeModalAddonActivated(plugin_url,plugin_name,successText);clickedObject.addClass("charitable-installed-refresh").removeClass("charitable-not-activated");app.openModalButtonClick()}}else{if(s.currentModal!==false&&"object"===typeof s.currentModal){s.currentModal.close()}app.upgradeModalAddonActivatedFailed(plugin_url,plugin_name,successText)}},activateRefreshModal:function(name,video,icon=""){wpchar.debug("activateRefreshModal");wpchar.debug(name);wpchar.debug(video);var message=charitable_builder.activated_refresh.replace(/%addon%/g,name),isVideoModal=!_.isEmpty(video),modalWidth=app.getUpgradeModalWidth(isVideoModal),title='<span class="charitable-upgrade-pro-title">'+name+" "+charitable_builder.activated_refresh_title+"</span>";var modal=$.alert({backgroundDismiss:true,title:title,icon:icon!==""?"fa "+icon:"fa fa-thumbs-up",content:message,boxWidth:modalWidth,theme:"modern,charitable-activate-refresh",closeIcon:true,buttons:{confirm:{text:charitable_builder.ok,btnClass:"btn-confirm",keys:["enter"]}}});$(window).on("resize",(function(){modalWidth=app.getUpgradeModalWidth(isVideoModal);if(modal.isOpen()){modal.setBoxWidth(modalWidth)}}))},activateModal:function(feature,plugin_url,type,video,clickedObject,elementType=false,icon=""){wpchar.debug("activatelModal");wpchar.debug(feature);wpchar.debug(plugin_url);wpchar.debug(type);wpchar.debug(video);wpchar.debug(elementType);if(typeof type==="undefined"||type.length===0){type="pro"}var message=charitable_builder.activate.message.replace(/%addon%/g,feature),isVideoModal=!_.isEmpty(video),modalWidth=app.getUpgradeModalWidth(isVideoModal),title='<span class="charitable-upgrade-pro-title">'+feature+" "+charitable_builder.activate.title+"</span>";var modal=$.alert({backgroundDismiss:true,title:title,icon:icon!==""?"fa "+icon:"fa fa-thumbs-up",content:message,boxWidth:modalWidth,theme:"modern,charitable-activate-addon",closeIcon:true,buttons:{cancel:{btnClass:"btn-confirm",keys:["esc"],isHidden:false,isDisabled:false,action:function(){}},install:{text:charitable_builder.activate.button,btnClass:"btn-confirm",keys:["enter"],isHidden:false,isDisabled:false,action:function(activateButton){activateButton.setText(charitable_builder.activating);activateButton.disable();this.$$cancel.prop("disabled",true);this.$$cancel.hide();app.setAddonState(plugin_url,feature,"activate","addon",$(this),clickedObject,app.callBackAddonState);return false}}}});s.currentModal=modal;$(window).on("resize",(function(){modalWidth=app.getUpgradeModalWidth(isVideoModal);if(modal.isOpen()){modal.setBoxWidth(modalWidth)}}))},installModal:function(feature,plugin_url,type,video,clickedObject,elementType=false,icon=""){wpchar.debug("installModal");wpchar.debug(feature);wpchar.debug(plugin_url);wpchar.debug(type);wpchar.debug(video);wpchar.debug(clickedObject);wpchar.debug(elementType);if(typeof type==="undefined"||type.length===0){type="pro"}if($.inArray(type,["pro","basic","plus","agency","elite"])<0){return}var license_label=charitable_builder.charitable_license_label,message=charitable_builder.install[type].message.replace(/%name%/g,license_label).replace(/%addon%/g,feature),isVideoModal=!_.isEmpty(video),modalWidth=app.getUpgradeModalWidth(isVideoModal),title="";if(elementType){title='<span class="charitable-upgrade-pro-title">'+feature+" "+charitable_builder.install["pro-panel"].title+"</span>"}else{title='<span class="charitable-upgrade-pro-title">'+feature+" "+charitable_builder.install[type].title+"</span>"}var modal=$.alert({backgroundDismiss:false,title:title,icon:icon!==""?"fa "+icon:"fa fa-thumbs-up",content:message,boxWidth:modalWidth,theme:"modern,charitable-install-form",closeIcon:false,buttons:{cancel:{btnClass:"btn-confirm",keys:["esc"],isHidden:false,isDisabled:false,action:function(){}},confirmInstall:{text:charitable_builder.install[type].button,btnClass:"btn-confirm",keys:["enter"],isHidden:false,isDisabled:false,action:function(confirmInstallButton){confirmInstallButton.setText(charitable_builder.installing);confirmInstallButton.disable();this.$$cancel.prop("disabled",true);this.$$cancel.hide();app.setAddonState(plugin_url,feature,"install","addon",$(this),clickedObject,app.callBackAddonState);return false}}}});s.currentModal=modal;$(window).on("resize",(function(){modalWidth=app.getUpgradeModalWidth(isVideoModal);if(modal.isOpen()){modal.setBoxWidth(modalWidth)}}))},upgradeModal:function(feature,utmContent,type,video,elementType=false,icon=""){if(typeof type==="undefined"||type.length===0){type="pro"}if($.inArray(type,["pro","basic","plus","agency","elite"])<0){return}var isVideoModal=!_.isEmpty(video),modalWidth=app.getUpgradeModalWidth(isVideoModal),title="",message="",button="",typeCapitlized="pro"!==type.toLowerCase()?type.charAt(0).toUpperCase()+type.slice(1):"PRO";if(elementType){title=feature+" "+charitable_builder.upgrade["pro-panel"].title.replace(/%plan%/g,typeCapitlized),message=charitable_builder.upgrade["pro-panel"].message.replace(/%name%/g,feature),message=message.replace(/%plan%/g,typeCapitlized),button=charitable_builder.upgrade["pro-panel"].button.replace(/%name%/g,feature).replace("addon",""),button=button.replace(/%plan%/g,typeCapitlized)}else{title=feature+" "+charitable_builder.upgrade[type].title.replace(/%plan%/g,typeCapitlized),message=charitable_builder.upgrade[type].message.replace(/%name%/g,feature),message=message.replace(/%plan%/g,typeCapitlized),button=charitable_builder.upgrade[type].button.replace(/%name%/g,feature).replace("addon",""),button=button.replace(/%plan%/g,typeCapitlized)}var modal=$.alert({backgroundDismiss:true,title:title,icon:icon!==""?"fa "+icon:"fa fa-lock",content:message,boxWidth:modalWidth,theme:"modern,charitable-upgrade-form-lite",closeIcon:true,onOpenBefore:function(){if(isVideoModal){this.$el.addClass("has-video")}var videoHtml=isVideoModal?'<iframe src="'+video+'" class="feature-video" frameborder="0" allowfullscreen="" width="475" height="267"></iframe>':"";this.$btnc.after(charitable_builder.upgrade[type].doc.replace(/%25name%25/g,feature));this.$btnc.after(videoHtml);this.$body.find(".jconfirm-content").addClass("lite-upgrade")},buttons:{confirm:{text:button,btnClass:"btn-confirm",keys:["enter"],action:function(){window.open(app.getUpgradeURL(utmContent,type),"_blank");app.upgradeModalThankYou(type)}}}});$(window).on("resize",(function(){modalWidth=app.getUpgradeModalWidth(isVideoModal);if(modal.isOpen()){modal.setBoxWidth(modalWidth)}}))},getInstallURL:function(utmContent,type,searchKeyword=false){var returnUrl=charitable_builder.charitable_addons_page;if(searchKeyword){returnUrl=returnUrl+"&search="+searchKeyword.replace(/[^0-9a-z+ ]/gi,"").replace("Field","").trim()}return returnUrl},getUpgradeURL:function(utmContent,type){var baseURL=charitable_builder.upgrade[type].url;if(utmContent.toLowerCase().indexOf("template")>-1){baseURL=charitable_builder.upgrade[type].url_template}var appendChar=/(\?)/.test(baseURL)?"&":"?";if(baseURL.indexOf("https://wpcharitable.com")===-1){appendChar=encodeURIComponent(appendChar)}return baseURL+appendChar+"utm_content="+encodeURIComponent(utmContent.trim())},upgradeModalThankYou:function(type){$.alert({title:charitable_builder.thanks_for_interest,content:charitable_builder.upgrade[type].modal,icon:"fa fa-info-circle",type:"blue",boxWidth:"565px",buttons:{confirm:{text:charitable_builder.ok,btnClass:"btn-confirm",keys:["enter"]}}})},upgradeModalAddonInstalledAndActivated:function(plugin_url="",plugin_name="",successText=""){$.alert({title:'<span class="charitable-upgrade-pro-title">'+plugin_name+" "+charitable_builder.installed_activated_title+"</span>",content:charitable_builder.installed_activated_reboot,icon:"fa fa-info-circle",type:"blue",boxWidth:"565px",buttons:{confirm:{text:charitable_builder.ok,btnClass:"btn-confirm",keys:["esc"]},saveRefresh:{text:charitable_builder.save_refresh,btnClass:"btn-confirm",keys:["enter"],action:function(saveRefreshButton){saveRefreshButton.setText(charitable_builder.standby);saveRefreshButton.disable();this.$$confirm.prop("disabled",true);this.$$confirm.hide();app.formSave(false,false,false,true);return false}}}})},upgradeModalAddonActivated:function(plugin_url="",plugin_name="",successText=""){$.alert({title:'<span class="charitable-upgrade-pro-title">'+plugin_name+" "+charitable_builder.activated_title+"</span>",content:charitable_builder.activated_reboot,icon:"fa fa-info-circle",type:"blue",boxWidth:"565px",buttons:{confirm:{text:charitable_builder.ok,btnClass:"btn-confirm",keys:["esc"]},saveRefresh:{text:charitable_builder.save_refresh,btnClass:"btn-confirm",keys:["enter"],action:function(saveRefreshButton){saveRefreshButton.setText(charitable_builder.standby);saveRefreshButton.disable();this.$$confirm.prop("disabled",true);this.$$confirm.hide();app.formSave(false,false,false,true);return false}}}})},upgradeModalAddonInstalledAndActivatedFailed:function(plugin_url="",plugin_name="",successText=""){$.alert({title:'<span class="charitable-upgrade-pro-title">'+plugin_name+" "+charitable_builder.installed_activated_failed_title+"</span>",content:charitable_builder.installed_activated_failed_reboot,icon:"fa fa-info-circle",type:"blue",boxWidth:"565px",buttons:{confirm:{text:charitable_builder.ok,btnClass:"btn-confirm",keys:["enter"]}}})},upgradeModalAddonActivatedFailed:function(plugin_url="",plugin_name="",successText=""){$.alert({title:'<span class="charitable-upgrade-pro-title">'+plugin_name+" "+charitable_builder.activated_failed_title+"</span>",content:charitable_builder.activated_failed_reboot,icon:"fa fa-info-circle",type:"blue",boxWidth:"565px",buttons:{confirm:{text:charitable_builder.ok,btnClass:"btn-confirm",keys:["enter"]}}})},getUpgradeModalWidth:function(isVideoModal){var windowWidth=$(window).width();if(windowWidth<=300){return"250px"}if(windowWidth<=750){return"350px"}if(!isVideoModal||windowWidth<=1024){return"560px"}return windowWidth>1070?"1040px":"994px"},isFunction:function(functionToCheck){return functionToCheck&&{}.toString.call(functionToCheck)==="[object Function]"}};return app}(document,window,jQuery);CharitableCampaignBuilder.init();