"use strict";var Charitable=window.Charitable||{};Charitable.Admin=Charitable.Admin||{};Charitable.Admin.Builder=Charitable.Admin.Builder||{};Charitable.Admin.Builder.DragFields=Charitable.Admin.Builder.DragFields||function(document,window,$){let el={};let vars={};let fieldLayout;const app={init:function(){$(app.ready)},ready:function(){app.setup();app.initSortableFields();app.events()},setup:function(){el={$builder:$("#charitable-builder"),$sortableFieldsWrap:$(".charitable-panel-fields .charitable-field-wrap"),$sortableTabsWrap:$(".charitable-panel-fields .charitable-tab-wrap"),$addFieldsButtons:$(".charitable-add-fields-button").not(".not-draggable").not(".warning-modal").not(".charitable-not-available").not(".charitable-not-installed"),$preview:$(".charitable-preview")};wpchar.debug("setup drag-fields"),"drag-fields";wpchar.debug(el,"drag-fields")},events:function(){el.$builder.on("charitableFieldDragToggle",app.fieldDragToggleEvent);el.$builder.on("charitableAddNewTab",app.initAfterNewTab)},initAfterNewTab:function($field,groupID=false){wpchar.debug("groupID"),"drag-fields";wpchar.debug($field,"drag-fields");wpchar.debug(groupID,"drag-fields");wpchar.debug(el.$sortableTabsWrap,"drag-fields");el.$sortableTabsWrap=$(".charitable-panel-fields .charitable-tab-wrap");wpchar.debug(el.$sortableTabsWrap,"drag-fields");app.initSortableFields();CharitableCampaignBuilder.setCampaignNotSaved()},disableDragAndDrop:function(){wpchar.debug("disableDragAndDrop"),"drag-fields";el.$addFieldsButtons.filter(".ui-draggable").draggable("disable");el.$sortableFieldsWrap.sortable("disable");el.$sortableFieldsWrap.find(".charitable-layout-section.ui-sortable").sortable("disable")},enableDragAndDrop:function(){wpchar.debug("enableDragAndDrop"),"drag-fields";el.$addFieldsButtons.filter(".ui-draggable").draggable("enable");el.$sortableFieldsWrap.sortable("enable");el.$sortableFieldsWrap.find(".charitable-layout-section.ui-sortable").sortable("enable")},fieldDragDisable:function($field,showPopUp=true){if($field.hasClass("ui-draggable-disabled")){$field.draggable("enable");return}let startTopPosition;$field.draggable({revert:true,axis:"y",delay:100,opacity:.75,cursor:"move",start:function(event,ui){startTopPosition=ui.position.top},drag:function(event,ui){if(Math.abs(ui.position.top)-Math.abs(startTopPosition)>15){if(showPopUp){app.youCantReorderFieldPopup()}return false}}})},fieldDragEnable:function($field){if($field.hasClass("ui-draggable")){return}wpchar.debug("fieldDragEnable"),"drag-fields";$field.draggable("disable")},youCantReorderFieldPopup:function(){$.confirm({title:charitable_builder.heads_up,content:charitable_builder.field_cannot_be_reordered,icon:"fa fa-exclamation-circle",type:"red",buttons:{confirm:{text:charitable_builder.ok,btnClass:"btn-confirm",keys:["enter"]}}})},fieldDragToggleEvent:function(e,id){const $field=$(`#charitable-field-${id}`);if($field.hasClass("charitable-field-not-draggable")||$field.hasClass("charitable-field-stick")){app.fieldDragDisable($field);wpchar.debug("fieldDragToggleEvent fieldDragDisable"),"drag-fields";return}app.fieldDragEnable($field);CharitableCampaignBuilder.setCampaignNotSaved()},initSortableFields:function(){wpchar.debug("initSortableFields","drag-fields");wpchar.debug(el.$sortableFieldsWrap,"drag-fields");wpchar.debug(el.$sortableTabsWrap,"drag-fields");app.initSortableContainer(el.$sortableTabsWrap);el.$builder.find(".charitable-panel-fields .charitable-field-wrap").each((function(){app.initSortableContainer($(this))}));app.initDraggableFields()},initSortableContainer:function($sortable){wpchar.debug("initSortableContainer"),"drag-fields";let fieldId,fieldType,isNewField;$sortable.sortable({items:"> .charitable-field:not(.charitable-field-stick):not(.no-fields-preview)",connectWith:".charitable-field-wrap, .charitable-tab-wrap",delay:100,opacity:.75,cursor:"move",cancel:".charitable-field-not-draggable",placeholder:"charitable-field-drag-placeholder",appendTo:".charitable-design-wrap",zindex:1e4,tolerance:"pointer",distance:1,start:function(e,ui){wpchar.debug("vars","drag-fields");wpchar.debug(vars,"drag-fields");wpchar.debug("start sortable via drag-fields.js"),"drag-fields";wpchar.debug("ui","drag-fields");wpchar.debug(ui,"drag-fields");wpchar.debug("ui.item","drag-fields");wpchar.debug(ui.item,"drag-fields");fieldId=ui.item.data("field-id");fieldType=ui.item.data("field-type")||vars.fieldType;if(!isNewField){vars.section=ui.item.closest(".charitable-field-section")}else{vars.section=false}isNewField=typeof fieldId==="undefined";wpchar.debug(" fieldId: "+fieldId+" - fieldType: "+fieldType+" - newField: "+isNewField+" - section: "+vars.section),"drag-fields";vars.fieldReceived=false;vars.fieldRejected=false;vars.$sortableStart=$sortable;vars.fieldType=fieldType;vars.startPosition=ui.item.first().index();$(this).attr("data-previndex",ui.item.index())},beforeStop:function(e,ui){wpchar.debug("beforeStop ==== sortable via drag-fields.js"),"drag-fields"},stop:function(e,ui){wpchar.debug("stop ==== sortable via drag-fields.js"),"drag-fields";wpchar.debug(ui,"drag-fields");const $field=ui.item.first();ui.placeholder.removeClass("charitable-field-drag-not-allowed");$field.removeClass("charitable-field-drag-not-allowed");$field.removeClass("charitable-field-dragging").removeClass("charitable-field-drag-over").attr("style","");el.$builder.trigger("charitableFieldMove",ui)},over:function(e,ui){wpchar.debug("over ==== sortable via drag-fields.js"),"drag-fields";const $field=ui.item.first(),$target=$(e.target),$placeholder=$target.find(".charitable-field-drag-placeholder"),isColumn=$target.hasClass("charitable-layout-column"),targetClass=isColumn?" charitable-field-drag-to-column":"",helper={width:$target.outerWidth(),height:$field.outerHeight()};fieldId=$field.data("field-id");fieldType=$field.data("field-type")||vars.fieldType;isNewField=typeof fieldId==="undefined";$field.addClass("charitable-field-dragging"+targetClass).css({width:isColumn?helper.width-5:helper.width,height:"auto"});$placeholder.removeClass("charitable-field-drag-not-allowed").css({height:isNewField?helper.height+18:helper.height});if(!fieldLayout.isFieldAllowedInColum(fieldType)&&isColumn){$placeholder.addClass("charitable-field-drag-not-allowed");$field.addClass("charitable-field-drag-not-allowed")}if(!isNewField){return}$field.addClass("charitable-field-drag-over").removeClass("charitable-field-drag-out")},out:function(e,ui){wpchar.debug("out ==== sortable via drag-fields.js"),"drag-fields"},receive:function(e,ui){wpchar.debug("receive ==== sortable via drag-fields.js"),"drag-fields";wpchar.debug(ui,"drag-fields");wpchar.debug(ui.helper,"drag-fields");wpchar.debug(ui.item,"drag-fields");wpchar.debug(ui.position,"drag-fields");wpchar.debug(ui.originalPosition,"drag-fields");wpchar.debug(ui.sender,"drag-fields");wpchar.debug(ui.placeholder,"drag-fields")},update:function(e,ui){wpchar.debug("update ==== sortable via drag-fields.js"),"drag-fields";var newIndex=ui.item.index();var oldIndex=$(this).attr("data-previndex");var element_id=ui.item.attr("class");$(this).attr("data-current-index",ui.item.index());wpchar.debug($(this));$(this).removeAttr("data-previndex");const $field=$(ui.helper||ui.item);var area=$sortable.hasClass("charitable-field-wrap")?"fields":"tabs",column_id="fields"===area?parseInt($field.closest(".charitable-field-column").data("column-id")):false,section_id="fields"===area?parseInt($field.closest(".charitable-field-section").data("section-id")):false,tab_id="tabs"===area?parseInt($field.closest(".tab_content_item").data("tab-id")):false,fieldId=$field.data("field-id"),fieldType=$field.data("field-type")||vars.fieldType;const isNewField=typeof fieldId==="undefined",isColumn=$sortable.hasClass("charitable-layout-column"),numfieldsDonateButton=el.$preview.find(".charitable-field.charitable-field-donate-button").length,numfieldsDonationForm=el.$preview.find(".charitable-field.charitable-field-donation-form").length;wpchar.debug($sortable);wpchar.debug($sortable.data("ui-sortable"));wpchar.debug($sortable.data("ui-sortable").currentItem);var currentIndex=$(this).attr("data-current-index");wpchar.debug(currentIndex,"currentIndex");wpchar.debug($(this));let position=typeof currentIndex==="undefined"?-1:currentIndex;el.$builder.find(".charitable-add-fields .charitable-add-fields-button").prop("disabled",true);if(fieldType==="donation-form"){if(numfieldsDonateButton>0){$(".ui-draggable-dragging").css("opacity","0");$.confirm({title:charitable_builder.heads_up,content:charitable_builder.donation_form_donation_button,icon:"fa fa-exclamation-circle",type:"red",buttons:{confirm:{text:charitable_builder.remove_donation_button,btnClass:"btn-confirm",keys:["enter"],action:function(){el.$preview.find(".charitable-field.charitable-field-donate-button").each((function(){var fieldDeleteId=$(this).data("field-id");if(parseInt(fieldDeleteId)>0){CharitableCampaignBuilder.fieldDelete(fieldDeleteId,false)}}));$(".ui-draggable-dragging").css("opacity","1.0");app.addFieldAfterDrag($field,isNewField,isColumn,position,area,column_id,tab_id,section_id,fieldId,fieldType,$sortable)}},cancel:{text:charitable_builder.cancel,keys:["esc"],action:function(){el.$builder.find(".charitable-add-fields .charitable-add-fields-button").prop("disabled",false);$field.remove();return}}}})}else if(numfieldsDonationForm>1){$(".ui-draggable-dragging").css("opacity","0");$.confirm({title:charitable_builder.heads_up,content:charitable_builder.only_one_donation_form,icon:"fa fa-exclamation-circle",type:"red",buttons:{confirm:{text:charitable_builder.remove_donation_form,btnClass:"btn-confirm",keys:["enter"],action:function(){el.$preview.find(".charitable-field.charitable-field-donation-form").each((function(){var fieldDeleteId=$(this).data("field-id");if(parseInt(fieldDeleteId)>0){CharitableCampaignBuilder.fieldDelete(fieldDeleteId,false)}}));$(".ui-draggable-dragging").css("opacity","1.0");app.addFieldAfterDrag($field,isNewField,isColumn,position,area,column_id,tab_id,section_id,fieldId,fieldType,$sortable)}},cancel:{text:charitable_builder.cancel,keys:["esc"],action:function(){el.$builder.find(".charitable-add-fields .charitable-add-fields-button").prop("disabled",false);$field.remove();return}}}})}else{app.addFieldAfterDrag($field,isNewField,isColumn,position,area,column_id,tab_id,section_id,fieldId,fieldType,$sortable,vars.section)}}else if(fieldType==="donate-button"&&numfieldsDonationForm>0){$(".ui-draggable-dragging").css("opacity","0");$.confirm({title:charitable_builder.heads_up,content:charitable_builder.donation_button_donation_form,icon:"fa fa-exclamation-circle",type:"red",buttons:{confirm:{text:charitable_builder.remove_donation_form,btnClass:"btn-confirm",keys:["enter"],action:function(){el.$preview.find(".charitable-field.charitable-field-donation-form").each((function(){var fieldDeleteId=$(this).data("field-id");if(parseInt(fieldDeleteId)>0){CharitableCampaignBuilder.fieldDelete(fieldDeleteId,false)}}));$(".ui-draggable-dragging").css("opacity","1.0");app.addFieldAfterDrag($field,isNewField,isColumn,position,area,column_id,tab_id,section_id,fieldId,fieldType,$sortable,vars.section)}},cancel:{text:charitable_builder.cancel,keys:["esc"],action:function(){el.$builder.find(".charitable-add-fields .charitable-add-fields-button").prop("disabled",false);$field.remove();return}}}})}else{app.addFieldAfterDrag($field,isNewField,isColumn,position,area,column_id,tab_id,section_id,fieldId,fieldType,$sortable,vars.section)}},change:function(e,ui){wpchar.debug("change ==== sortable via drag-fields.js"),"drag-fields"},sort:function(e,ui){wpchar.debug("sort ==== sortable via drag-fields.js"),"drag-fields";CharitableCampaignBuilder.setCampaignNotSaved()}})},addFieldAfterDrag($field,isNewField,isColumn,position,area,column_id,tab_id,section_id,fieldId,fieldType,$sortable,$section){if(isNewField){$field.addClass("charitable-field-drag-over charitable-field-drag-pending").removeClass("charitable-field-drag-out").append(CharitableCampaignBuilder.settings.spinnerInline).css("width","100%");wpchar.debug("addFieldAfterDrag");wpchar.debug(isColumn);wpchar.debug(position);CharitableCampaignBuilder.fieldAdd(vars.fieldType,{position:isColumn?position-1:position,placeholder:$field,$sortable:$sortable,column_id:column_id,tab_id:tab_id,section_id:section_id,area:area,section:false})}else{CharitableCampaignBuilder.fieldMove(vars.fieldType,{field:$field,fieldId:fieldId,$sortable:$sortable,column_id:column_id,tab_id:tab_id,section_id:section_id,area:area,section:$section})}CharitableCampaignBuilder.setCampaignNotSaved()},getChildIndex(childDiv){var parentDiv=childDiv.parent();var childDivs=parentDiv.children();for(var i=0;i<childDivs.length;i++){if(childDivs[i]===childDiv[0]){return i+1}}return-1},initDraggableFields:function(){el.$addFieldsButtons.draggable({connectToSortable:".charitable-field-wrap, .charitable-tab-wrap",delay:200,cancel:false,scroll:false,opacity:.75,appendTo:".charitable-design-wrap",zindex:1e4,helper:function(){let $this=$(this),$el=$('<div class="charitable-field-drag-out charitable-field-drag">');vars.fieldType=$this.data("field-type");wpchar.debug("initDraggableFields start "),"drag-fields";wpchar.debug(vars,"drag-fields");wpchar.debug($el.html($this.html(),"drag-fields"));wpchar.debug("initDraggableFields end"),"drag-fields";return $el.html($this.html())},start:function(e,ui){let event=CharitableUtils.triggerEvent(el.$builder,"charitableFieldAddDragStart",[vars.fieldType,ui]);if(event.isDefaultPrevented()){return false}}})},revertMoveFieldToColumn:function($field){const isNewField=$field.data("field-id")===undefined;if(isNewField){$field.remove();return}$field=$field.detach();const $fieldInStartPosition=vars.$sortableStart.find("> .charitable-field").eq(vars.startPosition);$field.removeClass("charitable-field-dragging").removeClass("charitable-field-drag-over").attr("style","");if($fieldInStartPosition.length){$fieldInStartPosition.before($field);return}vars.$sortableStart.append($field)}};fieldLayout={positionFieldInColumn:function(fieldId,position,$sortable){if(!Charitable.Admin.Builder.FieldLayout){return}Charitable.Admin.Builder.FieldLayout.positionFieldInColumn(fieldId,position,$sortable)},receiveFieldToColumn:function(fieldId,position,$sortable){if(!Charitable.Admin.Builder.FieldLayout){return}Charitable.Admin.Builder.FieldLayout.receiveFieldToColumn(fieldId,position,$sortable)},fieldOptionsUpdate:function(e,fieldId){if(!Charitable.Admin.Builder.FieldLayout){return}Charitable.Admin.Builder.FieldLayout.fieldOptionsUpdate(e,fieldId)},reorderLayoutFieldsOptions:function($layoutField){if(!Charitable.Admin.Builder.FieldLayout){return}Charitable.Admin.Builder.FieldLayout.reorderLayoutFieldsOptions($layoutField)},isFieldAllowedInColum:function(fieldType){if(!Charitable.Admin.Builder.FieldLayout){return true}return Charitable.Admin.Builder.FieldLayout.isFieldAllowedInColum(fieldType)}};return app}(document,window,jQuery);Charitable.Admin.Builder.DragFields.init();