"use strict";var CharitableOnboarding=window.CharitableOnboarding||function(document,window,$){var app={init:function(){$(app.ready);$(window).on("load",(function(){if(typeof $.ready.then==="function"){$.ready.then(app.load)}else{app.load()}}))},ready:function(){},load:function(){},setup:function(){if(typeof charitable_admin_builder_onboarding==="undefined"||typeof charitable_admin_builder_onboarding.option==="undefined"||typeof charitable_admin_builder_onboarding.option.status==="undefined"){return}if(charitable_admin_builder_onboarding.option.status==="init"){app.clearLocalStorage();app.showWelcomePopup()}else if(charitable_admin_builder_onboarding.option.status==="started"){if(app.loadStep()>=1){app.clearLocalStorage();app.stepCompleted(1);app.eventSelectTemplate();app.updateTooltipUI()}}},events:function(){$("#charitable-onboarding-welcome-builder-popup").on("click","button",(function(){app.startOnboarding()}));$(".charitable-onboarding-step1-done").on("click",(function(){app.stepCompleted(1)}));$("#charitable-builder").on("charitableBuilderSetupReady",(function(){app.eventSelectTemplate()})).on("charitablePanelSwitch charitablePanelSectionSwitch",(function(){app.updateTooltipUI()}));$(".charitable-onboarding-step3-done").on("click",(function(){app.stepCompleted(3)}));$(".charitable-onboarding-step4-done").on("click",(function(){app.stepCompleted(4);app.gotoDraftPublishStep()}));$(".charitable-onboarding-step5-done").on("click",(function(){app.undoDraftPublishStep();app.stepCompleted(5)}));$(".charitable-onboarding-step6-done").on("click",(function(){app.stepCompleted(6)}));$(".charitable-onboarding-step7-done").on("click",(function(){app.stepCompleted(7);app.gotoSettingsStep()}));$(".charitable-onboarding-step8-done").on("click",(function(){app.stepCompleted(8);CharitableCampaignBuilder.panelSwitch("design");app.showClosingRemarksPopup()}));if(app.loadStep()==4){app.gotoDraftPublishStep()}if(app.loadStep()==7){app.gotoSettingsStep()}$(document).on("click",".charitable-onboarding-step16-done",app.showEmbedPopup);$.tooltipster.on("ready",app.tooltipsterReady);$(document).on("charitableCampaignFormScreen",(function(){app.stepCompleted(1);app.stepCompleted(2)}));$("#charitable-onboarding-goodbye-builder-popup .charitable-onboarding-popup-btn").on("click",(function(){app.saveOnboardingOption({status:"completed"});$("#charitable-onboarding-goodbye-builder-popup").fadeOut();$(".charitable-onboarding-popup-container").fadeOut()}))},eventSelectTemplate:function(){$("#charitable-panel-setup").off("click",".charitable-template-select").on("click",".charitable-template-select",(function(e){app.builderTemplateSelect(this,e)}))},startOnboarding:function(){app.saveOnboardingOption({status:"started"});$(".charitable-onboarding-popup-container").fadeOut((function(){$("#charitable-onboarding-welcome-builder-popup").hide()}));app.updateTooltipUI()},gotoStep:function(step){console.warn('WARNING! Function "CharitableOnboarding.builder.gotoStep()" has been deprecated.')},builderTemplateSelect:function(el,e){app.resumeOnboardingAndExec(e,(function(){app.stepCompleted(2).done(Charitable.Admin.Builder.Setup.selectTemplate.bind(el,e))}))},tooltipsterReady:function(e){var step=$(e.origin).data("charitable-onboarding-step");var formId=$("#charitable-builder-form").data("id");step=parseInt(step,10)||0;formId=parseInt(formId,10)||0;if(3===step&&formId>0){app.saveOnboardingOption({form_id:formId})}},showWelcomePopup:function(){$(".charitable-onboarding-popup-container").fadeIn((function(){$("#charitable-onboarding-welcome-builder-popup").fadeIn()}))},showClosingRemarksPopup:function(){$(".charitable-onboarding-popup-container").fadeIn((function(){$("#charitable-onboarding-goodbye-builder-popup").fadeIn()}))},gotoNotificationStep:function(e){},gotoDraftPublishStep:function(e){app.stepCompleted(4).done((function(){var $dropdown=$("#charitable-status-button");$dropdown.parent().find("ul#charitable-status-dropdown").removeClass("charitable-hidden");$dropdown.addClass("active");app.updateTooltipUI()}))},undoDraftPublishStep:function(e){var $dropdown=$("#charitable-status-button");$dropdown.parent().find("ul#charitable-status-dropdown").addClass("charitable-hidden");$dropdown.removeClass("active");app.updateTooltipUI()},gotoSettingsStep:function(e){CharitableCampaignBuilder.panelSwitch("settings");app.updateTooltipUI()},showEmbedPopup:function(){},enableEmbed:function(){$("#charitable-embed").removeClass("charitable-disabled")},saveOnboardingOption:function(optionData){if(typeof charitable_admin_builder_onboarding==="undefined"){return}var data={action:"charitable_onboarding_save_option",option_data:optionData,_wpnonce:charitable_admin_builder_onboarding.nonce};if(typeof charitable_admin_builder_onboarding.option.window_closed!=="undefined"){data.option_data.window_closed=charitable_admin_builder_onboarding.option.window_closed}else{data.option_data.window_closed=false}$.extend(charitable_admin_builder_onboarding.option,optionData);return $.post(charitable_builder.ajax_url,data,(function(response){if(!response.success){console.error("Error saving Chartiable Onboarding option.")}}))},refreshStep:function(){var savedStep=el.$onboarding.data("charitable-onboarding-saved-step");savedStep=parseInt(savedStep,10)||0;if(app.loadStep()!==savedStep){app.saveStep(savedStep)}},stepCompleted:function(step){app.updateTooltipUI(step);return app.saveStep(step)},initTooltips:function(step,anchor,args){if(typeof $.fn.tooltipster==="undefined"){return}var $dot=$('<span class="charitable-onboarding-dot charitable-onboarding-dot-step'+step+'" data-charitable-onboarding-step="'+step+'">&nbsp;</span>');var tooltipsterArgs={content:$("#tooltip-content"+step),trigger:null,interactive:true,animationDuration:0,delay:0,theme:["tooltipster-default","charitable-onboarding-tooltip"],side:["top"],distance:3,functionReady:function(instance,helper){$(helper.tooltip).addClass("charitable-onboarding-tooltip-step"+step);if(step===3||step===4||step===6||step===7||step===8){instance.option("side","bottom")}else if(step===5){instance.option("side","left")}else if(step===1){instance.option("side","bottom")}instance.reposition()}};if(typeof args==="object"&&args!==null){$.extend(tooltipsterArgs,args)}if(step===5){$dot.insertBefore(anchor).tooltipster(tooltipsterArgs)}else{$dot.insertAfter(anchor).tooltipster(tooltipsterArgs)}},updateTooltipUI:function(step){var nextStep;step=step||app.loadStep();nextStep=step+1;$(".charitable-onboarding-dot").each((function(i,el){var $dot=$(el),elStep=$dot.data("charitable-onboarding-step");if(elStep<nextStep){$dot.addClass("charitable-onboarding-dot-completed")}if(elStep>nextStep){$dot.addClass("charitable-onboarding-dot-next")}if(elStep===nextStep){$dot.removeClass("charitable-onboarding-dot-completed charitable-onboarding-dot-next")}setTimeout((function(){if($dot.is(":visible")&&elStep===nextStep){$dot.tooltipster("open")}else{$dot.tooltipster("close")}}),0)}))},loadStep:function(){var step=localStorage.getItem("charitableOnboardingStep");step=parseInt(step,10)||0;return step},saveStep:function(step){localStorage.setItem("charitableOnboardingStep",step);return app.saveOnboardingOption({step:step})},clearLocalStorage:function(){localStorage.removeItem("charitableOnboardingStep")}};return app}(document,window,jQuery);CharitableOnboarding.init();