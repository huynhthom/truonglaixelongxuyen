(function($){"use strict";var s;var CharitableDirAdmin={settings:{iconActivate:"",iconDeactivate:"",iconInstall:"",iconSpinner:"Standby...",mediaFrame:false},init:function(){s=this.settings;$(CharitableDirAdmin.ready);$(document).on("CharitableDirReady",CharitableDirAdmin.initAddons)},ready:function(){$(document).trigger("CharitableDirReady");if($("#charitable-admin-addons-search").val()){$("#charitable-admin-addons-search").trigger("keyup")}},initAddons:function(){if(!$("#charitable-admin-addons").length){return}if($("#charitable-admin-addons-list").length){var addonSearch=new List("charitable-admin-addons-list",{valueNames:["addon-link"]});$("#charitable-admin-addons-search").on("keyup search",(function(){CharitableDirAdmin.updateAddonSearchResult(this,addonSearch)}))}$(document).on("click","#charitable-admin-addons .addon-item button",(function(event){event.preventDefault();if($(this).hasClass("disabled")){return false}CharitableDirAdmin.addonToggle($(this))}))},updateAddonSearchResult:function(searchField,addonSearch){var searchTerm=$(searchField).val(),$heading=$("#addons-heading");searchTerm=searchTerm.replace(/[.,]/g," ");addonSearch.search(searchTerm)},setAddonState:function(plugin,state,pluginType,callback){var actions={activate:"charitable_activate_addon",install:"charitable_install_addon",deactivate:"charitable_deactivate_addon"},action=actions[state];if(!action){return}var data={action:action,nonce:charitable_admin.nonce,plugin:plugin,type:pluginType};$.post(charitable_admin.ajax_url,data,(function(res){callback(res)})).fail((function(xhr){console.log(xhr.responseText)}))},addonToggle:function($btn){var $addon=$btn.closest(".addon-item"),plugin=$btn.attr("data-plugin"),pluginType=$btn.attr("data-type"),state,cssClass,stateText,buttonText,errorText,successText;if($btn.hasClass("status-go-to-url")){window.open($btn.attr("data-plugin"),"_blank");return}$btn.prop("disabled",true).addClass("loading");$btn.html(s.iconSpinner);if($btn.hasClass("status-active")){state="deactivate";cssClass="status-installed";if(pluginType==="plugin"){cssClass+=" button button-secondary"}stateText=charitable_admin.addon_inactive;buttonText=charitable_admin.addon_activate;errorText=charitable_admin.addon_deactivate;if(pluginType==="addon"){buttonText=s.iconActivate+buttonText;errorText=s.iconDeactivate+errorText}}else if($btn.hasClass("status-installed")){state="activate";cssClass="status-active";if(pluginType==="plugin"){cssClass+=" button button-secondary disabled"}stateText=charitable_admin.addon_active;buttonText=charitable_admin.addon_deactivate;if(pluginType==="addon"){buttonText=s.iconDeactivate+buttonText;errorText=s.iconActivate+charitable_admin.addon_activate}else if(pluginType==="plugin"){buttonText=charitable_admin.addon_activated;errorText=charitable_admin.addon_activate}}else if($btn.hasClass("status-missing")){state="install";cssClass="status-active";if(pluginType==="plugin"){cssClass+=" button disabled"}stateText=charitable_admin.addon_active;buttonText=charitable_admin.addon_activated;errorText=s.iconInstall;if(pluginType==="addon"){buttonText=s.iconActivate+charitable_admin.addon_deactivate;errorText+=charitable_admin.addon_install}}else{return}CharitableDirAdmin.setAddonState(plugin,state,pluginType,(function(res){if(res.success){if("install"===state){$btn.attr("data-plugin",res.data.basename);successText=res.data.msg;if(!res.data.is_activated){stateText=charitable_admin.addon_inactive;buttonText="addon"===pluginType?charitable_admin.addon_activate:s.iconActivate+charitable_admin.addon_activate;cssClass="addon"===pluginType?"status-installed button button-secondary":"status-installed"}}else{successText=res.data}$addon.find(".actions").append('<div class="msg success">'+successText+"</div>");$addon.find("span.status-label").removeClass("status-active status-installed status-missing").addClass(cssClass).removeClass("button button-primary button-secondary disabled").text(stateText);$btn.removeClass("status-active status-installed status-missing").removeClass("button button-primary button-secondary disabled").addClass(cssClass).html(buttonText)}else{if("object"===typeof res.data){if(pluginType==="addon"){$addon.find(".actions").append('<div class="msg error"><p>'+charitable_admin.addon_error+"</p></div>")}else{$addon.find(".actions").append('<div class="msg error"><p>'+charitable_admin.plugin_error+"</p></div>")}}else{if("string"===typeof res){var err_data=JSON.parse(res);if("string"===typeof err_data.error){$addon.find(".actions").append('<div class="msg error"><p>'+err_data.error+"</p></div>")}else{$addon.find(".actions").append('<div class="msg error"><p>There has been an error.</p></div>')}}}if("install"===state&&"addon"===pluginType){$btn.addClass("status-go-to-url").removeClass("status-missing")}$btn.html(errorText)}$btn.prop("disabled",false).removeClass("loading");if(!$addon.find(".actions").find(".msg.error").length){setTimeout((function(){$(".addon-item .msg").remove()}),3e3)}}))},getQueryString:function(name){var match=new RegExp("[?&]"+name+"=([^&]*)").exec(window.location.search);return match&&decodeURIComponent(match[1].replace(/\+/g," "))},debug:function(msg){if(CharitableDirAdmin.isDebug()){if(typeof msg==="object"||msg.constructor===Array){console.log("Charitable Debug:");console.log(msg)}else{console.log("Charitable Debug: "+msg)}}},isDebug:function(){return window.location.hash&&"#charitabledebug"===window.location.hash}};CharitableDirAdmin.init();window.CharitableDirAdmin=CharitableDirAdmin})(jQuery);