!function(e){var t,r=e("body"),a=function(e){var t=e.get_input("connect_charge_owner");return t.length?t.val():null},n=function(e){var t=e.get_input("connected_account");return t.length?t.val():null},i=function(e){return"direct"===a(e)||"platform"===a(e)&&e.is_recurring_donation()},o=function(e,t){return"direct"===a(e)||t?{stripeAccount:n(e)}:null},d=function(){t=Stripe(CHARITABLE_STRIPE_VARS.key),r.on("charitable:form:processed",function(e,r,a){r.success&&"make_donation"===a.get_input("charitable_action").val()&&"stripe"===a.get_payment_method()&&(e.preventDefault(),a.add_pending_process("stripe"),(new_stripe=i(a)?Stripe(CHARITABLE_STRIPE_VARS.key,o(a,!0)):t).redirectToCheckout({sessionId:r.session_id}).then(function(e){a.add_error(e.error.message),a.remove_pending_process_by_name("stripe")}))})};function c(){var a,n,d=(t=Stripe(CHARITABLE_STRIPE_VARS.key)).elements().create("card"),c=e("#charitable_stripe_card_field"),s=e("#charitable_stripe_card_errors"),l=e(".charitable-donation-form [data-input=cc_name]"),p=e(".charitable-donation-form [name=postcode]");d.mount("#charitable_stripe_card_field"),d.on("change",function(e){s.text(e.error?e.error.message:"")}),p.length&&p.on("change",function(e){d.update({value:{postalCode:e.target.value}})}).trigger("change"),a=c.height(),n=(l.innerHeight()-a)/2,c.css({paddingTop:n,paddingRight:l.css("paddingRight"),paddingBottom:n,paddingLeft:l.css("paddingLeft"),border:l.css("border"),borderRadius:l.css("borderRadius"),background:l.css("background")}),r.on("charitable:form:validate",function(e,r){if("make_donation"===r.get_input("charitable_action").val()&&"stripe"===r.get_payment_method()){if(e.preventDefault(),""!==s.text()){r.hasOwnProperty("prevent_scroll_to_top")&&(r.prevent_scroll_to_top=!0),r.add_error(s.text()),r.hide_processing();return}if(0===r.errors.length){r.add_pending_process("stripe");var a,n,i=r.get_email(),o=r.get_input("phone"),c=(a={},[{field:"city",key:"city"},{field:"country",key:"country"},{field:"address",key:"line1"},{field:"address_2",key:"line2"},{field:"postcode",key:"postal_code"},{field:"state",key:"state"},].forEach(function(e){var t=r.get_input(e.field);t.length&&t.val().length&&(a[e.key]=t.val())}),a),p={billing_details:(n={name:l.val(),email:i,address:c},o.length&&o.val().length&&(n.phone=o.val()),n)};t.createPaymentMethod("card",d,p).then(function(e){e.error?r.hasOwnProperty("prevent_scroll_to_top")?r.prevent_scroll_to_top=!0:r.add_error(e.error.message):r.get_input("stripe_payment_method").val(e.paymentMethod.id),r.remove_pending_process_by_name("stripe")})}}}),r.on("charitable:form:processed",function(r,a,n){if(!(!a.success||n.is_recurring_donation()&&!a.requires_action)&&"make_donation"===n.get_input("charitable_action").val()&&"stripe"===n.get_payment_method()&&(r.preventDefault(),0===n.errors.length)){var d;n.add_pending_process("stripe"),(d=i(n)?Stripe(CHARITABLE_STRIPE_VARS.key,o(n,!0)):t).handleCardPayment(a.secret).then(function(t){t.error&&(e(document).trigger("Charitable_Custom_Event__Handle_Card_Payment_Fail",[r,t,a,CHARITABLE_STRIPE_VARS,n.get_payment_method()]),n.add_error(t.error.message)),n.remove_pending_process_by_name("stripe")})}})}function s(){var a=(t=Stripe(CHARITABLE_STRIPE_VARS.key)).elements(),n=e("#charitable_stripe_card_field"),d=e("#charitable_stripe_card_errors"),c=e(".charitable-donation-form [data-input=cc_name]");e(".charitable-donation-form [name=postcode]"),e("#charitable_stripe_card_name_field"),e("#charitable_stripe_card_number_field"),e("#charitable_stripe_card_expiration_field"),e("#charitable_stripe_card_cvc_field");var s=a.create("cardNumber");s.mount("#charitable_stripe_card_number_field");var l=a.create("cardExpiry");l.mount("#charitable_stripe_card_expiration_field");var p,g,u=a.create("cardCvc");u.mount("#charitable_stripe_card_cvc_field"),s.on("change",function(e){d.text(e.error?e.error.message:"")}),l.on("change",function(e){d.text(e.error?e.error.message:"")}),u.on("change",function(e){d.text(e.error?e.error.message:"")}),p=n.height(),g=(c.innerHeight()-p)/2,n.css({paddingTop:g,paddingRight:c.css("paddingRight"),paddingBottom:g,paddingLeft:c.css("paddingLeft"),border:c.css("border"),borderRadius:c.css("borderRadius"),background:c.css("background")}),r.on("charitable:form:validate",function(e,r){if("make_donation"===r.get_input("charitable_action").val()&&"stripe"===r.get_payment_method()){if(e.preventDefault(),""!==d.text()){r.hasOwnProperty("prevent_scroll_to_top")&&(r.prevent_scroll_to_top=!0),r.add_error(d.text()),r.hide_processing();return}if(0===r.errors.length){r.add_pending_process("stripe"),e.preventDefault();var a=r.get_email(),n=r.get_input("phone"),i={city:r.get_input("city").val(),country:r.get_input("country").val(),line1:r.get_input("address").val(),line2:r.get_input("address_2").val(),postal_code:r.get_input("postcode").val(),state:r.get_input("state").val()},o={name:c.val(),email:a,address:i};n.length&&n.val().length&&(o.phone=n.val()),t.createPaymentMethod({type:"card",card:s,billing_details:o}).then(function(e){e.error?r.add_error(e.error.message):r.get_input("stripe_payment_method").val(e.paymentMethod.id),r.remove_pending_process_by_name("stripe")})}}}),r.on("charitable:form:processed",function(r,a,n){if(!(!a.success||n.is_recurring_donation()&&!a.requires_action)&&"make_donation"===n.get_input("charitable_action").val()&&"stripe"===n.get_payment_method()&&(r.preventDefault(),0===n.errors.length)){var d;n.add_pending_process("stripe"),(d=i(n)?Stripe(CHARITABLE_STRIPE_VARS.key,o(n,!0)):t).confirmCardPayment(a.secret,{payment_method:{card:s,billing_details:{name:c.val(),email:n.get_email(),address:{city:n.get_input("city").val(),country:n.get_input("country").val(),line1:n.get_input("address").val(),line2:n.get_input("address_2").val(),postal_code:n.get_input("postcode").val(),state:n.get_input("state").val()}}}}).then(function(t){t.error&&(e(document).trigger("Charitable_Custom_Event__Handle_Card_Payment_Fail",[r,t,a,CHARITABLE_STRIPE_VARS,n.get_payment_method()]),n.add_error(t.error.message)),n.remove_pending_process_by_name("stripe")})}})}r.on("charitable:form:initialize",function(e){"checkout"===CHARITABLE_STRIPE_VARS.mode?new d:"undefined"!=typeof CHARITABLE_STRIPE_VARS&&void 0!==CHARITABLE_STRIPE_VARS.cc_fields_format&&"multiple"===CHARITABLE_STRIPE_VARS.cc_fields_format?new s:new c})}(jQuery);